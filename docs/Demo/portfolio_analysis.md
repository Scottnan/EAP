## portfolio_analysis

### Market System Risk (Beta)

Market system risk origins from CAPM (Sharpe, 1965), whose form can be 

$$
E(R_i)=R_f+\beta_i[E(R_M)-R_f].
$$


If market is in equilibrium, then the only factor that would drive asset excess return is market system risk premium. Once asset take more market system risk premium, more excess return should be paid. Thus, according to the theory, excess return has positive correlation with betas, which measures quantity of market system risk taken by asset.  

In empirical study, stocks are sorted by rolling beta (window=12 months) in ascending order and hereafter grouped into 5 or 10 groups. The average return of stocks between the head group and the tail group testing significantly and the corresponding ascending order of group return suggest the positive correlation of excess return and beta. The univariate and bivariate portfolio analysis are both conducted.

```python
# %% import package
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
month_return = pd.read_hdf('.\\data\\month_return.h5', key='month_return')
beta = pd.read_hdf('.\\data\\beta.hdf5', key='data')
```

The dataset contains monthly China A share stock between 2000-01-01 to 2021-12-31 from the CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** Since the data are loaded, some preprocessing procedures should be conducted. 

```python
# %% data preprocessing
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
```

Construct market portfolio return.

```python
# %% construct market portfolio return
import numpy as np
market_portfolio_return = month_return['Mretwd'].groupby(month_return['Trdmnt']).apply(np.mean)
market_portfolio_return.name = 'market_portfolio_return'
month_return = pd.merge(month_return, market_portfolio_return, on=['Trdmnt'])
month_return = month_return.sort_values(['Stkcd', 'Trdmnt'])
```

Calculate beta.

```python
# %% calculate beta
import statsmodels.api as sm
import numpy as np

reg = month_return.set_index(['Stkcd', 'Trdmnt'])[['Mretwd', 'market_portfolio_return']].dropna()
beta = pd.Series(index=reg.index, dtype=float, name='beta')
for i in reg.groupby('Stkcd'):
    row, col = np.shape(i[1])
    for j in range(row-12):
        model = sm.OLS(i[1].iloc[j:j+12, 0], sm.add_constant(i[1].iloc[j:j+12, 1])).fit()
        beta.loc[i[1].index[j+11]] = model.params[1]

reg = pd.merge(reg, beta, left_index=True, right_index=True)
```

Data need further preprocessing.

```python
# %% Data preprocessing: merge data
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])
month_return = month_return.set_index(['Stkcd', 'Trdmnt'])
month_return = pd.merge(month_return, beta, left_index=True, right_index=True)
# construct label
# data starts from 2000-01
return_company = month_return[month_return['Date_merge']>='2000-01']
```

Due to specific requirement of the IPO, some dominant company would purchase a small listed company and join the A share market. Thus, in the research by Liu et al. (2016), the stocks whose size is below the 30% are abandoned.

```python
# %% construct test_data for bivariate analysis
# dataset 1
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'beta', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'beta', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
===================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.006 |  0.01 | 0.011 | 0.012 | 0.013 | 0.011 | 0.012 | 0.011 | 0.012 | 0.007 | 0.001 |
|  T-Test | 1.213 | 1.937 | 1.996 | 2.017 | 2.155 | 1.752 | 1.905 |  1.74 | 1.745 |  1.02 | 0.294 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
===================================================================================================

# Independent-sort Bivariate Analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
===============================================================
+-------+-------+--------+--------+--------+--------+--------+
| Group |   1   |   2    |   3    |   4    |   5    |  Diff  |
+-------+-------+--------+--------+--------+--------+--------+
|   1   | 0.009 | 0.014  | 0.014  | 0.015  | 0.014  | 0.005  |
|       | 1.436 | 2.308  | 2.093  | 2.179  | 1.888  |  1.85  |
|   2   | 0.006 | 0.013  | 0.013  | 0.013  | 0.011  | 0.005  |
|       | 0.996 | 2.115  | 2.008  | 1.931  | 1.633  | 2.147  |
|   3   | 0.008 |  0.01  |  0.01  |  0.01  | 0.008  | 0.001  |
|       | 1.333 | 1.779  | 1.669  | 1.603  | 1.174  |  0.24  |
|   4   | 0.008 | 0.009  |  0.01  | 0.011  | 0.008  |  0.0   |
|       | 1.496 |  1.66  | 1.622  | 1.687  | 1.173  | 0.065  |
|   5   | 0.009 |  0.01  | 0.013  |  0.01  | 0.006  | -0.003 |
|       | 1.928 | 1.882  | 2.103  | 1.533  |  0.86  | -0.914 |
|  Diff |  0.0  | -0.004 | -0.001 | -0.005 | -0.008 | -0.008 |
|       | 0.106 | -1.31  | -0.301 | -1.425 | -2.13  | -2.738 |
+-------+-------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary_by_time()
bi_1_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | beta1  | beta2  | beta3  | beta4  | beta5  |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.011  | 0.015  | 0.013  | 0.016  | 0.013  | 0.002  |
|          | 1.818  | 2.347  | 1.945  | 2.329  |  1.81  | 0.911  |
| Msmvttl2 | 0.007  | 0.013  | 0.014  | 0.012  | 0.012  | 0.005  |
|          | 1.219  |  2.15  | 2.099  | 1.764  | 1.689  | 1.875  |
| Msmvttl3 | 0.009  |  0.01  |  0.01  |  0.01  | 0.008  | -0.001 |
|          | 1.547  | 1.736  | 1.613  |  1.58  | 1.169  | -0.169 |
| Msmvttl4 | 0.008  |  0.01  | 0.009  |  0.01  | 0.008  |  -0.0  |
|          | 1.552  |  1.71  |  1.45  | 1.639  | 1.167  | -0.065 |
| Msmvttl5 | 0.008  |  0.01  |  0.01  |  0.01  | 0.006  | -0.001 |
|          | 1.662  | 2.052  | 1.895  | 1.661  | 0.983  | -0.357 |
|   Diff   | -0.003 | -0.005 | -0.003 | -0.006 | -0.007 | -0.004 |
|          | -0.858 | -1.316 | -0.757 | -1.652 | -1.855 | -1.152 |
+----------+--------+--------+--------+--------+--------+--------+
==================================================================
```

The result from dataset #1 is **consistent with literatures** that in univariate analysis the differenced return is **not significant** since the t-value is **below 2.3**, and in bivariate analysis the differenced return in most part is insignificant since the t-value is **less than 2.3**, suggesting that market system risk factor provides **no excess return.** The way of sorting plays no transitional role on the result.

```python
# %% construct test_data for bivariate analysis
# dataset 2
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[(return_company['Ndaytrd']>=10)]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'beta', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2000-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'beta', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.008 | 0.012 | 0.013 | 0.016 | 0.016 | 0.015 | 0.017 | 0.015 | 0.014 | 0.012 | 0.004 |
|  T-Test | 1.608 | 2.214 | 2.281 | 2.492 | 2.451 | 2.388 | 2.537 | 2.296 | 2.104 | 1.637 | 1.043 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
====================================================================================================

# Independent-sort Bivariate Analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.019  | 0.023  | 0.026  | 0.027  | 0.027  | 0.008  |
|       | 2.657  | 3.184  | 3.538  |  3.44  | 3.017  | 2.203  |
|   2   | 0.011  | 0.014  | 0.015  | 0.017  | 0.016  | 0.004  |
|       | 1.782  |  2.22  | 2.235  | 2.502  | 2.152  | 1.785  |
|   3   | 0.007  | 0.013  | 0.014  | 0.013  |  0.01  | 0.003  |
|       | 1.236  |  2.23  | 2.122  |  1.89  | 1.505  | 1.379  |
|   4   | 0.008  |  0.01  | 0.009  | 0.011  | 0.009  | 0.001  |
|       | 1.493  | 1.775  |  1.52  | 1.718  | 1.291  |  0.31  |
|   5   | 0.009  | 0.011  | 0.012  |  0.01  | 0.006  | -0.004 |
|       | 1.916  | 1.919  | 1.887  | 1.556  | 0.846  | -1.035 |
|  Diff | -0.01  | -0.012 | -0.014 | -0.017 | -0.021 | -0.011 |
|       | -2.132 | -2.866 | -3.566 | -3.669 | -3.58  | -2.665 |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Biviraite Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary_by_time()
bi_2_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | beta1  | beta2  | beta3  | beta4  | beta5  |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 |  0.02  | 0.027  | 0.024  | 0.028  | 0.026  | 0.006  |
|          | 2.947  | 3.413  | 3.471  | 3.469  | 3.052  |  1.81  |
| Msmvttl2 | 0.012  | 0.013  | 0.017  | 0.018  | 0.015  | 0.002  |
|          | 1.982  | 2.069  | 2.484  | 2.554  | 2.054  | 1.127  |
| Msmvttl3 | 0.008  | 0.014  | 0.013  | 0.012  | 0.011  | 0.003  |
|          | 1.391  |  2.3   | 2.052  | 1.841  | 1.545  | 1.154  |
| Msmvttl4 | 0.007  |  0.01  |  0.01  |  0.01  | 0.009  | 0.001  |
|          | 1.353  | 1.778  | 1.657  | 1.577  | 1.235  |  0.41  |
| Msmvttl5 | 0.008  |  0.01  | 0.011  | 0.009  | 0.006  | -0.001 |
|          | 1.679  | 1.898  | 1.938  | 1.484  | 0.982  | -0.391 |
|   Diff   | -0.012 | -0.017 | -0.014 | -0.018 | -0.019 | -0.007 |
|          | -2.766 | -3.373 | -3.389 | -3.916 | -3.651 | -1.77  |
+----------+--------+--------+--------+--------+--------+--------+
```

The result from dataset #2 is **consistent with literatures** that in univariate analysis the differenced return is **not significant** since the t-value is **below 2.3**, and in bivariate analysis the differenced return in most part is insignificant since the t-value is **less than 2.3**, suggesting that market system risk factor provides **no excess return.** The dependent-sort would weaken the significance of portfolio return.



### Size Effect

Size effect, discovered by Fama and French(1993), is probably the most famous and common phenomenon in the main capital markets. Size, as a characteristic of company, is able to predict the future stock return that the bigger company tend to have low return in the future. Fama and French take the effect as a proxy for some background risk factor, probably default risk and bankruptcy risk. Like the US stock market, China A share market exists such effect as well (Liu et al., 2016), which would be constructed and tested as follows.

Stocks are sorted by firm size in ascending order and hereafter grouped into 5 or 10 groups. The average return of stocks between the head group and the tail group testing significantly and the corresponding descending order of group return suggest the existence of size effect.

```python
# %% import package
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))
# %% import data
# Monthly return of Stocks in China Security Market
month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
```

The dataset contains monthly China A share stock between 2000-01-01 to 2021-12-31 from the CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** Since the data are loaded, some preprocessing procedures should be conducted. 

```python
import datetime as dt

# TimeStamp the tradetime 
month_return['Time'] = pd.to_datetime(month_return['Trdmnt'])
# convert the time string to the timestamp
month_return['numberTime'] = month_return['Time'].apply(dt.datetime.timestamp)
# forward the monthly return for each stock
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1) # emrwd is the return including dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1) # emrnd is the return including no dividend 
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]
```

There are several characteristics in A share market, which therefore should be analyzed respectively. 

The first specification is the shell effect. Due to specific requirement of the IPO, some dominant company would purchase a small listed company and join the A share market. Thus, in the research by Liu et al. (2016), the stocks whose size is below the 30% are abandoned.

```python
# %% distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
```

The second specification is the time interval. Before 2017, the size effect is relatively more significant, while since 2017, especially between 2017 and 2019, big companies perform better, and therefore the size effect are neutralized. According to these two specifications, four datasets are formed.

```python
# %% construct test_data for univariate analysis
# dataset 1
from portfolio_analysis import Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = month_return[(month_return['cap']==True) & (month_return['Ndaytrd']>=10)]
# construct data for univariate analysis
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'Time']].dropna()
test_data_1 = test_data_1[(test_data_1['Time'] >= '2000-01-01') & (test_data_1['Time'] <= '2019-12-01')]
# analysis
uni_1 = Univariate(np.array(test_data_1), number=9)
uni_1.average_by_time()
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
==========================================================================================================================
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
|         Time        |   1    |   2    |   3    |   4    |   5    |   6    |   7    |   8    |   9    |   10   |  diff  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| 2000-01-01 00:00:00 | 0.124  | 0.144  | 0.126  | 0.129  |  0.1   | 0.129  | 0.095  | 0.103  | 0.114  | 0.135  | 0.011  |
| 2000-02-01 00:00:00 | 0.155  | 0.122  | 0.075  |  0.12  | 0.053  | 0.064  | 0.054  |  0.04  | 0.022  | 0.009  | -0.146 |
| 2000-03-01 00:00:00 | 0.007  | 0.022  | 0.012  |  0.01  | 0.004  | 0.002  | 0.016  | 0.015  | 0.017  | 0.033  | 0.026  |
| 2000-04-01 00:00:00 | 0.034  | 0.042  | 0.042  | 0.043  |  0.03  | 0.024  | 0.049  | 0.022  | 0.021  | 0.021  | -0.013 |
| 2000-05-01 00:00:00 | 0.008  | 0.041  | 0.046  | 0.015  | 0.029  | 0.022  | 0.007  |  0.03  | 0.044  | 0.021  | 0.013  |
| 2000-06-01 00:00:00 |  0.06  | 0.067  | 0.045  | 0.038  | 0.051  | 0.042  | 0.029  | 0.036  | 0.032  | 0.045  | -0.016 |
| 2000-07-01 00:00:00 | 0.017  | -0.003 | 0.003  | 0.001  | -0.013 | -0.008 | -0.014 | -0.003 | -0.012 | -0.028 | -0.045 |
| 2000-08-01 00:00:00 | -0.027 | -0.025 | -0.032 | -0.056 | -0.061 | -0.055 | -0.04  | -0.065 | -0.054 | -0.056 | -0.029 |
| 2000-09-01 00:00:00 | 0.038  | 0.049  | 0.034  | 0.034  | 0.038  | 0.022  | 0.031  | 0.015  | 0.013  | 0.002  | -0.036 |
| 2000-10-01 00:00:00 | 0.056  | 0.069  | 0.063  | 0.063  | 0.063  | 0.069  | 0.042  | 0.046  | 0.053  | 0.059  | 0.004  |
| 2000-11-01 00:00:00 | 0.009  | 0.013  | 0.011  | 0.008  | -0.002 | 0.014  |  0.01  |  0.0   | -0.012 | -0.024 | -0.033 |
| 2000-12-01 00:00:00 |  0.0   | -0.008 | -0.018 | -0.007 | -0.01  | -0.014 | 0.001  | -0.007 | -0.008 | -0.019 | -0.019 |
| 2001-01-01 00:00:00 | -0.077 | -0.058 | -0.067 | -0.064 | -0.053 | -0.055 | -0.063 | -0.055 | -0.048 | -0.05  | 0.027  |
| 2001-02-01 00:00:00 | 0.096  | 0.072  | 0.085  | 0.074  | 0.088  | 0.079  | 0.075  | 0.061  | 0.065  | 0.056  | -0.04  |
| 2001-03-01 00:00:00 | 0.015  | 0.009  | -0.01  | -0.001 | -0.007 | -0.011 | 0.001  | -0.012 | -0.009 | -0.017 | -0.032 |
| 2001-04-01 00:00:00 | 0.073  | 0.045  | 0.051  | 0.049  | 0.038  |  0.03  | 0.039  | 0.029  | 0.016  |  0.01  | -0.063 |
| 2001-05-01 00:00:00 | 0.018  |  0.01  | 0.012  | 0.012  | 0.019  | 0.002  | -0.005 | 0.015  | -0.01  | -0.002 | -0.02  |
| 2001-06-01 00:00:00 | -0.138 | -0.138 | -0.129 | -0.134 | -0.141 | -0.149 | -0.123 | -0.131 | -0.13  | -0.13  | 0.009  |
| 2001-07-01 00:00:00 | -0.031 | -0.035 | -0.034 | -0.039 | -0.038 | -0.041 | -0.04  | -0.03  | -0.034 | -0.049 | -0.018 |
| 2001-08-01 00:00:00 | -0.055 | -0.067 | -0.048 | -0.067 | -0.048 | -0.047 | -0.046 | -0.047 | -0.05  | -0.022 | 0.033  |
| 2001-09-01 00:00:00 | -0.062 | -0.054 | -0.052 | -0.057 | -0.056 | -0.066 | -0.053 | -0.046 | -0.053 | -0.028 | 0.034  |
| 2001-10-01 00:00:00 | 0.057  | 0.057  | 0.042  | 0.054  | 0.046  | 0.039  | 0.041  | 0.034  | 0.039  | 0.021  | -0.035 |
| 2001-11-01 00:00:00 | -0.067 | -0.082 | -0.069 | -0.078 | -0.067 | -0.063 | -0.067 | -0.058 | -0.05  | -0.047 | 0.021  |
| 2001-12-01 00:00:00 | -0.141 | -0.14  | -0.119 | -0.121 | -0.117 | -0.116 | -0.108 |  -0.1  | -0.087 | -0.062 | 0.079  |
| 2002-01-01 00:00:00 | 0.035  | 0.044  | 0.043  | 0.036  |  0.03  | 0.032  | 0.028  | 0.025  | 0.016  | 0.011  | -0.024 |
| 2002-02-01 00:00:00 | 0.097  |  0.08  | 0.076  | 0.078  | 0.069  | 0.076  | 0.076  | 0.056  | 0.061  | 0.032  | -0.065 |
| 2002-03-01 00:00:00 | 0.057  | 0.059  | 0.048  | 0.037  | 0.053  | 0.042  | 0.028  | 0.037  | 0.031  | 0.033  | -0.025 |
| 2002-04-01 00:00:00 | -0.095 | -0.089 | -0.095 | -0.093 | -0.092 | -0.095 | -0.09  | -0.089 | -0.092 | -0.075 |  0.02  |
| 2002-05-01 00:00:00 | 0.116  | 0.115  |  0.11  | 0.113  | 0.122  | 0.114  | 0.142  | 0.123  | 0.152  | 0.158  | 0.042  |
| 2002-06-01 00:00:00 | -0.036 | -0.034 | -0.03  | -0.034 | -0.041 | -0.04  | -0.04  | -0.049 | -0.041 | -0.045 | -0.009 |
| 2002-07-01 00:00:00 | 0.011  | 0.004  | 0.005  |  -0.0  | 0.009  | 0.008  | 0.007  | 0.011  | -0.003 | 0.005  | -0.006 |
| 2002-08-01 00:00:00 | -0.058 | -0.056 | -0.065 | -0.059 | -0.057 | -0.059 | -0.054 | -0.046 | -0.05  | -0.047 | 0.011  |
| 2002-09-01 00:00:00 | -0.073 | -0.06  | -0.059 | -0.053 | -0.049 | -0.057 | -0.045 | -0.045 | -0.049 | -0.044 | 0.028  |
| 2002-10-01 00:00:00 | -0.084 | -0.093 | -0.087 | -0.079 | -0.071 | -0.076 | -0.077 | -0.053 | -0.046 | -0.033 | 0.052  |
| 2002-11-01 00:00:00 | -0.059 | -0.055 | -0.056 | -0.058 | -0.051 | -0.062 | -0.05  | -0.05  | -0.05  | -0.045 | 0.013  |
| 2002-12-01 00:00:00 | 0.115  | 0.111  |  0.09  | 0.103  | 0.099  | 0.085  | 0.076  | 0.078  | 0.078  | 0.095  | -0.02  |
| 2003-01-01 00:00:00 | 0.015  | 0.012  | 0.019  |  0.01  |  0.01  | 0.012  | 0.014  | 0.012  | 0.004  | 0.006  | -0.009 |
| 2003-02-01 00:00:00 | -0.03  | -0.037 | -0.032 | -0.031 | -0.023 | -0.026 | -0.022 | -0.009 |  -0.0  | 0.013  | 0.043  |
| 2003-03-01 00:00:00 | -0.07  | -0.041 | -0.05  | -0.048 | -0.037 | -0.02  | -0.023 | 0.002  | 0.002  | 0.033  | 0.104  |
| 2003-04-01 00:00:00 | 0.028  | 0.041  | 0.027  | 0.038  | 0.042  | 0.034  | 0.057  | 0.047  | 0.054  | 0.058  |  0.03  |
| 2003-05-01 00:00:00 | -0.067 | -0.063 | -0.074 | -0.07  | -0.079 | -0.072 | -0.082 | -0.056 | -0.06  | -0.065 | 0.002  |
| 2003-06-01 00:00:00 | -0.036 | -0.044 | -0.037 | -0.031 | -0.043 | -0.023 | -0.022 | -0.015 | 0.006  | 0.016  | 0.052  |
| 2003-07-01 00:00:00 | -0.02  | -0.016 | -0.027 | -0.041 | -0.029 | -0.037 | -0.032 | -0.025 | -0.029 | -0.043 | -0.022 |
| 2003-08-01 00:00:00 | -0.044 | -0.043 | -0.056 | -0.035 | -0.034 | -0.037 | -0.045 | -0.049 | -0.041 | -0.039 | 0.006  |
| 2003-09-01 00:00:00 | -0.081 | -0.077 | -0.073 | -0.066 | -0.062 | -0.064 | -0.042 | -0.032 | -0.023 | 0.011  | 0.092  |
| 2003-10-01 00:00:00 | 0.008  | 0.022  | 0.026  | 0.035  | 0.033  | 0.015  | 0.026  | 0.018  | 0.014  |  0.03  | 0.022  |
| 2003-11-01 00:00:00 | -0.019 | -0.021 | -0.028 | -0.016 |  0.01  | 0.013  | 0.022  | 0.022  | 0.035  | 0.088  | 0.106  |
| 2003-12-01 00:00:00 | 0.091  | 0.103  | 0.097  | 0.099  | 0.084  | 0.081  | 0.067  | 0.067  | 0.075  | 0.047  | -0.044 |
| 2004-01-01 00:00:00 | 0.122  | 0.097  | 0.083  | 0.093  |  0.11  | 0.081  | 0.077  | 0.074  | 0.071  | 0.051  | -0.072 |
| 2004-02-01 00:00:00 | 0.042  | 0.046  | 0.035  | 0.052  | 0.052  | 0.029  | 0.036  | 0.033  | 0.028  | 0.028  | -0.014 |
| 2004-03-01 00:00:00 | -0.103 | -0.086 |  -0.1  |  -0.1  | -0.091 | -0.093 | -0.083 | -0.101 | -0.086 | -0.116 | -0.013 |
| 2004-04-01 00:00:00 | -0.029 | -0.017 | -0.009 | -0.025 | -0.014 | -0.03  | -0.019 | -0.026 | -0.035 | -0.024 | 0.005  |
| 2004-05-01 00:00:00 | -0.128 | -0.131 | -0.135 | -0.134 | -0.132 | -0.126 | -0.114 | -0.124 | -0.111 | -0.085 | 0.043  |
| 2004-06-01 00:00:00 | -0.026 | -0.034 | -0.022 | -0.022 | 0.004  | 0.007  |  0.01  | 0.005  | 0.021  | 0.003  | 0.028  |
| 2004-07-01 00:00:00 | -0.049 | -0.046 | -0.052 | -0.057 | -0.058 | -0.059 | -0.062 | -0.066 | -0.042 | -0.036 | 0.013  |
| 2004-08-01 00:00:00 | 0.061  | 0.043  | 0.053  | 0.045  | 0.053  | 0.064  | 0.057  | 0.062  | 0.056  | 0.062  | 0.001  |
| 2004-09-01 00:00:00 | -0.075 | -0.053 | -0.076 | -0.048 | -0.057 | -0.066 | -0.061 | -0.03  | -0.018 | -0.053 | 0.022  |
| 2004-10-01 00:00:00 | 0.059  |  0.05  |  0.04  | 0.041  | 0.049  | 0.046  | 0.032  | 0.025  | 0.002  | -0.005 | -0.064 |
| 2004-11-01 00:00:00 | -0.078 | -0.08  | -0.086 | -0.079 | -0.09  | -0.093 | -0.077 | -0.066 | -0.076 | -0.048 |  0.03  |
| 2004-12-01 00:00:00 | -0.076 | -0.073 | -0.084 | -0.079 | -0.079 | -0.08  | -0.078 | -0.078 | -0.069 | -0.047 | 0.029  |
| 2005-01-01 00:00:00 | 0.112  |  0.11  | 0.107  | 0.102  | 0.116  | 0.115  | 0.117  | 0.095  | 0.093  | 0.093  | -0.019 |
| 2005-02-01 00:00:00 | -0.147 | -0.137 | -0.138 | -0.133 | -0.117 | -0.121 | -0.112 | -0.121 | -0.088 | -0.086 |  0.06  |
| 2005-03-01 00:00:00 | -0.107 | -0.076 | -0.084 | -0.049 | -0.067 | -0.05  | -0.041 | -0.037 | -0.008 | 0.012  | 0.119  |
| 2005-04-01 00:00:00 | -0.015 | -0.024 | -0.026 | -0.033 | -0.04  | -0.054 | -0.059 | -0.079 | -0.077 |  -0.1  | -0.085 |
| 2005-05-01 00:00:00 | -0.001 | 0.001  | -0.001 | -0.003 | 0.003  | -0.011 | -0.004 | 0.011  | -0.005 | 0.037  | 0.038  |
| 2005-06-01 00:00:00 | -0.083 | -0.07  | -0.079 | -0.07  | -0.058 | -0.063 | -0.053 | -0.036 | -0.012 | 0.015  | 0.097  |
| 2005-07-01 00:00:00 | 0.169  | 0.184  | 0.163  | 0.159  | 0.131  | 0.132  | 0.127  | 0.139  | 0.073  | 0.048  | -0.121 |
| 2005-08-01 00:00:00 |  0.02  | 0.008  | 0.007  | 0.025  | 0.028  | 0.024  | 0.035  | 0.036  | 0.016  | -0.013 | -0.034 |
| 2005-09-01 00:00:00 | -0.071 | -0.05  | -0.067 | -0.043 | -0.062 | -0.055 | -0.056 | -0.042 | -0.057 | -0.053 | 0.019  |
| 2005-10-01 00:00:00 | 0.018  |  0.01  | 0.019  | 0.005  | 0.016  | 0.016  | -0.014 | -0.014 | -0.019 | -0.004 | -0.022 |
| 2005-11-01 00:00:00 | 0.016  |  0.01  | 0.018  | 0.022  | 0.033  | 0.043  | 0.047  | 0.067  | 0.062  | 0.079  | 0.063  |
| 2005-12-01 00:00:00 | 0.098  | 0.067  |  0.09  | 0.088  | 0.094  | 0.119  | 0.141  |  0.12  |  0.13  | 0.088  | -0.01  |
| 2006-01-01 00:00:00 | 0.034  | 0.026  | 0.023  | 0.019  | 0.021  | 0.017  | 0.017  | -0.007 | 0.022  | 0.046  | 0.012  |
| 2006-02-01 00:00:00 | -0.002 | 0.001  | 0.006  | 0.008  | 0.022  | 0.025  | 0.042  | 0.048  | 0.048  | 0.025  | 0.027  |
| 2006-03-01 00:00:00 | 0.093  | 0.106  | 0.101  | 0.089  | 0.122  | 0.118  | 0.133  | 0.145  |  0.16  | 0.127  | 0.034  |
| 2006-04-01 00:00:00 | 0.297  | 0.251  | 0.284  | 0.265  | 0.261  | 0.222  | 0.266  | 0.201  | 0.208  | 0.156  | -0.141 |
| 2006-05-01 00:00:00 | 0.065  | 0.091  | 0.067  | 0.052  | 0.058  |  0.04  | 0.048  | 0.045  | 0.013  |  0.02  | -0.045 |
| 2006-06-01 00:00:00 | -0.002 | -0.038 | -0.039 | -0.022 | -0.043 | -0.043 | -0.051 | -0.059 | -0.056 | -0.088 | -0.086 |
| 2006-07-01 00:00:00 | 0.029  | 0.016  | 0.042  | 0.028  | 0.042  | 0.029  | 0.057  | 0.031  |  0.04  | 0.024  | -0.005 |
| 2006-08-01 00:00:00 | 0.049  | 0.056  | 0.049  | 0.039  | 0.038  | 0.052  | 0.026  | 0.042  | 0.041  | 0.044  | -0.005 |
| 2006-09-01 00:00:00 | -0.011 |  0.01  | 0.016  | -0.013 | -0.029 | 0.004  | -0.01  | 0.029  | 0.014  | 0.034  | 0.045  |
| 2006-10-01 00:00:00 | 0.014  | 0.024  | 0.034  | 0.038  | 0.058  | 0.055  | 0.063  | 0.079  | 0.139  | 0.183  | 0.169  |
| 2006-11-01 00:00:00 | 0.055  | 0.032  | 0.036  | 0.043  | 0.072  | 0.061  | 0.088  | 0.097  | 0.099  |  0.17  | 0.115  |
| 2006-12-01 00:00:00 | 0.296  | 0.254  | 0.262  | 0.251  | 0.233  | 0.239  | 0.232  | 0.209  | 0.254  | 0.173  | -0.122 |
| 2007-01-01 00:00:00 | 0.254  | 0.179  | 0.218  | 0.187  |  0.26  | 0.177  | 0.139  | 0.162  | 0.128  | 0.066  | -0.188 |
| 2007-02-01 00:00:00 | 0.196  | 0.203  | 0.179  | 0.163  | 0.171  | 0.175  | 0.142  | 0.103  | 0.072  |  0.09  | -0.107 |
| 2007-03-01 00:00:00 | 0.389  |  0.32  | 0.358  | 0.298  | 0.342  | 0.341  | 0.329  | 0.362  | 0.337  | 0.262  | -0.127 |
| 2007-04-01 00:00:00 | 0.067  | 0.093  | 0.064  | 0.065  | 0.178  | 0.113  | 0.081  | 0.092  | 0.143  | 0.118  | 0.051  |
| 2007-05-01 00:00:00 | -0.205 | -0.205 | -0.177 | -0.162 | -0.144 | -0.171 | -0.121 | -0.109 | -0.064 | -0.028 | 0.176  |
| 2007-06-01 00:00:00 | 0.235  |  0.26  | 0.231  | 0.228  | 0.216  |  0.2   | 0.192  | 0.196  | 0.182  | 0.186  | -0.049 |
| 2007-07-01 00:00:00 | 0.093  | 0.095  | 0.108  | 0.086  | 0.133  | 0.093  | 0.108  | 0.131  | 0.161  | 0.183  |  0.09  |
| 2007-08-01 00:00:00 | 0.025  | 0.015  | 0.043  | 0.059  |  0.03  | 0.046  | 0.018  | 0.038  | 0.082  | 0.073  | 0.048  |
| 2007-09-01 00:00:00 | -0.113 | -0.135 | -0.115 | -0.099 | -0.099 | -0.115 | -0.093 | -0.091 | -0.072 | 0.016  | 0.129  |
| 2007-10-01 00:00:00 | -0.038 | -0.058 | -0.05  | -0.084 | -0.048 | -0.112 | -0.091 | -0.13  | -0.163 | -0.184 | -0.147 |
| 2007-11-01 00:00:00 | 0.207  | 0.201  | 0.219  | 0.213  | 0.218  | 0.209  |  0.23  | 0.192  | 0.192  | 0.135  | -0.073 |
| 2007-12-01 00:00:00 | -0.061 | -0.058 | -0.075 | -0.052 | -0.058 | -0.06  | -0.065 | -0.078 | -0.079 | -0.141 | -0.081 |
| 2008-01-01 00:00:00 |  0.11  | 0.096  |  0.1   | 0.089  | 0.083  | 0.068  | 0.063  |  0.05  |  0.03  | 0.012  | -0.097 |
| 2008-02-01 00:00:00 | -0.188 | -0.189 | -0.196 | -0.202 | -0.204 | -0.199 | -0.214 | -0.211 | -0.233 | -0.212 | -0.023 |
| 2008-03-01 00:00:00 | -0.061 | -0.091 | -0.055 | -0.055 | -0.048 | -0.038 | -0.013 | 0.003  |  0.03  | 0.057  | 0.118  |
| 2008-04-01 00:00:00 | 0.002  | -0.017 | -0.03  | -0.039 | -0.035 | -0.039 | -0.053 | -0.045 | -0.054 | -0.089 | -0.091 |
| 2008-05-01 00:00:00 | -0.275 | -0.261 | -0.249 | -0.262 | -0.252 | -0.239 | -0.247 | -0.242 | -0.227 | -0.215 |  0.06  |
| 2008-06-01 00:00:00 | 0.114  | 0.102  | 0.107  | 0.105  | 0.081  | 0.074  |  0.08  |  0.05  | 0.044  | -0.005 | -0.119 |
| 2008-07-01 00:00:00 | -0.244 | -0.214 | -0.223 | -0.248 | -0.229 | -0.235 | -0.253 | -0.226 | -0.239 | -0.169 | 0.075  |
| 2008-08-01 00:00:00 | -0.101 | -0.085 | -0.112 | -0.075 | -0.082 | -0.084 | -0.064 | -0.046 | -0.041 | -0.016 | 0.085  |
| 2008-09-01 00:00:00 | -0.261 | -0.263 | -0.251 | -0.261 | -0.271 | -0.265 | -0.26  | -0.273 | -0.261 | -0.257 | 0.003  |
| 2008-10-01 00:00:00 | 0.233  | 0.211  | 0.233  | 0.211  | 0.202  | 0.175  | 0.162  | 0.166  |  0.15  |  0.12  | -0.112 |
| 2008-11-01 00:00:00 | 0.116  | 0.053  | 0.073  | 0.073  | 0.043  | 0.054  | 0.064  | 0.052  | 0.041  | -0.002 | -0.118 |
| 2008-12-01 00:00:00 | 0.157  | 0.155  | 0.167  | 0.186  |  0.17  | 0.175  | 0.167  | 0.161  | 0.147  | 0.104  | -0.053 |
| 2009-01-01 00:00:00 | 0.091  | 0.081  | 0.091  | 0.093  | 0.073  | 0.084  | 0.077  | 0.064  |  0.06  |  0.06  | -0.031 |
| 2009-02-01 00:00:00 | 0.244  | 0.249  | 0.213  | 0.229  | 0.205  | 0.217  | 0.209  | 0.187  | 0.213  | 0.178  | -0.066 |
| 2009-03-01 00:00:00 |  0.07  | 0.076  | 0.085  | 0.074  | 0.049  | 0.039  | 0.078  | 0.025  | 0.065  | 0.046  | -0.025 |
| 2009-04-01 00:00:00 | 0.078  | 0.071  | 0.085  | 0.075  | 0.045  | 0.054  | 0.051  | 0.038  | 0.062  | 0.046  | -0.031 |
| 2009-05-01 00:00:00 | 0.038  | 0.035  | 0.049  | 0.052  | 0.037  | 0.052  | 0.049  | 0.081  | 0.072  | 0.145  | 0.107  |
| 2009-06-01 00:00:00 | 0.138  | 0.163  |  0.12  | 0.155  | 0.136  |  0.13  | 0.166  | 0.167  | 0.179  | 0.195  | 0.057  |
| 2009-07-01 00:00:00 | -0.155 | -0.136 | -0.135 | -0.147 | -0.146 | -0.168 | -0.171 | -0.177 | -0.194 | -0.245 | -0.09  |
| 2009-08-01 00:00:00 | 0.022  | 0.022  | 0.049  |  0.02  | 0.032  | 0.035  | 0.036  | 0.046  | 0.045  | 0.049  | 0.028  |
| 2009-09-01 00:00:00 | 0.125  | 0.117  | 0.133  | 0.126  | 0.133  | 0.115  | 0.108  |  0.11  | 0.107  | 0.085  | -0.039 |
| 2009-10-01 00:00:00 |  0.16  | 0.155  | 0.174  | 0.175  | 0.151  | 0.147  | 0.142  | 0.112  | 0.103  | 0.078  | -0.082 |
| 2009-11-01 00:00:00 | 0.038  | 0.027  |  0.03  | 0.029  | 0.024  | 0.001  | 0.005  | -0.001 | -0.006 | 0.008  | -0.03  |
| 2009-12-01 00:00:00 | -0.02  | -0.026 | -0.024 | -0.042 | -0.012 | -0.019 | -0.038 | -0.04  | -0.075 | -0.103 | -0.084 |
| 2010-01-01 00:00:00 | 0.068  | 0.062  | 0.059  | 0.073  | 0.055  | 0.057  | 0.058  | 0.047  | 0.039  | 0.021  | -0.048 |
| 2010-02-01 00:00:00 | 0.055  | 0.037  | 0.043  | 0.043  | 0.053  | 0.043  | 0.009  |  0.01  | 0.016  | 0.015  | -0.04  |
| 2010-03-01 00:00:00 | -0.085 | -0.067 | -0.082 | -0.071 | -0.059 | -0.083 | -0.078 | -0.053 | -0.067 | -0.081 | 0.004  |
| 2010-04-01 00:00:00 | -0.088 | -0.092 | -0.095 | -0.075 | -0.067 | -0.079 | -0.072 | -0.071 | -0.081 | -0.094 | -0.006 |
| 2010-05-01 00:00:00 | -0.081 | -0.097 | -0.083 | -0.099 | -0.092 | -0.103 | -0.099 | -0.098 | -0.097 | -0.077 | 0.005  |
| 2010-06-01 00:00:00 | 0.147  | 0.149  | 0.151  |  0.17  | 0.148  | 0.142  | 0.132  | 0.133  | 0.135  | 0.131  | -0.016 |
| 2010-07-01 00:00:00 | 0.108  | 0.112  | 0.098  | 0.094  | 0.081  | 0.085  | 0.122  | 0.079  | 0.059  | 0.019  | -0.089 |
| 2010-08-01 00:00:00 | -0.004 | 0.009  | 0.012  | -0.004 | -0.016 | 0.008  | 0.013  | 0.015  | 0.019  | 0.017  | 0.021  |
| 2010-09-01 00:00:00 | 0.108  | 0.074  | 0.085  | 0.097  |  0.08  | 0.103  | 0.105  | 0.092  | 0.148  | 0.155  | 0.047  |
| 2010-10-01 00:00:00 | 0.036  | 0.021  | 0.002  | 0.015  |  0.01  | 0.019  |  0.02  | -0.001 | -0.035 | -0.066 | -0.102 |
| 2010-11-01 00:00:00 | -0.024 | -0.025 | -0.031 | -0.036 | -0.026 | -0.035 | -0.034 | -0.02  | -0.006 | 0.006  |  0.03  |
| 2010-12-01 00:00:00 | -0.058 | -0.061 | -0.059 | -0.05  | -0.074 | -0.064 | -0.068 | -0.067 | -0.051 | -0.018 |  0.04  |
| 2011-01-01 00:00:00 | 0.098  | 0.093  |  0.11  | 0.096  | 0.105  | 0.103  | 0.101  | 0.097  | 0.069  | 0.052  | -0.046 |
| 2011-02-01 00:00:00 | 0.004  | -0.018 | -0.023 | -0.017 | -0.026 | -0.038 | -0.023 | -0.027 | -0.033 | -0.02  | -0.024 |
| 2011-03-01 00:00:00 | -0.054 | -0.036 | -0.052 | -0.05  | -0.027 | -0.035 | -0.039 | -0.039 | -0.02  | -0.022 | 0.032  |
| 2011-04-01 00:00:00 | -0.081 | -0.067 | -0.055 | -0.083 | -0.082 | -0.076 | -0.084 | -0.085 | -0.077 | -0.066 | 0.016  |
| 2011-05-01 00:00:00 | 0.034  | 0.031  | 0.042  | 0.023  | 0.041  | 0.032  | 0.031  | 0.036  |  0.03  |  0.03  | -0.004 |
| 2011-06-01 00:00:00 | 0.033  | 0.026  | 0.038  | 0.021  | 0.017  | 0.022  | 0.024  | 0.016  |  -0.0  | -0.017 | -0.05  |
| 2011-07-01 00:00:00 | -0.017 | -0.032 | -0.026 | -0.032 | -0.036 | -0.034 | -0.034 | -0.047 | -0.041 | -0.054 | -0.036 |
| 2011-08-01 00:00:00 | -0.123 | -0.115 | -0.124 | -0.131 | -0.136 | -0.128 | -0.141 | -0.125 | -0.111 | -0.093 | 0.029  |
| 2011-09-01 00:00:00 | 0.041  | 0.045  | 0.046  | 0.041  | 0.047  | 0.026  | 0.052  | 0.045  | 0.036  | 0.034  | -0.006 |
| 2011-10-01 00:00:00 | -0.045 | -0.038 | -0.029 | -0.04  | -0.041 | -0.042 | -0.045 | -0.049 | -0.056 | -0.069 | -0.024 |
| 2011-11-01 00:00:00 | -0.17  | -0.17  | -0.174 | -0.151 | -0.164 | -0.159 | -0.137 | -0.13  | -0.102 | -0.082 | 0.087  |
| 2011-12-01 00:00:00 | -0.016 | -0.018 | -0.006 | -0.018 | -0.018 | 0.003  | -0.013 |  -0.0  | -0.002 | 0.045  | 0.062  |
| 2012-01-01 00:00:00 | 0.143  | 0.138  | 0.135  | 0.136  | 0.129  | 0.128  | 0.131  | 0.119  | 0.109  | 0.072  | -0.071 |
| 2012-02-01 00:00:00 | -0.081 | -0.061 | -0.075 | -0.08  | -0.077 | -0.078 | -0.073 | -0.079 | -0.071 | -0.074 | 0.007  |
| 2012-03-01 00:00:00 | 0.088  | 0.069  | 0.064  | 0.073  |  0.07  | 0.064  | 0.063  | 0.053  | 0.063  | 0.072  | -0.016 |
| 2012-04-01 00:00:00 | 0.022  | 0.024  | 0.025  | 0.017  | 0.017  | 0.033  | 0.024  | 0.028  | 0.038  | 0.008  | -0.014 |
| 2012-05-01 00:00:00 | -0.06  | -0.06  | -0.061 | -0.073 | -0.067 | -0.066 | -0.071 | -0.071 | -0.058 | -0.057 | 0.003  |
| 2012-06-01 00:00:00 | -0.11  | -0.094 | -0.092 | -0.103 | -0.099 | -0.089 | -0.087 | -0.082 | -0.075 | -0.054 | 0.057  |
| 2012-07-01 00:00:00 | 0.042  | 0.045  | 0.033  | 0.026  | 0.033  |  0.0   |  0.01  | -0.022 | -0.034 | -0.056 | -0.098 |
| 2012-08-01 00:00:00 | 0.003  | 0.004  | 0.002  | -0.005 | 0.004  | 0.002  | 0.022  | 0.007  | 0.029  | 0.044  |  0.04  |
| 2012-09-01 00:00:00 | -0.004 | 0.002  | 0.008  |  -0.0  | -0.015 |  0.0   | -0.012 | -0.02  | -0.017 | -0.016 | -0.012 |
| 2012-10-01 00:00:00 | -0.119 | -0.121 | -0.125 | -0.113 | -0.124 | -0.113 | -0.123 | -0.103 | -0.097 | -0.059 |  0.06  |
| 2012-11-01 00:00:00 | 0.164  | 0.178  | 0.184  | 0.163  | 0.163  | 0.182  | 0.181  | 0.166  | 0.171  | 0.172  | 0.008  |
| 2012-12-01 00:00:00 |  0.07  | 0.072  | 0.066  | 0.069  | 0.065  | 0.054  | 0.065  | 0.061  | 0.049  | 0.057  | -0.013 |
| 2013-01-01 00:00:00 | 0.044  | 0.033  | 0.036  | 0.037  | 0.038  | 0.043  | 0.042  | 0.039  | 0.024  | -0.004 | -0.047 |
| 2013-02-01 00:00:00 | -0.032 | -0.024 | -0.031 | -0.027 | -0.047 | -0.041 | -0.047 | -0.057 | -0.04  | -0.05  | -0.018 |
| 2013-03-01 00:00:00 | -0.032 | -0.032 | -0.025 | -0.026 | -0.031 | -0.027 | -0.019 | -0.017 | -0.026 | -0.021 | 0.011  |
| 2013-04-01 00:00:00 | 0.158  | 0.154  | 0.147  | 0.142  | 0.152  | 0.156  |  0.15  | 0.125  | 0.125  | 0.067  | -0.091 |
| 2013-05-01 00:00:00 | -0.16  | -0.157 | -0.157 | -0.157 | -0.154 | -0.154 | -0.164 | -0.151 | -0.154 | -0.136 | 0.024  |
| 2013-06-01 00:00:00 | 0.073  | 0.084  | 0.079  | 0.069  | 0.054  |  0.07  | 0.073  | 0.045  | 0.062  | 0.014  | -0.058 |
| 2013-07-01 00:00:00 | 0.102  | 0.093  | 0.076  | 0.064  | 0.102  | 0.072  | 0.082  | 0.063  | 0.069  | 0.058  | -0.045 |
| 2013-08-01 00:00:00 | 0.053  | 0.064  | 0.046  | 0.045  | 0.048  | 0.061  | 0.043  | 0.051  |  0.07  | 0.047  | -0.006 |
| 2013-09-01 00:00:00 | -0.025 | -0.023 | -0.016 | -0.035 | -0.039 | -0.033 | -0.034 | -0.029 | -0.034 | -0.04  | -0.014 |
| 2013-10-01 00:00:00 | 0.092  | 0.095  | 0.083  | 0.083  | 0.084  | 0.083  | 0.055  | 0.063  | 0.052  | 0.039  | -0.054 |
| 2013-11-01 00:00:00 | -0.034 | -0.029 | -0.038 | -0.032 | -0.045 | -0.027 | -0.028 | -0.047 | -0.033 | -0.046 | -0.012 |
| 2013-12-01 00:00:00 | 0.001  | 0.017  | 0.038  | 0.057  | 0.027  | 0.002  | 0.036  | 0.002  | 0.012  | -0.052 | -0.053 |
| 2014-01-01 00:00:00 | 0.047  | 0.042  | 0.044  | 0.044  | 0.045  | 0.015  | 0.023  | 0.016  | -0.003 | -0.021 | -0.068 |
| 2014-02-01 00:00:00 | -0.023 | -0.02  | -0.04  | -0.038 | -0.039 | -0.039 | -0.043 | -0.051 | -0.041 | -0.028 | -0.005 |
| 2014-03-01 00:00:00 | -0.009 | -0.027 | -0.031 | -0.028 | -0.026 | -0.012 | -0.018 | -0.026 | -0.009 | -0.005 | 0.005  |
| 2014-04-01 00:00:00 | 0.027  | 0.035  | 0.034  | 0.028  |  0.05  | 0.025  |  0.02  | 0.022  | 0.018  | 0.002  | -0.024 |
| 2014-05-01 00:00:00 | 0.064  | 0.059  | 0.046  | 0.054  | 0.055  | 0.031  | 0.037  | 0.038  | 0.026  | 0.019  | -0.045 |
| 2014-06-01 00:00:00 |  0.09  | 0.076  | 0.076  | 0.068  |  0.06  | 0.082  | 0.075  | 0.067  | 0.065  | 0.079  | -0.012 |
| 2014-07-01 00:00:00 | 0.065  |  0.06  |  0.06  | 0.054  | 0.044  | 0.057  | 0.038  | 0.053  | 0.041  | 0.004  | -0.061 |
| 2014-08-01 00:00:00 | 0.152  | 0.141  | 0.143  | 0.124  | 0.119  | 0.114  | 0.127  | 0.101  |  0.09  | 0.064  | -0.089 |
| 2014-09-01 00:00:00 | 0.044  | 0.018  | 0.014  | 0.017  | 0.014  | 0.013  | 0.014  | 0.004  | 0.015  | 0.029  | -0.015 |
| 2014-10-01 00:00:00 | 0.067  | 0.049  | 0.062  |  0.07  | 0.045  |  0.04  | 0.048  | 0.055  | 0.076  | 0.123  | 0.056  |
| 2014-11-01 00:00:00 | -0.08  | -0.069 | -0.055 | -0.049 | -0.046 | -0.022 | 0.002  | -0.004 | 0.074  | 0.246  | 0.327  |
| 2014-12-01 00:00:00 | 0.108  | 0.105  | 0.094  | 0.097  | 0.087  | 0.068  | 0.077  | 0.082  | 0.062  | -0.026 | -0.135 |
| 2015-01-01 00:00:00 | 0.078  | 0.077  |  0.09  | 0.087  | 0.094  | 0.099  | 0.088  | 0.104  | 0.073  | 0.052  | -0.026 |
| 2015-02-01 00:00:00 | 0.259  | 0.235  | 0.248  | 0.252  | 0.229  | 0.214  | 0.228  | 0.209  | 0.184  | 0.142  | -0.116 |
| 2015-03-01 00:00:00 | 0.213  | 0.168  |  0.14  | 0.166  | 0.162  | 0.168  | 0.155  | 0.153  | 0.154  | 0.203  | -0.01  |
| 2015-04-01 00:00:00 | 0.302  | 0.264  | 0.261  | 0.253  | 0.252  | 0.252  | 0.204  | 0.182  | 0.119  | 0.036  | -0.266 |
| 2015-05-01 00:00:00 | -0.114 | -0.147 | -0.155 | -0.158 | -0.149 | -0.145 | -0.119 | -0.144 | -0.133 | -0.079 | 0.035  |
| 2015-06-01 00:00:00 | -0.212 | -0.204 | -0.201 | -0.192 | -0.177 | -0.176 | -0.15  | -0.17  | -0.154 | -0.159 | 0.052  |
| 2015-07-01 00:00:00 | -0.151 | -0.156 | -0.145 | -0.149 | -0.161 | -0.136 | -0.177 | -0.177 | -0.15  | -0.133 | 0.018  |
| 2015-08-01 00:00:00 | 0.012  |  0.0   | -0.017 | -0.004 | -0.016 | -0.022 | -0.028 | -0.045 | -0.062 | -0.053 | -0.065 |
| 2015-09-01 00:00:00 | 0.257  | 0.252  |  0.26  | 0.243  | 0.206  | 0.236  | 0.222  |  0.21  | 0.186  | 0.123  | -0.134 |
| 2015-10-01 00:00:00 | 0.152  | 0.146  | 0.116  | 0.116  | 0.096  | 0.063  | 0.069  | 0.049  | 0.024  | 0.009  | -0.143 |
| 2015-11-01 00:00:00 |  0.07  | 0.065  | 0.038  |  0.03  | 0.049  | 0.026  | 0.034  | 0.018  | 0.024  | 0.032  | -0.038 |
| 2015-12-01 00:00:00 | -0.309 | -0.309 | -0.31  | -0.31  | -0.311 | -0.295 | -0.301 | -0.308 | -0.278 | -0.243 | 0.066  |
| 2016-01-01 00:00:00 | -0.012 | -0.031 | -0.023 | -0.032 | -0.028 | -0.021 | -0.021 | -0.025 | -0.013 | -0.025 | -0.013 |
| 2016-02-01 00:00:00 | 0.204  |  0.21  | 0.204  | 0.209  | 0.196  |  0.19  | 0.172  | 0.171  | 0.162  | 0.132  | -0.072 |
| 2016-03-01 00:00:00 | 0.002  | -0.007 | -0.012 | -0.034 | -0.013 | -0.019 | -0.035 | -0.032 | -0.032 | -0.036 | -0.038 |
| 2016-04-01 00:00:00 | -0.017 | -0.009 | -0.006 | -0.012 |  0.0   | 0.007  | 0.002  | -0.01  | -0.005 | 0.001  | 0.018  |
| 2016-05-01 00:00:00 | 0.077  | 0.092  | 0.074  | 0.082  | 0.051  | 0.058  | 0.051  | 0.033  |  0.02  |  0.01  | -0.067 |
| 2016-06-01 00:00:00 | -0.012 | -0.011 | -0.029 | -0.014 | -0.022 | -0.033 | -0.007 | -0.017 | 0.031  | 0.028  | 0.041  |
| 2016-07-01 00:00:00 | 0.064  | 0.052  | 0.043  | 0.035  | 0.034  | 0.045  | 0.037  | 0.035  | 0.033  | 0.031  | -0.033 |
| 2016-08-01 00:00:00 | -0.025 | -0.015 | -0.015 | -0.021 | -0.028 | -0.028 | -0.026 | -0.029 | -0.03  | -0.034 | -0.009 |
| 2016-09-01 00:00:00 |  0.04  | 0.038  |  0.05  | 0.046  | 0.037  | 0.023  | 0.026  | 0.026  | 0.018  | 0.024  | -0.016 |
| 2016-10-01 00:00:00 |  0.03  | 0.016  | 0.029  | 0.025  | 0.014  | 0.015  | 0.016  | 0.014  | 0.036  | 0.045  | 0.015  |
| 2016-11-01 00:00:00 | -0.057 | -0.059 | -0.065 | -0.076 | -0.059 | -0.07  | -0.067 | -0.061 | -0.062 | -0.063 | -0.006 |
| 2016-12-01 00:00:00 | -0.037 | -0.036 | -0.041 | -0.035 | -0.032 | -0.03  | -0.03  | -0.018 | -0.008 | 0.012  | 0.049  |
| 2017-01-01 00:00:00 | 0.045  | 0.048  | 0.045  | 0.041  | 0.039  |  0.04  | 0.038  | 0.051  | 0.036  | 0.036  | -0.009 |
| 2017-02-01 00:00:00 | -0.017 | -0.025 | -0.022 | -0.015 | -0.017 | -0.022 | -0.01  | -0.016 | 0.002  | 0.002  |  0.02  |
| 2017-03-01 00:00:00 | -0.076 | -0.085 | -0.058 | -0.069 | -0.068 | -0.062 | -0.033 | -0.025 | -0.029 | -0.005 | 0.071  |
| 2017-04-01 00:00:00 | -0.085 | -0.089 | -0.084 | -0.075 | -0.083 | -0.069 | -0.073 | -0.061 | -0.059 | -0.009 | 0.075  |
| 2017-05-01 00:00:00 | 0.029  | 0.026  | 0.032  | 0.043  | 0.035  |  0.04  | 0.042  | 0.051  | 0.062  |  0.05  |  0.02  |
| 2017-06-01 00:00:00 | -0.013 | -0.014 | 0.005  | -0.008 | -0.004 | 0.016  | 0.004  | 0.023  | 0.019  | 0.021  | 0.034  |
| 2017-07-01 00:00:00 | 0.047  | 0.033  | 0.041  | 0.037  | 0.026  | 0.032  | 0.036  | 0.017  | 0.039  | 0.022  | -0.025 |
| 2017-08-01 00:00:00 | 0.008  | 0.021  | 0.007  | 0.016  | 0.017  | 0.017  | 0.012  | 0.017  | 0.002  | 0.005  | -0.003 |
| 2017-09-01 00:00:00 | -0.031 | -0.029 | -0.02  | -0.021 | -0.032 | -0.03  | -0.021 | -0.011 | -0.002 | 0.029  |  0.06  |
| 2017-10-01 00:00:00 | -0.087 | -0.079 | -0.085 | -0.068 | -0.066 | -0.057 | -0.053 | -0.044 | -0.047 | -0.022 | 0.065  |
| 2017-11-01 00:00:00 | -0.026 | -0.027 | -0.028 | -0.023 | -0.014 | -0.018 | -0.01  | -0.01  | -0.007 | 0.003  | 0.029  |
| 2017-12-01 00:00:00 | -0.05  | -0.041 | -0.039 | -0.039 | -0.031 | -0.022 | -0.021 | -0.023 | 0.009  | 0.036  | 0.086  |
| 2018-01-01 00:00:00 | -0.07  | -0.052 | -0.055 | -0.052 | -0.037 | -0.036 | -0.031 | -0.034 | -0.03  | -0.048 | 0.022  |
| 2018-02-01 00:00:00 | 0.068  | 0.056  | 0.056  | 0.054  | 0.038  | 0.032  | 0.035  | 0.017  | 0.005  | -0.022 | -0.09  |
| 2018-03-01 00:00:00 | -0.033 | -0.054 | -0.045 | -0.039 | -0.042 | -0.042 | -0.034 | -0.043 | -0.036 | -0.034 | -0.001 |
| 2018-04-01 00:00:00 | -0.019 | -0.026 | -0.024 | -0.006 | -0.013 | -0.018 | -0.016 | -0.01  | 0.003  | 0.014  | 0.032  |
| 2018-05-01 00:00:00 | -0.12  | -0.12  | -0.112 | -0.116 | -0.109 | -0.119 | -0.097 | -0.104 | -0.09  | -0.08  |  0.04  |
| 2018-06-01 00:00:00 | -0.004 | -0.012 | -0.017 | 0.002  | -0.007 | -0.022 | -0.001 | -0.003 | -0.003 | -0.002 | 0.001  |
| 2018-07-01 00:00:00 | -0.087 | -0.081 | -0.077 | -0.084 | -0.086 | -0.086 | -0.08  | -0.083 | -0.079 | -0.059 | 0.028  |
| 2018-08-01 00:00:00 | -0.01  | -0.011 | -0.017 | -0.014 | -0.008 |  0.0   | -0.02  | -0.005 | 0.003  | 0.019  | 0.029  |
| 2018-09-01 00:00:00 | -0.089 | -0.099 | -0.098 | -0.115 | -0.114 | -0.112 | -0.111 | -0.093 | -0.092 | -0.095 | -0.006 |
| 2018-10-01 00:00:00 | 0.062  | 0.065  | 0.073  | 0.062  | 0.043  | 0.066  | 0.038  | 0.035  | 0.025  | 0.008  | -0.054 |
| 2018-11-01 00:00:00 | -0.042 | -0.045 | -0.052 | -0.055 | -0.046 | -0.05  | -0.045 | -0.041 | -0.041 | -0.042 | -0.001 |
| 2018-12-01 00:00:00 | -0.038 | -0.032 | -0.03  | -0.017 | -0.024 | -0.013 | -0.023 | 0.003  | 0.015  | 0.029  | 0.068  |
| 2019-01-01 00:00:00 | 0.245  | 0.234  | 0.228  | 0.224  | 0.232  | 0.227  |  0.2   | 0.212  | 0.214  | 0.171  | -0.074 |
| 2019-02-01 00:00:00 | 0.111  | 0.097  | 0.114  | 0.102  | 0.115  | 0.099  | 0.106  | 0.102  | 0.096  | 0.063  | -0.048 |
| 2019-03-01 00:00:00 | -0.053 | -0.043 | -0.046 | -0.035 | -0.038 | -0.036 | -0.055 | -0.042 | -0.048 | -0.014 | 0.039  |
| 2019-04-01 00:00:00 | -0.051 | -0.052 | -0.052 | -0.047 | -0.053 | -0.064 | -0.065 | -0.07  | -0.07  | -0.065 | -0.015 |
| 2019-05-01 00:00:00 | -0.001 | -0.016 | 0.004  | -0.004 | -0.02  | -0.001 | -0.001 | 0.011  | 0.021  | 0.041  | 0.042  |
| 2019-06-01 00:00:00 | -0.026 | -0.029 | -0.021 | -0.03  | -0.028 | -0.015 | -0.018 | -0.013 |  -0.0  | 0.009  | 0.035  |
| 2019-07-01 00:00:00 | -0.01  | -0.01  | -0.008 | -0.004 | -0.012 | -0.01  |  -0.0  | -0.008 | -0.001 | -0.004 | 0.005  |
| 2019-08-01 00:00:00 | 0.022  | 0.013  | 0.012  | 0.009  | 0.007  | 0.014  | 0.018  | 0.003  |  0.02  | 0.004  | -0.018 |
| 2019-09-01 00:00:00 | -0.008 | -0.01  | -0.013 |  -0.0  | -0.015 | -0.001 | -0.008 | -0.006 | 0.001  | 0.011  | 0.019  |
| 2019-10-01 00:00:00 | -0.019 | -0.033 | -0.032 | -0.023 | -0.032 | -0.024 | -0.024 | -0.011 | -0.004 | -0.009 |  0.01  |
| 2019-11-01 00:00:00 | 0.082  | 0.081  | 0.073  | 0.091  | 0.078  | 0.078  | 0.084  | 0.077  | 0.084  | 0.079  | -0.003 |
| 2019-12-01 00:00:00 | 0.009  | -0.011 | 0.007  | 0.019  | 0.005  | 0.029  | 0.015  | 0.022  | 0.002  | 0.002  | -0.007 |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
+---------+-------+-------+-------+-------+------+-------+-------+-------+-------+-------+--------+
|  Group  |   1   |   2   |   3   |   4   |  5   |   6   |   7   |   8   |   9   |   10  |  Diff  |
+---------+-------+-------+-------+-------+------+-------+-------+-------+-------+-------+--------+
| Average | 0.014 | 0.012 | 0.011 |  0.01 | 0.01 | 0.008 | 0.009 | 0.008 | 0.009 | 0.008 | -0.006 |
|  T-Test | 2.105 | 1.805 |  1.77 | 1.668 | 1.63 |  1.39 | 1.587 | 1.316 | 1.682 | 1.512 | -1.48  |
+---------+-------+-------+-------+-------+------+-------+-------+-------+-------+-------+--------+
```

The first dataset contains no below 30% stocks from 2000-01-01 to 2019-12-01. The size effect is **insignificant** since the t-test statistics is -1.48 whose absolute value is no more than 2 corresponding to the significance level at 0.05.

```python
# %% dataset 2
# select stocks whose trading days are more than or equal to 10 days
test_data_2 = month_return[month_return['Ndaytrd']>=10]
# construct data for univariate analysis
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'Time']].dropna()
# time interval between 2000-01-01 to 2019-12-01
test_data_2 = test_data_2[(test_data_2['Time'] >= '2000-01-01') & (test_data_2['Time'] <= '2019-12-01')]
# using Univariate class to conduct analysis
uni_2 = Univariate(np.array(test_data_2), number=9)
uni_2.average_by_time()
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
==========================================================================================================================
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
|         Time        |   1    |   2    |   3    |   4    |   5    |   6    |   7    |   8    |   9    |   10   |  diff  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| 2000-01-01 00:00:00 | 0.164  | 0.167  | 0.126  | 0.139  | 0.131  |  0.12  | 0.118  | 0.094  | 0.113  | 0.125  | -0.039 |
| 2000-02-01 00:00:00 | 0.208  | 0.203  | 0.128  | 0.151  | 0.085  | 0.113  | 0.052  | 0.053  | 0.044  | 0.002  | -0.206 |
| 2000-03-01 00:00:00 | 0.001  | 0.035  | 0.019  | 0.006  | 0.024  | 0.012  | -0.008 | 0.017  | 0.014  | 0.032  | 0.032  |
| 2000-04-01 00:00:00 | 0.056  |  0.06  | 0.052  | 0.038  | 0.047  | 0.034  | 0.028  | 0.039  | 0.025  | 0.021  | -0.035 |
| 2000-05-01 00:00:00 | 0.019  | 0.021  | 0.032  |  0.02  | 0.044  | 0.019  | 0.024  | 0.014  | 0.031  | 0.034  | 0.015  |
| 2000-06-01 00:00:00 | 0.108  | 0.057  | 0.056  | 0.062  | 0.047  | 0.047  |  0.05  | 0.029  | 0.035  | 0.041  | -0.067 |
| 2000-07-01 00:00:00 | 0.053  | 0.039  | 0.023  | 0.009  | -0.001 | -0.002 | -0.006 | -0.015 | -0.007 | -0.021 | -0.074 |
| 2000-08-01 00:00:00 | 0.016  | -0.027 | -0.033 | -0.022 | -0.038 | -0.053 | -0.059 | -0.045 | -0.059 | -0.056 | -0.072 |
| 2000-09-01 00:00:00 | 0.065  | 0.058  | 0.049  | 0.048  | 0.034  | 0.035  | 0.026  | 0.029  | 0.014  | 0.007  | -0.057 |
| 2000-10-01 00:00:00 | 0.073  | 0.063  | 0.064  | 0.059  | 0.066  | 0.064  | 0.062  | 0.053  | 0.051  | 0.054  | -0.019 |
| 2000-11-01 00:00:00 | -0.002 | 0.028  | 0.025  | 0.008  | 0.014  | 0.005  | 0.006  | 0.011  | -0.003 | -0.024 | -0.023 |
| 2000-12-01 00:00:00 | -0.024 | -0.019 | -0.012 | -0.006 | -0.012 | -0.006 | -0.014 | -0.003 | -0.003 | -0.02  | 0.003  |
| 2001-01-01 00:00:00 | -0.098 | -0.062 | -0.067 | -0.072 | -0.062 | -0.062 | -0.052 | -0.064 | -0.051 | -0.049 |  0.05  |
| 2001-02-01 00:00:00 | 0.114  | 0.103  | 0.088  | 0.088  | 0.079  | 0.084  | 0.079  | 0.076  | 0.062  | 0.058  | -0.056 |
| 2001-03-01 00:00:00 |  0.04  | 0.019  | 0.001  | 0.012  | -0.005 | -0.003 | -0.009 | 0.002  | -0.014 | -0.015 | -0.055 |
| 2001-04-01 00:00:00 | 0.096  | 0.087  | 0.084  | 0.066  | 0.047  | 0.048  | 0.031  | 0.036  | 0.025  | 0.012  | -0.084 |
| 2001-05-01 00:00:00 | 0.016  | 0.007  | 0.017  | 0.016  |  0.01  | 0.013  | 0.011  | -0.001 | 0.005  | -0.006 | -0.022 |
| 2001-06-01 00:00:00 | -0.133 | -0.143 | -0.135 | -0.135 | -0.133 | -0.138 | -0.143 | -0.129 | -0.127 | -0.134 | -0.002 |
| 2001-07-01 00:00:00 | -0.001 | -0.013 | -0.021 | -0.03  | -0.037 | -0.037 | -0.041 | -0.04  | -0.032 | -0.043 | -0.042 |
| 2001-08-01 00:00:00 | -0.087 | -0.059 | -0.069 | -0.065 | -0.053 | -0.062 | -0.048 | -0.043 | -0.047 | -0.032 | 0.055  |
| 2001-09-01 00:00:00 | -0.057 | -0.064 | -0.059 | -0.058 | -0.056 | -0.057 | -0.065 | -0.046 | -0.056 | -0.033 | 0.024  |
| 2001-10-01 00:00:00 | 0.079  | 0.066  | 0.064  | 0.057  | 0.048  | 0.051  | 0.039  | 0.042  | 0.035  | 0.027  | -0.052 |
| 2001-11-01 00:00:00 | -0.09  | -0.083 | -0.077 | -0.073 | -0.072 | -0.075 | -0.064 | -0.067 | -0.054 | -0.047 | 0.044  |
| 2001-12-01 00:00:00 | -0.166 | -0.135 | -0.149 | -0.142 | -0.126 | -0.123 | -0.115 | -0.109 | -0.095 | -0.067 | 0.099  |
| 2002-01-01 00:00:00 | 0.095  | 0.052  | 0.041  | 0.038  | 0.044  | 0.036  | 0.029  |  0.03  | 0.018  | 0.014  | -0.081 |
| 2002-02-01 00:00:00 | 0.102  | 0.099  |  0.09  | 0.089  | 0.081  | 0.075  | 0.072  | 0.073  | 0.062  | 0.037  | -0.065 |
| 2002-03-01 00:00:00 | 0.081  | 0.067  | 0.054  | 0.057  | 0.055  | 0.041  | 0.045  | 0.032  | 0.037  | 0.031  | -0.049 |
| 2002-04-01 00:00:00 | -0.077 | -0.083 | -0.082 | -0.092 | -0.094 | -0.092 | -0.092 | -0.089 | -0.091 | -0.081 | -0.004 |
| 2002-05-01 00:00:00 | 0.091  | 0.091  | 0.106  | 0.113  | 0.114  | 0.116  | 0.118  | 0.136  | 0.133  | 0.156  | 0.065  |
| 2002-06-01 00:00:00 | -0.026 | -0.032 | -0.034 | -0.033 | -0.034 | -0.036 | -0.043 | -0.04  | -0.047 | -0.042 | -0.016 |
| 2002-07-01 00:00:00 | 0.023  | 0.014  | 0.011  |  0.01  | 0.001  | 0.003  | 0.008  | 0.009  | 0.003  | 0.004  | -0.019 |
| 2002-08-01 00:00:00 | -0.063 | -0.06  | -0.055 | -0.059 | -0.06  | -0.062 | -0.057 | -0.053 | -0.047 | -0.049 | 0.014  |
| 2002-09-01 00:00:00 | -0.051 | -0.071 | -0.06  | -0.074 | -0.057 | -0.047 | -0.054 | -0.05  | -0.044 | -0.048 | 0.004  |
| 2002-10-01 00:00:00 | -0.097 | -0.091 | -0.09  | -0.089 | -0.085 | -0.08  | -0.073 | -0.076 | -0.05  | -0.038 | 0.059  |
| 2002-11-01 00:00:00 | -0.029 | -0.053 | -0.052 | -0.056 | -0.056 | -0.054 | -0.057 | -0.054 | -0.05  | -0.047 | -0.018 |
| 2002-12-01 00:00:00 | 0.134  | 0.123  | 0.113  | 0.114  | 0.098  | 0.101  | 0.092  |  0.08  | 0.075  |  0.09  | -0.044 |
| 2003-01-01 00:00:00 | 0.018  | 0.022  | 0.023  | 0.015  | 0.016  |  0.01  | 0.013  | 0.013  | 0.009  | 0.005  | -0.013 |
| 2003-02-01 00:00:00 | -0.042 | -0.031 | -0.042 | -0.034 | -0.033 | -0.033 | -0.021 | -0.022 | -0.007 |  0.01  | 0.052  |
| 2003-03-01 00:00:00 | -0.094 | -0.067 | -0.081 | -0.067 | -0.038 | -0.051 | -0.035 | -0.011 | 0.005  | 0.021  | 0.115  |
| 2003-04-01 00:00:00 | 0.037  | 0.039  | 0.028  | 0.032  | 0.034  | 0.037  | 0.038  | 0.049  | 0.054  | 0.055  | 0.018  |
| 2003-05-01 00:00:00 | -0.055 | -0.061 | -0.068 | -0.066 | -0.07  | -0.072 | -0.075 | -0.079 | -0.057 | -0.065 | -0.01  |
| 2003-06-01 00:00:00 | -0.05  | -0.049 | -0.041 | -0.039 | -0.037 | -0.036 | -0.03  | -0.023 | -0.007 | 0.013  | 0.063  |
| 2003-07-01 00:00:00 | -0.001 | -0.014 | -0.016 | -0.017 | -0.023 | -0.037 | -0.034 | -0.033 | -0.021 | -0.043 | -0.042 |
| 2003-08-01 00:00:00 | -0.054 | -0.056 | -0.053 | -0.043 | -0.051 | -0.037 | -0.035 | -0.046 | -0.047 | -0.037 | 0.017  |
| 2003-09-01 00:00:00 | -0.114 | -0.096 | -0.086 | -0.08  | -0.075 | -0.065 | -0.066 | -0.044 | -0.028 | 0.003  | 0.117  |
| 2003-10-01 00:00:00 | 0.002  | 0.003  | 0.009  | 0.012  | 0.024  | 0.029  | 0.028  | 0.026  | 0.014  | 0.024  | 0.022  |
| 2003-11-01 00:00:00 | -0.069 | -0.038 | -0.033 | -0.016 | -0.034 | -0.006 | 0.004  | 0.025  | 0.032  |  0.07  | 0.138  |
| 2003-12-01 00:00:00 | 0.111  | 0.105  | 0.102  | 0.096  | 0.099  | 0.097  | 0.084  | 0.068  | 0.073  | 0.052  | -0.058 |
| 2004-01-01 00:00:00 | 0.145  | 0.125  | 0.102  |  0.12  |  0.08  | 0.104  | 0.091  | 0.076  | 0.074  | 0.056  | -0.089 |
| 2004-02-01 00:00:00 | 0.048  | 0.055  | 0.054  | 0.044  | 0.035  | 0.055  | 0.038  | 0.033  | 0.034  | 0.026  | -0.022 |
| 2004-03-01 00:00:00 | -0.115 | -0.124 | -0.105 | -0.098 | -0.093 | -0.098 | -0.095 | -0.084 | -0.096 | -0.107 | 0.008  |
| 2004-04-01 00:00:00 | 0.017  | -0.013 | -0.009 | -0.03  | -0.003 | -0.025 | -0.021 | -0.025 | -0.023 | -0.033 | -0.049 |
| 2004-05-01 00:00:00 | -0.139 | -0.132 | -0.13  | -0.128 | -0.134 | -0.132 | -0.13  | -0.116 | -0.122 | -0.091 | 0.048  |
| 2004-06-01 00:00:00 | -0.072 | -0.059 | -0.054 | -0.025 | -0.027 | -0.023 |  0.01  | 0.005  | 0.014  | 0.008  |  0.08  |
| 2004-07-01 00:00:00 | -0.066 | -0.061 | -0.053 | -0.05  | -0.047 | -0.055 | -0.061 | -0.064 | -0.061 | -0.032 | 0.034  |
| 2004-08-01 00:00:00 | 0.031  | 0.051  | 0.053  | 0.056  | 0.048  | 0.051  | 0.056  | 0.057  |  0.06  | 0.059  | 0.028  |
| 2004-09-01 00:00:00 | -0.129 | -0.091 | -0.081 | -0.067 | -0.066 | -0.053 | -0.064 | -0.058 | -0.028 | -0.04  | 0.089  |
| 2004-10-01 00:00:00 | 0.109  | 0.063  |  0.06  | 0.056  | 0.047  | 0.048  | 0.037  | 0.041  |  0.01  | -0.001 | -0.11  |
| 2004-11-01 00:00:00 | -0.089 | -0.092 | -0.093 | -0.077 | -0.086 | -0.08  | -0.091 | -0.08  | -0.07  | -0.056 | 0.033  |
| 2004-12-01 00:00:00 | -0.045 | -0.062 | -0.084 | -0.077 | -0.081 | -0.075 | -0.084 | -0.076 | -0.078 | -0.052 | -0.006 |
| 2005-01-01 00:00:00 | 0.114  | 0.105  | 0.112  | 0.113  | 0.109  | 0.102  | 0.118  | 0.115  | 0.094  | 0.092  | -0.022 |
| 2005-02-01 00:00:00 | -0.137 | -0.14  | -0.132 | -0.142 | -0.136 | -0.136 | -0.12  | -0.113 | -0.108 | -0.086 |  0.05  |
| 2005-03-01 00:00:00 | -0.14  | -0.125 | -0.092 | -0.096 | -0.081 | -0.053 | -0.065 | -0.037 | -0.026 | 0.004  | 0.144  |
| 2005-04-01 00:00:00 | 0.019  | -0.013 | -0.023 | -0.02  | -0.023 | -0.032 | -0.052 | -0.055 | -0.081 | -0.094 | -0.112 |
| 2005-05-01 00:00:00 | 0.001  |  0.0   | -0.001 | 0.004  | -0.003 | -0.001 | -0.006 | -0.001 | -0.002 | 0.029  | 0.028  |
| 2005-06-01 00:00:00 |  -0.1  |  -0.1  | -0.083 | -0.08  | -0.073 | -0.068 | -0.064 | -0.054 | -0.028 | 0.011  | 0.111  |
| 2005-07-01 00:00:00 | 0.258  | 0.196  | 0.192  | 0.174  | 0.173  | 0.152  | 0.136  | 0.124  | 0.119  |  0.05  | -0.208 |
| 2005-08-01 00:00:00 | 0.081  | 0.027  | 0.031  | 0.025  | -0.002 | 0.027  | 0.029  | 0.029  | 0.027  | -0.004 | -0.085 |
| 2005-09-01 00:00:00 | -0.083 | -0.056 | -0.06  | -0.067 | -0.058 | -0.052 | -0.056 | -0.056 | -0.048 | -0.052 | 0.031  |
| 2005-10-01 00:00:00 | 0.032  | 0.028  | 0.037  | 0.017  | 0.015  |  0.01  | 0.013  | -0.003 | -0.014 | -0.012 | -0.044 |
| 2005-11-01 00:00:00 | -0.011 | -0.005 | 0.001  | 0.017  | 0.012  | 0.023  | 0.032  | 0.053  | 0.067  | 0.073  | 0.085  |
| 2005-12-01 00:00:00 | -0.008 | 0.056  | 0.076  |  0.09  | 0.078  | 0.091  |  0.11  |  0.13  | 0.127  | 0.096  | 0.104  |
| 2006-01-01 00:00:00 | 0.094  | 0.047  | 0.026  | 0.032  | 0.021  | 0.022  | 0.017  | 0.019  | -0.001 | 0.043  | -0.051 |
| 2006-02-01 00:00:00 | -0.037 | -0.008 | -0.004 | -0.002 | 0.004  | 0.006  | 0.031  | 0.028  | 0.057  | 0.027  | 0.064  |
| 2006-03-01 00:00:00 | 0.139  | 0.007  | 0.082  |  0.08  | 0.099  | 0.113  | 0.105  | 0.133  | 0.139  | 0.151  | 0.011  |
| 2006-04-01 00:00:00 |  1.07  | 0.313  | 0.307  | 0.308  | 0.274  | 0.269  | 0.258  | 0.237  | 0.213  | 0.164  | -0.906 |
| 2006-05-01 00:00:00 |  0.07  | 0.079  | 0.066  | 0.083  | 0.065  | 0.071  | 0.039  | 0.053  | 0.024  | 0.021  | -0.049 |
| 2006-06-01 00:00:00 | 0.001  | 0.005  | -0.014 | -0.012 | -0.037 | -0.028 | -0.041 | -0.059 | -0.047 | -0.084 | -0.085 |
| 2006-07-01 00:00:00 | 0.022  |  0.03  | 0.025  | 0.023  | 0.032  | 0.033  | 0.035  | 0.045  |  0.04  | 0.027  | 0.005  |
| 2006-08-01 00:00:00 | 0.113  | 0.065  | 0.062  | 0.049  | 0.052  | 0.041  | 0.046  | 0.036  | 0.037  | 0.043  | -0.07  |
| 2006-09-01 00:00:00 | -0.01  | -0.013 | -0.018 | -0.002 | 0.016  | -0.017 | -0.011 |  -0.0  | 0.019  | 0.029  | 0.039  |
| 2006-10-01 00:00:00 | -0.011 | -0.007 | -0.003 | 0.022  | 0.025  | 0.035  | 0.063  | 0.059  | 0.105  | 0.171  | 0.182  |
| 2006-11-01 00:00:00 | 0.011  | 0.036  | 0.035  |  0.05  | 0.035  | 0.042  | 0.069  | 0.085  | 0.095  | 0.153  | 0.141  |
| 2006-12-01 00:00:00 | 0.305  | 0.269  |  0.26  | 0.286  | 0.257  |  0.25  | 0.224  | 0.234  | 0.241  |  0.19  | -0.115 |
| 2007-01-01 00:00:00 | 0.257  | 0.244  | 0.241  | 0.223  | 0.217  | 0.186  | 0.245  | 0.136  |  0.15  | 0.083  | -0.175 |
| 2007-02-01 00:00:00 | 0.272  | 0.261  | 0.216  | 0.204  | 0.191  | 0.164  | 0.175  | 0.143  | 0.085  | 0.087  | -0.185 |
| 2007-03-01 00:00:00 | 0.332  | 0.329  | 0.343  | 0.363  | 0.339  | 0.322  | 0.336  | 0.348  | 0.347  | 0.283  | -0.049 |
| 2007-04-01 00:00:00 | 0.199  | 0.088  | 0.089  | 0.081  | 0.071  | 0.131  | 0.111  | 0.079  | 0.106  | 0.135  | -0.064 |
| 2007-05-01 00:00:00 | -0.22  | -0.23  | -0.216 | -0.211 | -0.189 | -0.155 | -0.159 | -0.13  | -0.092 | -0.04  | 0.181  |
| 2007-06-01 00:00:00 | 0.296  | 0.287  | 0.278  | 0.244  | 0.236  | 0.236  | 0.212  | 0.186  | 0.189  | 0.185  | -0.111 |
| 2007-07-01 00:00:00 | 0.198  | 0.127  | 0.104  | 0.099  | 0.094  | 0.096  | 0.115  | 0.108  | 0.143  |  0.18  | -0.018 |
| 2007-08-01 00:00:00 | 0.046  | 0.016  | 0.018  | 0.025  | 0.035  | 0.042  | 0.029  |  0.04  | 0.054  | 0.075  | 0.029  |
| 2007-09-01 00:00:00 | -0.124 | -0.139 | -0.115 | -0.117 | -0.121 | -0.099 | -0.117 | -0.097 | -0.084 | -0.007 | 0.117  |
| 2007-10-01 00:00:00 | 0.009  | -0.013 | -0.019 | -0.052 | -0.049 | -0.075 | -0.08  |  -0.1  | -0.134 | -0.187 | -0.196 |
| 2007-11-01 00:00:00 | 0.184  | 0.205  | 0.204  | 0.208  |  0.21  |  0.21  |  0.22  | 0.216  |  0.2   | 0.148  | -0.036 |
| 2007-12-01 00:00:00 | -0.054 | -0.06  | -0.063 | -0.051 | -0.077 | -0.047 | -0.059 | -0.069 | -0.084 | -0.12  | -0.067 |
| 2008-01-01 00:00:00 | 0.116  | 0.109  | 0.117  | 0.107  | 0.101  | 0.083  | 0.076  | 0.065  | 0.043  | 0.017  | -0.099 |
| 2008-02-01 00:00:00 | -0.174 | -0.171 | -0.181 | -0.182 | -0.199 | -0.201 | -0.199 | -0.217 | -0.224 | -0.212 | -0.039 |
| 2008-03-01 00:00:00 | -0.087 | -0.091 | -0.077 | -0.075 | -0.069 | -0.051 | -0.049 | -0.006 | 0.017  | 0.043  |  0.13  |
| 2008-04-01 00:00:00 | 0.006  | -0.007 | -0.008 | -0.003 | -0.026 | -0.039 | -0.027 | -0.059 | -0.048 | -0.078 | -0.084 |
| 2008-05-01 00:00:00 | -0.239 | -0.234 | -0.266 | -0.275 | -0.249 | -0.26  | -0.239 | -0.25  | -0.234 | -0.221 | 0.018  |
| 2008-06-01 00:00:00 | 0.137  | 0.118  | 0.116  | 0.111  | 0.108  | 0.103  | 0.072  | 0.076  | 0.052  | 0.005  | -0.132 |
| 2008-07-01 00:00:00 | -0.207 | -0.224 | -0.227 | -0.233 | -0.223 | -0.238 | -0.241 | -0.238 | -0.229 | -0.194 | 0.013  |
| 2008-08-01 00:00:00 | -0.117 | -0.104 | -0.09  | -0.098 | -0.101 | -0.08  | -0.085 | -0.061 | -0.044 | -0.026 |  0.09  |
| 2008-09-01 00:00:00 | -0.225 | -0.232 | -0.249 | -0.265 | -0.247 | -0.266 | -0.272 | -0.262 | -0.275 | -0.248 | -0.023 |
| 2008-10-01 00:00:00 | 0.231  | 0.215  | 0.219  | 0.221  | 0.225  | 0.223  | 0.185  | 0.161  | 0.157  | 0.131  | -0.101 |
| 2008-11-01 00:00:00 | 0.155  |  0.13  | 0.094  | 0.097  | 0.061  | 0.068  | 0.053  | 0.065  | 0.041  | 0.013  | -0.142 |
| 2008-12-01 00:00:00 | 0.149  | 0.161  | 0.163  | 0.159  | 0.162  | 0.187  | 0.162  | 0.169  | 0.158  | 0.119  | -0.03  |
| 2009-01-01 00:00:00 | 0.124  | 0.116  | 0.094  | 0.084  | 0.092  |  0.09  | 0.073  | 0.081  | 0.057  | 0.063  | -0.061 |
| 2009-02-01 00:00:00 | 0.255  | 0.254  | 0.235  | 0.246  | 0.226  | 0.224  |  0.21  | 0.209  | 0.198  | 0.186  | -0.069 |
| 2009-03-01 00:00:00 | 0.102  |  0.11  | 0.078  | 0.074  | 0.081  | 0.073  | 0.038  | 0.066  | 0.041  |  0.05  | -0.052 |
| 2009-04-01 00:00:00 | 0.096  | 0.092  | 0.106  |  0.07  | 0.085  | 0.062  | 0.057  | 0.047  | 0.045  | 0.056  | -0.041 |
| 2009-05-01 00:00:00 | 0.112  | 0.081  | 0.061  | 0.039  |  0.04  | 0.055  | 0.039  | 0.053  | 0.078  | 0.124  | 0.012  |
| 2009-06-01 00:00:00 | 0.134  | 0.125  | 0.133  | 0.136  | 0.143  | 0.155  | 0.129  | 0.153  | 0.182  | 0.183  |  0.05  |
| 2009-07-01 00:00:00 | -0.124 | -0.141 | -0.151 | -0.144 | -0.147 | -0.139 | -0.155 | -0.171 | -0.18  | -0.236 | -0.112 |
| 2009-08-01 00:00:00 | 0.055  | 0.041  | 0.044  | 0.024  |  0.03  | 0.037  | 0.032  | 0.035  |  0.04  | 0.052  | -0.003 |
| 2009-09-01 00:00:00 | 0.124  | 0.133  | 0.129  | 0.128  |  0.12  | 0.132  |  0.12  | 0.112  | 0.108  | 0.092  | -0.032 |
| 2009-10-01 00:00:00 | 0.167  | 0.173  | 0.153  | 0.158  | 0.163  | 0.178  | 0.144  | 0.142  | 0.109  | 0.084  | -0.083 |
| 2009-11-01 00:00:00 | 0.052  | 0.039  | 0.035  | 0.029  | 0.035  | 0.032  | 0.006  | 0.005  | -0.005 | 0.004  | -0.048 |
| 2009-12-01 00:00:00 | -0.016 | -0.011 | -0.033 | -0.026 | -0.018 | -0.031 | -0.019 | -0.035 | -0.049 |  -0.1  | -0.084 |
| 2010-01-01 00:00:00 |  0.09  | 0.082  | 0.078  | 0.064  | 0.061  | 0.068  | 0.059  | 0.057  | 0.043  | 0.025  | -0.065 |
| 2010-02-01 00:00:00 | 0.086  | 0.067  | 0.064  | 0.053  | 0.039  | 0.042  | 0.046  | 0.017  | 0.017  | 0.011  | -0.075 |
| 2010-03-01 00:00:00 | -0.056 | -0.063 | -0.082 | -0.084 | -0.072 | -0.068 | -0.07  | -0.078 | -0.063 | -0.073 | -0.017 |
| 2010-04-01 00:00:00 | -0.088 | -0.08  | -0.073 | -0.088 | -0.094 | -0.077 | -0.08  | -0.065 | -0.078 | -0.089 |  -0.0  |
| 2010-05-01 00:00:00 | -0.082 | -0.083 | -0.087 | -0.083 | -0.091 | -0.094 | -0.099 | -0.101 | -0.098 | -0.081 | 0.001  |
| 2010-06-01 00:00:00 | 0.168  | 0.164  | 0.153  | 0.149  | 0.149  | 0.164  | 0.143  | 0.138  | 0.133  |  0.13  | -0.038 |
| 2010-07-01 00:00:00 | 0.107  | 0.106  |  0.09  | 0.113  | 0.097  | 0.096  | 0.084  | 0.109  | 0.075  | 0.027  | -0.08  |
| 2010-08-01 00:00:00 | 0.025  | -0.012 | -0.007 | 0.002  | 0.007  | -0.004 | -0.008 | 0.016  |  0.02  | 0.016  | -0.009 |
| 2010-09-01 00:00:00 | 0.062  | 0.078  | 0.074  | 0.098  | 0.082  | 0.091  | 0.093  | 0.098  | 0.114  | 0.156  | 0.094  |
| 2010-10-01 00:00:00 | 0.039  | 0.036  |  0.04  | 0.028  | 0.014  | 0.012  | 0.016  | 0.018  | -0.015 | -0.06  | -0.099 |
| 2010-11-01 00:00:00 | -0.007 | -0.023 | -0.015 | -0.024 | -0.029 | -0.035 | -0.027 | -0.034 | -0.018 | 0.007  | 0.014  |
| 2010-12-01 00:00:00 | -0.031 | -0.055 | -0.053 | -0.059 | -0.06  | -0.058 | -0.067 | -0.065 | -0.065 | -0.025 | 0.006  |
| 2011-01-01 00:00:00 | 0.099  | 0.104  | 0.101  | 0.093  | 0.106  | 0.096  | 0.105  | 0.102  | 0.085  | 0.059  | -0.04  |
| 2011-02-01 00:00:00 | 0.034  | 0.004  | -0.008 | -0.001 | -0.019 | -0.024 | -0.036 | -0.022 | -0.027 | -0.027 | -0.06  |
| 2011-03-01 00:00:00 | -0.029 | -0.04  | -0.039 | -0.051 | -0.046 | -0.046 | -0.029 | -0.037 | -0.034 | -0.019 |  0.01  |
| 2011-04-01 00:00:00 | -0.062 | -0.074 | -0.068 | -0.075 | -0.06  | -0.081 | -0.081 | -0.081 | -0.083 | -0.067 | -0.005 |
| 2011-05-01 00:00:00 | 0.044  | 0.045  | 0.035  |  0.03  | 0.046  | 0.025  | 0.034  | 0.032  | 0.036  | 0.029  | -0.015 |
| 2011-06-01 00:00:00 |  0.04  | 0.029  |  0.03  | 0.033  | 0.033  | 0.021  | 0.016  | 0.024  | 0.011  | -0.012 | -0.052 |
| 2011-07-01 00:00:00 | 0.008  | -0.009 | -0.014 | -0.019 | -0.031 | -0.031 | -0.035 | -0.033 | -0.047 | -0.052 | -0.06  |
| 2011-08-01 00:00:00 | -0.109 | -0.117 | -0.122 | -0.119 | -0.121 | -0.133 | -0.13  | -0.137 | -0.122 | -0.096 | 0.013  |
| 2011-09-01 00:00:00 | 0.054  | 0.044  | 0.046  |  0.04  | 0.046  | 0.044  | 0.039  | 0.046  | 0.039  | 0.035  | -0.019 |
| 2011-10-01 00:00:00 | -0.03  | -0.022 | -0.042 | -0.048 | -0.027 | -0.038 | -0.045 | -0.04  | -0.055 | -0.065 | -0.035 |
| 2011-11-01 00:00:00 | -0.177 | -0.178 | -0.169 | -0.171 | -0.172 | -0.152 | -0.164 | -0.142 | -0.12  | -0.085 | 0.092  |
| 2011-12-01 00:00:00 |  0.01  | -0.007 | -0.021 | -0.023 | -0.007 | -0.014 | -0.009 | -0.007 | -0.004 | 0.035  | 0.025  |
| 2012-01-01 00:00:00 |  0.16  | 0.155  | 0.149  | 0.142  | 0.137  | 0.136  | 0.127  | 0.127  | 0.117  | 0.082  | -0.078 |
| 2012-02-01 00:00:00 | -0.079 | -0.081 | -0.073 | -0.07  | -0.076 | -0.077 | -0.076 | -0.078 | -0.073 | -0.074 | 0.004  |
| 2012-03-01 00:00:00 | 0.061  | 0.064  | 0.069  | 0.084  | 0.065  | 0.068  | 0.072  |  0.06  | 0.057  | 0.069  | 0.008  |
| 2012-04-01 00:00:00 |  0.04  | 0.029  | 0.012  | 0.023  | 0.023  |  0.02  | 0.023  | 0.031  | 0.032  | 0.013  | -0.028 |
| 2012-05-01 00:00:00 | -0.018 | -0.035 | -0.055 | -0.058 | -0.061 | -0.07  | -0.068 | -0.071 | -0.062 | -0.061 | -0.043 |
| 2012-06-01 00:00:00 | -0.125 | -0.108 | -0.095 | -0.101 | -0.097 | -0.102 | -0.093 | -0.087 | -0.081 | -0.057 | 0.068  |
| 2012-07-01 00:00:00 | 0.068  | 0.064  | 0.055  | 0.047  | 0.032  | 0.033  | 0.013  | 0.005  | -0.023 | -0.053 | -0.121 |
| 2012-08-01 00:00:00 | 0.014  | 0.016  | -0.007 | 0.004  | 0.004  | -0.001 | -0.001 | 0.018  | 0.017  | 0.039  | 0.026  |
| 2012-09-01 00:00:00 | 0.012  |  0.01  | 0.004  | -0.001 | 0.003  |  -0.0  | -0.01  | -0.008 | -0.018 | -0.016 | -0.028 |
| 2012-10-01 00:00:00 | -0.095 | -0.12  | -0.115 | -0.12  | -0.122 | -0.116 | -0.124 | -0.116 | -0.105 | -0.066 | 0.029  |
| 2012-11-01 00:00:00 | 0.167  | 0.175  | 0.165  | 0.169  | 0.181  | 0.164  | 0.174  | 0.179  | 0.166  | 0.175  | 0.008  |
| 2012-12-01 00:00:00 | 0.062  | 0.057  | 0.073  | 0.071  | 0.071  | 0.064  | 0.059  | 0.065  | 0.056  | 0.054  | -0.008 |
| 2013-01-01 00:00:00 |  0.06  | 0.041  | 0.041  | 0.041  | 0.037  | 0.034  | 0.039  | 0.041  | 0.036  | 0.005  | -0.055 |
| 2013-02-01 00:00:00 | -0.025 | -0.026 | -0.017 | -0.03  | -0.03  | -0.025 | -0.048 | -0.045 | -0.047 | -0.053 | -0.028 |
| 2013-03-01 00:00:00 | -0.023 | -0.048 | -0.04  | -0.031 | -0.032 | -0.027 | -0.027 | -0.019 | -0.021 | -0.022 | 0.002  |
| 2013-04-01 00:00:00 | 0.177  | 0.155  | 0.157  | 0.153  | 0.153  | 0.146  | 0.151  | 0.152  | 0.132  | 0.076  | -0.102 |
| 2013-05-01 00:00:00 | -0.139 | -0.157 | -0.155 | -0.155 | -0.161 | -0.158 | -0.15  | -0.164 | -0.153 | -0.14  | -0.001 |
| 2013-06-01 00:00:00 | 0.123  | 0.086  | 0.072  | 0.075  | 0.083  | 0.063  | 0.063  | 0.072  | 0.051  | 0.028  | -0.095 |
| 2013-07-01 00:00:00 | 0.104  | 0.092  | 0.112  |  0.1   | 0.076  |  0.08  | 0.089  | 0.078  | 0.062  | 0.063  | -0.041 |
| 2013-08-01 00:00:00 | 0.076  | 0.053  | 0.052  | 0.053  | 0.059  | 0.043  | 0.056  | 0.049  | 0.056  | 0.054  | -0.021 |
| 2013-09-01 00:00:00 | -0.006 | -0.013 | -0.018 | -0.024 | -0.017 | -0.029 | -0.039 | -0.033 | -0.038 | -0.034 | -0.027 |
| 2013-10-01 00:00:00 | 0.131  | 0.128  | 0.111  | 0.086  | 0.097  | 0.083  | 0.076  | 0.068  | 0.055  | 0.044  | -0.087 |
| 2013-11-01 00:00:00 | -0.02  | -0.029 | -0.031 | -0.032 | -0.039 | -0.03  | -0.038 | -0.03  | -0.038 | -0.044 | -0.023 |
| 2013-12-01 00:00:00 | 0.035  | 0.062  | 0.024  |  0.01  | 0.031  | 0.046  | 0.007  | 0.035  | 0.004  | -0.031 | -0.066 |
| 2014-01-01 00:00:00 | 0.067  |  0.05  | 0.047  | 0.047  | 0.044  | 0.044  | 0.032  | 0.017  | 0.009  | -0.018 | -0.085 |
| 2014-02-01 00:00:00 | 0.025  | 0.003  | -0.013 | -0.021 | -0.033 | -0.037 | -0.042 | -0.043 | -0.043 | -0.036 | -0.061 |
| 2014-03-01 00:00:00 | 0.022  | 0.006  | -0.008 | -0.012 | -0.03  | -0.03  | -0.016 | -0.015 | -0.025 | -0.004 | -0.026 |
| 2014-04-01 00:00:00 | 0.115  | 0.055  | 0.048  | 0.027  | 0.036  | 0.032  | 0.037  | 0.022  |  0.02  | 0.008  | -0.107 |
| 2014-05-01 00:00:00 | 0.079  |  0.09  | 0.073  | 0.062  | 0.052  | 0.056  | 0.042  | 0.037  | 0.034  | 0.019  | -0.06  |
| 2014-06-01 00:00:00 | 0.104  | 0.075  | 0.075  | 0.083  | 0.077  | 0.069  | 0.072  | 0.072  | 0.066  | 0.077  | -0.027 |
| 2014-07-01 00:00:00 | 0.111  | 0.091  | 0.068  | 0.066  | 0.057  | 0.056  | 0.046  | 0.046  | 0.048  | 0.013  | -0.098 |
| 2014-08-01 00:00:00 | 0.211  | 0.191  | 0.158  | 0.146  | 0.146  | 0.122  |  0.12  |  0.12  | 0.104  | 0.066  | -0.145 |
| 2014-09-01 00:00:00 | 0.021  | 0.019  | 0.033  | 0.036  | 0.014  | 0.017  | 0.009  | 0.017  | 0.009  | 0.025  | 0.005  |
| 2014-10-01 00:00:00 | 0.069  | 0.075  | 0.047  | 0.064  | 0.054  |  0.07  | 0.037  | 0.048  | 0.062  | 0.109  |  0.04  |
| 2014-11-01 00:00:00 | -0.108 | -0.083 | -0.078 | -0.076 | -0.067 | -0.048 | -0.036 | 0.006  | 0.021  | 0.202  | 0.309  |
| 2014-12-01 00:00:00 | 0.116  | 0.106  | 0.112  | 0.104  |  0.09  | 0.099  | 0.074  | 0.076  | 0.075  | -0.001 | -0.116 |
| 2015-01-01 00:00:00 | 0.117  | 0.086  | 0.081  | 0.074  |  0.09  | 0.087  | 0.099  | 0.087  | 0.095  | 0.058  | -0.059 |
| 2015-02-01 00:00:00 | 0.271  | 0.243  | 0.243  | 0.251  |  0.24  | 0.242  | 0.224  | 0.225  | 0.201  | 0.153  | -0.118 |
| 2015-03-01 00:00:00 | 0.217  | 0.179  | 0.171  |  0.2   | 0.148  | 0.164  | 0.161  | 0.158  | 0.147  | 0.196  | -0.021 |
| 2015-04-01 00:00:00 | 0.373  | 0.317  | 0.294  | 0.284  | 0.276  | 0.256  | 0.253  | 0.203  | 0.158  | 0.059  | -0.314 |
| 2015-05-01 00:00:00 | -0.047 | -0.096 | -0.123 | -0.124 | -0.155 | -0.156 | -0.156 | -0.118 | -0.133 | -0.098 | -0.05  |
| 2015-06-01 00:00:00 | -0.161 | -0.178 | -0.209 | -0.209 | -0.203 | -0.19  | -0.179 | -0.152 | -0.159 | -0.164 | -0.003 |
| 2015-07-01 00:00:00 | -0.088 | -0.125 | -0.121 | -0.149 | -0.156 | -0.15  | -0.151 | -0.165 | -0.168 | -0.139 | -0.051 |
| 2015-08-01 00:00:00 | 0.004  | -0.005 | -0.003 | 0.009  | -0.011 | -0.011 | -0.01  | -0.034 | -0.046 | -0.061 | -0.065 |
| 2015-09-01 00:00:00 | 0.301  |  0.27  | 0.276  | 0.257  | 0.258  | 0.237  | 0.222  | 0.219  | 0.209  | 0.136  | -0.165 |
| 2015-10-01 00:00:00 | 0.203  | 0.193  | 0.173  | 0.148  | 0.128  | 0.111  | 0.081  | 0.061  | 0.045  | 0.013  | -0.19  |
| 2015-11-01 00:00:00 | 0.152  | 0.099  | 0.085  | 0.066  | 0.053  | 0.029  | 0.038  | 0.034  | 0.019  | 0.031  | -0.121 |
| 2015-12-01 00:00:00 | -0.303 | -0.296 | -0.309 | -0.31  | -0.306 | -0.311 | -0.305 | -0.298 | -0.301 | -0.25  | 0.053  |
| 2016-01-01 00:00:00 | 0.009  | -0.005 | -0.009 | -0.022 | -0.021 | -0.028 | -0.031 | -0.02  | -0.019 | -0.022 | -0.03  |
| 2016-02-01 00:00:00 | 0.257  | 0.223  |  0.22  | 0.201  | 0.208  | 0.214  | 0.187  | 0.179  | 0.169  | 0.137  | -0.12  |
| 2016-03-01 00:00:00 | 0.062  | 0.042  | 0.016  |  0.0   | -0.011 | -0.027 | -0.016 | -0.034 | -0.03  | -0.036 | -0.098 |
| 2016-04-01 00:00:00 | -0.035 | -0.029 | -0.023 | -0.011 | -0.01  | -0.007 | 0.003  | 0.002  | -0.005 | -0.004 | 0.031  |
| 2016-05-01 00:00:00 | 0.068  | 0.085  | 0.085  | 0.082  | 0.082  | 0.072  | 0.055  | 0.054  | 0.027  | 0.013  | -0.055 |
| 2016-06-01 00:00:00 | 0.002  | 0.001  | -0.009 | -0.014 | -0.02  | -0.02  | -0.026 | -0.011 | -0.003 | 0.034  | 0.032  |
| 2016-07-01 00:00:00 | 0.085  | 0.066  | 0.061  |  0.06  | 0.046  | 0.039  | 0.039  | 0.036  | 0.032  | 0.034  | -0.051 |
| 2016-08-01 00:00:00 | 0.057  | 0.016  | -0.005 | -0.019 | -0.014 | -0.021 | -0.031 | -0.026 | -0.031 | -0.032 | -0.089 |
| 2016-09-01 00:00:00 | 0.051  | 0.056  | 0.051  | 0.042  | 0.043  | 0.047  | 0.024  | 0.027  | 0.022  | 0.023  | -0.028 |
| 2016-10-01 00:00:00 | 0.062  | 0.055  | 0.036  | 0.025  | 0.026  | 0.021  | 0.016  | 0.016  | 0.021  | 0.044  | -0.019 |
| 2016-11-01 00:00:00 | 0.007  | -0.039 | -0.039 | -0.06  | -0.063 | -0.071 | -0.067 | -0.065 | -0.06  | -0.063 | -0.07  |
| 2016-12-01 00:00:00 | -0.043 | -0.037 | -0.043 | -0.04  | -0.037 | -0.034 | -0.03  | -0.029 | -0.021 | 0.012  | 0.055  |
| 2017-01-01 00:00:00 | 0.083  | 0.047  | 0.046  | 0.044  | 0.048  | 0.042  | 0.037  | 0.039  | 0.049  | 0.033  | -0.05  |
| 2017-02-01 00:00:00 | -0.031 | -0.022 | -0.021 | -0.024 | -0.018 | -0.019 | -0.02  | -0.011 | -0.012 | 0.005  | 0.036  |
| 2017-03-01 00:00:00 | -0.098 | -0.089 | -0.077 | -0.078 | -0.068 | -0.076 | -0.053 | -0.045 | -0.027 | -0.01  | 0.089  |
| 2017-04-01 00:00:00 | -0.095 | -0.093 | -0.091 | -0.083 | -0.085 | -0.081 | -0.076 | -0.068 | -0.067 | -0.02  | 0.076  |
| 2017-05-01 00:00:00 | 0.041  | 0.033  |  0.03  |  0.03  | 0.028  |  0.04  | 0.036  | 0.043  | 0.055  | 0.054  | 0.013  |
| 2017-06-01 00:00:00 | -0.048 | -0.034 | -0.018 | -0.018 |  0.0   | -0.003 | 0.004  | 0.008  | 0.027  | 0.017  | 0.065  |
| 2017-07-01 00:00:00 | 0.095  | 0.058  | 0.048  | 0.039  | 0.042  | 0.035  |  0.03  | 0.034  | 0.027  | 0.025  | -0.071 |
| 2017-08-01 00:00:00 | 0.019  |  0.02  | 0.023  | 0.011  | 0.014  | 0.017  | 0.013  | 0.016  | 0.011  | 0.003  | -0.016 |
| 2017-09-01 00:00:00 | -0.011 | -0.031 | -0.023 | -0.031 | -0.024 | -0.028 | -0.027 | -0.02  | -0.007 |  0.02  | 0.031  |
| 2017-10-01 00:00:00 | -0.086 | -0.099 | -0.097 | -0.085 | -0.081 | -0.073 | -0.057 | -0.057 | -0.044 | -0.028 | 0.058  |
| 2017-11-01 00:00:00 | -0.022 | -0.029 | -0.021 | -0.031 | -0.023 | -0.021 | -0.014 | -0.014 | -0.006 | -0.003 | 0.019  |
| 2017-12-01 00:00:00 | -0.05  | -0.041 | -0.046 | -0.05  | -0.04  | -0.034 | -0.029 | -0.023 | -0.005 | 0.025  | 0.075  |
| 2018-01-01 00:00:00 | -0.073 | -0.066 | -0.065 | -0.06  | -0.055 | -0.051 | -0.04  | -0.029 | -0.031 | -0.042 | 0.031  |
| 2018-02-01 00:00:00 | 0.133  | 0.099  | 0.092  | 0.065  | 0.057  | 0.052  | 0.038  |  0.03  | 0.011  | -0.013 | -0.146 |
| 2018-03-01 00:00:00 | -0.045 | -0.036 | -0.045 | -0.04  | -0.051 | -0.036 | -0.043 | -0.034 | -0.044 | -0.033 | 0.012  |
| 2018-04-01 00:00:00 | 0.014  | 0.019  | -0.015 | -0.021 | -0.025 | -0.011 | -0.013 | -0.019 | -0.007 | 0.014  |  0.0   |
| 2018-05-01 00:00:00 | -0.112 | -0.098 | -0.119 | -0.114 | -0.12  | -0.116 | -0.112 | -0.102 | -0.101 | -0.081 | 0.031  |
| 2018-06-01 00:00:00 | 0.028  | 0.018  | 0.002  | -0.008 | -0.016 | 0.002  | -0.015 | -0.009 | -0.001 | -0.003 | -0.03  |
| 2018-07-01 00:00:00 | -0.083 | -0.09  | -0.08  | -0.085 | -0.079 | -0.082 | -0.088 | -0.082 | -0.077 | -0.068 | 0.014  |
| 2018-08-01 00:00:00 | 0.013  | -0.002 | -0.013 | -0.01  | -0.014 | -0.013 | -0.002 | -0.018 | -0.001 | 0.015  | 0.001  |
| 2018-09-01 00:00:00 | -0.044 | -0.079 | -0.09  | -0.091 | -0.097 | -0.113 | -0.116 | -0.11  | -0.091 | -0.093 | -0.049 |
| 2018-10-01 00:00:00 | 0.089  | 0.067  | 0.077  | 0.064  | 0.069  | 0.061  | 0.054  | 0.045  | 0.032  | 0.013  | -0.076 |
| 2018-11-01 00:00:00 | -0.022 | -0.035 | -0.031 | -0.043 | -0.048 | -0.055 | -0.047 | -0.044 | -0.04  | -0.044 | -0.022 |
| 2018-12-01 00:00:00 | -0.046 | -0.04  | -0.039 | -0.038 | -0.03  | -0.019 | -0.02  | -0.018 | 0.008  | 0.026  | 0.071  |
| 2019-01-01 00:00:00 | 0.241  | 0.235  | 0.237  | 0.243  | 0.231  | 0.218  | 0.239  | 0.203  | 0.209  | 0.187  | -0.054 |
| 2019-02-01 00:00:00 | 0.122  |  0.11  | 0.112  |  0.11  | 0.104  | 0.104  | 0.111  | 0.102  | 0.103  |  0.07  | -0.053 |
| 2019-03-01 00:00:00 | -0.018 | -0.038 | -0.048 | -0.045 | -0.052 | -0.034 | -0.037 | -0.05  | -0.047 | -0.022 | -0.004 |
| 2019-04-01 00:00:00 | -0.012 | -0.031 | -0.033 | -0.051 | -0.055 | -0.045 | -0.06  | -0.067 | -0.066 | -0.067 | -0.055 |
| 2019-05-01 00:00:00 | 0.017  | 0.013  | 0.001  | -0.006 | -0.004 | -0.007 | -0.01  | 0.001  | 0.015  | 0.035  | 0.018  |
| 2019-06-01 00:00:00 | -0.011 | -0.016 | -0.03  | -0.028 | -0.023 | -0.032 | -0.016 | -0.022 | -0.005 | 0.005  | 0.016  |
| 2019-07-01 00:00:00 | -0.027 | -0.017 | -0.022 | -0.011 | -0.008 | -0.004 | -0.013 | -0.001 | -0.008 | -0.002 | 0.025  |
| 2019-08-01 00:00:00 | 0.018  | 0.023  | 0.027  | 0.019  | 0.014  |  0.01  | 0.008  | 0.015  | 0.009  |  0.01  | -0.008 |
| 2019-09-01 00:00:00 |  -0.0  | -0.008 | -0.002 | -0.002 | -0.02  | -0.001 | -0.011 | -0.003 | -0.003 | 0.005  | 0.006  |
| 2019-10-01 00:00:00 | -0.015 | -0.022 | -0.026 | -0.023 | -0.033 | -0.023 | -0.029 | -0.023 | -0.011 | -0.005 |  0.01  |
| 2019-11-01 00:00:00 | 0.097  | 0.097  | 0.077  | 0.078  | 0.081  | 0.091  | 0.071  | 0.081  | 0.081  | 0.082  | -0.015 |
| 2019-12-01 00:00:00 | -0.023 | -0.014 | 0.002  | 0.005  | -0.001 | 0.013  |  0.01  | 0.027  | 0.014  | 0.001  | 0.025  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff  |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
| Average | 0.031 | 0.019 | 0.015 | 0.014 | 0.011 | 0.011 | 0.008 | 0.009 | 0.008 | 0.008 | -0.023 |
|  T-Test |  3.73 |  2.84 | 2.313 | 2.043 | 1.756 | 1.781 | 1.359 | 1.578 | 1.479 | 1.555 | -3.79  |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
```

The second dataset contains below 30% stocks from 2000-01-01 to 2019-12-01. The size effect is **significant** since the t-test statistics is -3.79 whose absolute value is more than 2 corresponding to the significance level at 0.05. The monthly excess return is **2.3%** and the annual excess return is about 27.6%. 

```python
# %% dataset 3
# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_3 = month_return[(month_return['cap']==True) & (month_return['Ndaytrd']>=10)]
# construct data for univariate analysis
test_data_3 = test_data_3[['emrwd', 'Msmvttl', 'Time']].dropna()
# time interval between 2000-01-01 to 2016-12-01
test_data_3 = test_data_3[(test_data_3['Time'] >= '2000-01-01') & (test_data_3['Time'] <= '2016-12-01')]
# analysis
uni_3 = Univariate(np.array(test_data_3), number=9)
uni_3.average_by_time()
uni_3.summary_and_test()
uni_3.print_summary_by_time()
uni_3.print_summary()
==========================================================================================================================
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
|         Time        |   1    |   2    |   3    |   4    |   5    |   6    |   7    |   8    |   9    |   10   |  diff  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| 2000-01-01 00:00:00 | 0.124  | 0.144  | 0.126  | 0.129  |  0.1   | 0.129  | 0.095  | 0.103  | 0.114  | 0.135  | 0.011  |
| 2000-02-01 00:00:00 | 0.155  | 0.122  | 0.075  |  0.12  | 0.053  | 0.064  | 0.054  |  0.04  | 0.022  | 0.009  | -0.146 |
| 2000-03-01 00:00:00 | 0.007  | 0.022  | 0.012  |  0.01  | 0.004  | 0.002  | 0.016  | 0.015  | 0.017  | 0.033  | 0.026  |
| 2000-04-01 00:00:00 | 0.034  | 0.042  | 0.042  | 0.043  |  0.03  | 0.024  | 0.049  | 0.022  | 0.021  | 0.021  | -0.013 |
| 2000-05-01 00:00:00 | 0.008  | 0.041  | 0.046  | 0.015  | 0.029  | 0.022  | 0.007  |  0.03  | 0.044  | 0.021  | 0.013  |
| 2000-06-01 00:00:00 |  0.06  | 0.067  | 0.045  | 0.038  | 0.051  | 0.042  | 0.029  | 0.036  | 0.032  | 0.045  | -0.016 |
| 2000-07-01 00:00:00 | 0.017  | -0.003 | 0.003  | 0.001  | -0.013 | -0.008 | -0.014 | -0.003 | -0.012 | -0.028 | -0.045 |
| 2000-08-01 00:00:00 | -0.027 | -0.025 | -0.032 | -0.056 | -0.061 | -0.055 | -0.04  | -0.065 | -0.054 | -0.056 | -0.029 |
| 2000-09-01 00:00:00 | 0.038  | 0.049  | 0.034  | 0.034  | 0.038  | 0.022  | 0.031  | 0.015  | 0.013  | 0.002  | -0.036 |
| 2000-10-01 00:00:00 | 0.056  | 0.069  | 0.063  | 0.063  | 0.063  | 0.069  | 0.042  | 0.046  | 0.053  | 0.059  | 0.004  |
| 2000-11-01 00:00:00 | 0.009  | 0.013  | 0.011  | 0.008  | -0.002 | 0.014  |  0.01  |  0.0   | -0.012 | -0.024 | -0.033 |
| 2000-12-01 00:00:00 |  0.0   | -0.008 | -0.018 | -0.007 | -0.01  | -0.014 | 0.001  | -0.007 | -0.008 | -0.019 | -0.019 |
| 2001-01-01 00:00:00 | -0.077 | -0.058 | -0.067 | -0.064 | -0.053 | -0.055 | -0.063 | -0.055 | -0.048 | -0.05  | 0.027  |
| 2001-02-01 00:00:00 | 0.096  | 0.072  | 0.085  | 0.074  | 0.088  | 0.079  | 0.075  | 0.061  | 0.065  | 0.056  | -0.04  |
| 2001-03-01 00:00:00 | 0.015  | 0.009  | -0.01  | -0.001 | -0.007 | -0.011 | 0.001  | -0.012 | -0.009 | -0.017 | -0.032 |
| 2001-04-01 00:00:00 | 0.073  | 0.045  | 0.051  | 0.049  | 0.038  |  0.03  | 0.039  | 0.029  | 0.016  |  0.01  | -0.063 |
| 2001-05-01 00:00:00 | 0.018  |  0.01  | 0.012  | 0.012  | 0.019  | 0.002  | -0.005 | 0.015  | -0.01  | -0.002 | -0.02  |
| 2001-06-01 00:00:00 | -0.138 | -0.138 | -0.129 | -0.134 | -0.141 | -0.149 | -0.123 | -0.131 | -0.13  | -0.13  | 0.009  |
| 2001-07-01 00:00:00 | -0.031 | -0.035 | -0.034 | -0.039 | -0.038 | -0.041 | -0.04  | -0.03  | -0.034 | -0.049 | -0.018 |
| 2001-08-01 00:00:00 | -0.055 | -0.067 | -0.048 | -0.067 | -0.048 | -0.047 | -0.046 | -0.047 | -0.05  | -0.022 | 0.033  |
| 2001-09-01 00:00:00 | -0.062 | -0.054 | -0.052 | -0.057 | -0.056 | -0.066 | -0.053 | -0.046 | -0.053 | -0.028 | 0.034  |
| 2001-10-01 00:00:00 | 0.057  | 0.057  | 0.042  | 0.054  | 0.046  | 0.039  | 0.041  | 0.034  | 0.039  | 0.021  | -0.035 |
| 2001-11-01 00:00:00 | -0.067 | -0.082 | -0.069 | -0.078 | -0.067 | -0.063 | -0.067 | -0.058 | -0.05  | -0.047 | 0.021  |
| 2001-12-01 00:00:00 | -0.141 | -0.14  | -0.119 | -0.121 | -0.117 | -0.116 | -0.108 |  -0.1  | -0.087 | -0.062 | 0.079  |
| 2002-01-01 00:00:00 | 0.035  | 0.044  | 0.043  | 0.036  |  0.03  | 0.032  | 0.028  | 0.025  | 0.016  | 0.011  | -0.024 |
| 2002-02-01 00:00:00 | 0.097  |  0.08  | 0.076  | 0.078  | 0.069  | 0.076  | 0.076  | 0.056  | 0.061  | 0.032  | -0.065 |
| 2002-03-01 00:00:00 | 0.057  | 0.059  | 0.048  | 0.037  | 0.053  | 0.042  | 0.028  | 0.037  | 0.031  | 0.033  | -0.025 |
| 2002-04-01 00:00:00 | -0.095 | -0.089 | -0.095 | -0.093 | -0.092 | -0.095 | -0.09  | -0.089 | -0.092 | -0.075 |  0.02  |
| 2002-05-01 00:00:00 | 0.116  | 0.115  |  0.11  | 0.113  | 0.122  | 0.114  | 0.142  | 0.123  | 0.152  | 0.158  | 0.042  |
| 2002-06-01 00:00:00 | -0.036 | -0.034 | -0.03  | -0.034 | -0.041 | -0.04  | -0.04  | -0.049 | -0.041 | -0.045 | -0.009 |
| 2002-07-01 00:00:00 | 0.011  | 0.004  | 0.005  |  -0.0  | 0.009  | 0.008  | 0.007  | 0.011  | -0.003 | 0.005  | -0.006 |
| 2002-08-01 00:00:00 | -0.058 | -0.056 | -0.065 | -0.059 | -0.057 | -0.059 | -0.054 | -0.046 | -0.05  | -0.047 | 0.011  |
| 2002-09-01 00:00:00 | -0.073 | -0.06  | -0.059 | -0.053 | -0.049 | -0.057 | -0.045 | -0.045 | -0.049 | -0.044 | 0.028  |
| 2002-10-01 00:00:00 | -0.084 | -0.093 | -0.087 | -0.079 | -0.071 | -0.076 | -0.077 | -0.053 | -0.046 | -0.033 | 0.052  |
| 2002-11-01 00:00:00 | -0.059 | -0.055 | -0.056 | -0.058 | -0.051 | -0.062 | -0.05  | -0.05  | -0.05  | -0.045 | 0.013  |
| 2002-12-01 00:00:00 | 0.115  | 0.111  |  0.09  | 0.103  | 0.099  | 0.085  | 0.076  | 0.078  | 0.078  | 0.095  | -0.02  |
| 2003-01-01 00:00:00 | 0.015  | 0.012  | 0.019  |  0.01  |  0.01  | 0.012  | 0.014  | 0.012  | 0.004  | 0.006  | -0.009 |
| 2003-02-01 00:00:00 | -0.03  | -0.037 | -0.032 | -0.031 | -0.023 | -0.026 | -0.022 | -0.009 |  -0.0  | 0.013  | 0.043  |
| 2003-03-01 00:00:00 | -0.07  | -0.041 | -0.05  | -0.048 | -0.037 | -0.02  | -0.023 | 0.002  | 0.002  | 0.033  | 0.104  |
| 2003-04-01 00:00:00 | 0.028  | 0.041  | 0.027  | 0.038  | 0.042  | 0.034  | 0.057  | 0.047  | 0.054  | 0.058  |  0.03  |
| 2003-05-01 00:00:00 | -0.067 | -0.063 | -0.074 | -0.07  | -0.079 | -0.072 | -0.082 | -0.056 | -0.06  | -0.065 | 0.002  |
| 2003-06-01 00:00:00 | -0.036 | -0.044 | -0.037 | -0.031 | -0.043 | -0.023 | -0.022 | -0.015 | 0.006  | 0.016  | 0.052  |
| 2003-07-01 00:00:00 | -0.02  | -0.016 | -0.027 | -0.041 | -0.029 | -0.037 | -0.032 | -0.025 | -0.029 | -0.043 | -0.022 |
| 2003-08-01 00:00:00 | -0.044 | -0.043 | -0.056 | -0.035 | -0.034 | -0.037 | -0.045 | -0.049 | -0.041 | -0.039 | 0.006  |
| 2003-09-01 00:00:00 | -0.081 | -0.077 | -0.073 | -0.066 | -0.062 | -0.064 | -0.042 | -0.032 | -0.023 | 0.011  | 0.092  |
| 2003-10-01 00:00:00 | 0.008  | 0.022  | 0.026  | 0.035  | 0.033  | 0.015  | 0.026  | 0.018  | 0.014  |  0.03  | 0.022  |
| 2003-11-01 00:00:00 | -0.019 | -0.021 | -0.028 | -0.016 |  0.01  | 0.013  | 0.022  | 0.022  | 0.035  | 0.088  | 0.106  |
| 2003-12-01 00:00:00 | 0.091  | 0.103  | 0.097  | 0.099  | 0.084  | 0.081  | 0.067  | 0.067  | 0.075  | 0.047  | -0.044 |
| 2004-01-01 00:00:00 | 0.122  | 0.097  | 0.083  | 0.093  |  0.11  | 0.081  | 0.077  | 0.074  | 0.071  | 0.051  | -0.072 |
| 2004-02-01 00:00:00 | 0.042  | 0.046  | 0.035  | 0.052  | 0.052  | 0.029  | 0.036  | 0.033  | 0.028  | 0.028  | -0.014 |
| 2004-03-01 00:00:00 | -0.103 | -0.086 |  -0.1  |  -0.1  | -0.091 | -0.093 | -0.083 | -0.101 | -0.086 | -0.116 | -0.013 |
| 2004-04-01 00:00:00 | -0.029 | -0.017 | -0.009 | -0.025 | -0.014 | -0.03  | -0.019 | -0.026 | -0.035 | -0.024 | 0.005  |
| 2004-05-01 00:00:00 | -0.128 | -0.131 | -0.135 | -0.134 | -0.132 | -0.126 | -0.114 | -0.124 | -0.111 | -0.085 | 0.043  |
| 2004-06-01 00:00:00 | -0.026 | -0.034 | -0.022 | -0.022 | 0.004  | 0.007  |  0.01  | 0.005  | 0.021  | 0.003  | 0.028  |
| 2004-07-01 00:00:00 | -0.049 | -0.046 | -0.052 | -0.057 | -0.058 | -0.059 | -0.062 | -0.066 | -0.042 | -0.036 | 0.013  |
| 2004-08-01 00:00:00 | 0.061  | 0.043  | 0.053  | 0.045  | 0.053  | 0.064  | 0.057  | 0.062  | 0.056  | 0.062  | 0.001  |
| 2004-09-01 00:00:00 | -0.075 | -0.053 | -0.076 | -0.048 | -0.057 | -0.066 | -0.061 | -0.03  | -0.018 | -0.053 | 0.022  |
| 2004-10-01 00:00:00 | 0.059  |  0.05  |  0.04  | 0.041  | 0.049  | 0.046  | 0.032  | 0.025  | 0.002  | -0.005 | -0.064 |
| 2004-11-01 00:00:00 | -0.078 | -0.08  | -0.086 | -0.079 | -0.09  | -0.093 | -0.077 | -0.066 | -0.076 | -0.048 |  0.03  |
| 2004-12-01 00:00:00 | -0.076 | -0.073 | -0.084 | -0.079 | -0.079 | -0.08  | -0.078 | -0.078 | -0.069 | -0.047 | 0.029  |
| 2005-01-01 00:00:00 | 0.112  |  0.11  | 0.107  | 0.102  | 0.116  | 0.115  | 0.117  | 0.095  | 0.093  | 0.093  | -0.019 |
| 2005-02-01 00:00:00 | -0.147 | -0.137 | -0.138 | -0.133 | -0.117 | -0.121 | -0.112 | -0.121 | -0.088 | -0.086 |  0.06  |
| 2005-03-01 00:00:00 | -0.107 | -0.076 | -0.084 | -0.049 | -0.067 | -0.05  | -0.041 | -0.037 | -0.008 | 0.012  | 0.119  |
| 2005-04-01 00:00:00 | -0.015 | -0.024 | -0.026 | -0.033 | -0.04  | -0.054 | -0.059 | -0.079 | -0.077 |  -0.1  | -0.085 |
| 2005-05-01 00:00:00 | -0.001 | 0.001  | -0.001 | -0.003 | 0.003  | -0.011 | -0.004 | 0.011  | -0.005 | 0.037  | 0.038  |
| 2005-06-01 00:00:00 | -0.083 | -0.07  | -0.079 | -0.07  | -0.058 | -0.063 | -0.053 | -0.036 | -0.012 | 0.015  | 0.097  |
| 2005-07-01 00:00:00 | 0.169  | 0.184  | 0.163  | 0.159  | 0.131  | 0.132  | 0.127  | 0.139  | 0.073  | 0.048  | -0.121 |
| 2005-08-01 00:00:00 |  0.02  | 0.008  | 0.007  | 0.025  | 0.028  | 0.024  | 0.035  | 0.036  | 0.016  | -0.013 | -0.034 |
| 2005-09-01 00:00:00 | -0.071 | -0.05  | -0.067 | -0.043 | -0.062 | -0.055 | -0.056 | -0.042 | -0.057 | -0.053 | 0.019  |
| 2005-10-01 00:00:00 | 0.018  |  0.01  | 0.019  | 0.005  | 0.016  | 0.016  | -0.014 | -0.014 | -0.019 | -0.004 | -0.022 |
| 2005-11-01 00:00:00 | 0.016  |  0.01  | 0.018  | 0.022  | 0.033  | 0.043  | 0.047  | 0.067  | 0.062  | 0.079  | 0.063  |
| 2005-12-01 00:00:00 | 0.098  | 0.067  |  0.09  | 0.088  | 0.094  | 0.119  | 0.141  |  0.12  |  0.13  | 0.088  | -0.01  |
| 2006-01-01 00:00:00 | 0.034  | 0.026  | 0.023  | 0.019  | 0.021  | 0.017  | 0.017  | -0.007 | 0.022  | 0.046  | 0.012  |
| 2006-02-01 00:00:00 | -0.002 | 0.001  | 0.006  | 0.008  | 0.022  | 0.025  | 0.042  | 0.048  | 0.048  | 0.025  | 0.027  |
| 2006-03-01 00:00:00 | 0.093  | 0.106  | 0.101  | 0.089  | 0.122  | 0.118  | 0.133  | 0.145  |  0.16  | 0.127  | 0.034  |
| 2006-04-01 00:00:00 | 0.297  | 0.251  | 0.284  | 0.265  | 0.261  | 0.222  | 0.266  | 0.201  | 0.208  | 0.156  | -0.141 |
| 2006-05-01 00:00:00 | 0.065  | 0.091  | 0.067  | 0.052  | 0.058  |  0.04  | 0.048  | 0.045  | 0.013  |  0.02  | -0.045 |
| 2006-06-01 00:00:00 | -0.002 | -0.038 | -0.039 | -0.022 | -0.043 | -0.043 | -0.051 | -0.059 | -0.056 | -0.088 | -0.086 |
| 2006-07-01 00:00:00 | 0.029  | 0.016  | 0.042  | 0.028  | 0.042  | 0.029  | 0.057  | 0.031  |  0.04  | 0.024  | -0.005 |
| 2006-08-01 00:00:00 | 0.049  | 0.056  | 0.049  | 0.039  | 0.038  | 0.052  | 0.026  | 0.042  | 0.041  | 0.044  | -0.005 |
| 2006-09-01 00:00:00 | -0.011 |  0.01  | 0.016  | -0.013 | -0.029 | 0.004  | -0.01  | 0.029  | 0.014  | 0.034  | 0.045  |
| 2006-10-01 00:00:00 | 0.014  | 0.024  | 0.034  | 0.038  | 0.058  | 0.055  | 0.063  | 0.079  | 0.139  | 0.183  | 0.169  |
| 2006-11-01 00:00:00 | 0.055  | 0.032  | 0.036  | 0.043  | 0.072  | 0.061  | 0.088  | 0.097  | 0.099  |  0.17  | 0.115  |
| 2006-12-01 00:00:00 | 0.296  | 0.254  | 0.262  | 0.251  | 0.233  | 0.239  | 0.232  | 0.209  | 0.254  | 0.173  | -0.122 |
| 2007-01-01 00:00:00 | 0.254  | 0.179  | 0.218  | 0.187  |  0.26  | 0.177  | 0.139  | 0.162  | 0.128  | 0.066  | -0.188 |
| 2007-02-01 00:00:00 | 0.196  | 0.203  | 0.179  | 0.163  | 0.171  | 0.175  | 0.142  | 0.103  | 0.072  |  0.09  | -0.107 |
| 2007-03-01 00:00:00 | 0.389  |  0.32  | 0.358  | 0.298  | 0.342  | 0.341  | 0.329  | 0.362  | 0.337  | 0.262  | -0.127 |
| 2007-04-01 00:00:00 | 0.067  | 0.093  | 0.064  | 0.065  | 0.178  | 0.113  | 0.081  | 0.092  | 0.143  | 0.118  | 0.051  |
| 2007-05-01 00:00:00 | -0.205 | -0.205 | -0.177 | -0.162 | -0.144 | -0.171 | -0.121 | -0.109 | -0.064 | -0.028 | 0.176  |
| 2007-06-01 00:00:00 | 0.235  |  0.26  | 0.231  | 0.228  | 0.216  |  0.2   | 0.192  | 0.196  | 0.182  | 0.186  | -0.049 |
| 2007-07-01 00:00:00 | 0.093  | 0.095  | 0.108  | 0.086  | 0.133  | 0.093  | 0.108  | 0.131  | 0.161  | 0.183  |  0.09  |
| 2007-08-01 00:00:00 | 0.025  | 0.015  | 0.043  | 0.059  |  0.03  | 0.046  | 0.018  | 0.038  | 0.082  | 0.073  | 0.048  |
| 2007-09-01 00:00:00 | -0.113 | -0.135 | -0.115 | -0.099 | -0.099 | -0.115 | -0.093 | -0.091 | -0.072 | 0.016  | 0.129  |
| 2007-10-01 00:00:00 | -0.038 | -0.058 | -0.05  | -0.084 | -0.048 | -0.112 | -0.091 | -0.13  | -0.163 | -0.184 | -0.147 |
| 2007-11-01 00:00:00 | 0.207  | 0.201  | 0.219  | 0.213  | 0.218  | 0.209  |  0.23  | 0.192  | 0.192  | 0.135  | -0.073 |
| 2007-12-01 00:00:00 | -0.061 | -0.058 | -0.075 | -0.052 | -0.058 | -0.06  | -0.065 | -0.078 | -0.079 | -0.141 | -0.081 |
| 2008-01-01 00:00:00 |  0.11  | 0.096  |  0.1   | 0.089  | 0.083  | 0.068  | 0.063  |  0.05  |  0.03  | 0.012  | -0.097 |
| 2008-02-01 00:00:00 | -0.188 | -0.189 | -0.196 | -0.202 | -0.204 | -0.199 | -0.214 | -0.211 | -0.233 | -0.212 | -0.023 |
| 2008-03-01 00:00:00 | -0.061 | -0.091 | -0.055 | -0.055 | -0.048 | -0.038 | -0.013 | 0.003  |  0.03  | 0.057  | 0.118  |
| 2008-04-01 00:00:00 | 0.002  | -0.017 | -0.03  | -0.039 | -0.035 | -0.039 | -0.053 | -0.045 | -0.054 | -0.089 | -0.091 |
| 2008-05-01 00:00:00 | -0.275 | -0.261 | -0.249 | -0.262 | -0.252 | -0.239 | -0.247 | -0.242 | -0.227 | -0.215 |  0.06  |
| 2008-06-01 00:00:00 | 0.114  | 0.102  | 0.107  | 0.105  | 0.081  | 0.074  |  0.08  |  0.05  | 0.044  | -0.005 | -0.119 |
| 2008-07-01 00:00:00 | -0.244 | -0.214 | -0.223 | -0.248 | -0.229 | -0.235 | -0.253 | -0.226 | -0.239 | -0.169 | 0.075  |
| 2008-08-01 00:00:00 | -0.101 | -0.085 | -0.112 | -0.075 | -0.082 | -0.084 | -0.064 | -0.046 | -0.041 | -0.016 | 0.085  |
| 2008-09-01 00:00:00 | -0.261 | -0.263 | -0.251 | -0.261 | -0.271 | -0.265 | -0.26  | -0.273 | -0.261 | -0.257 | 0.003  |
| 2008-10-01 00:00:00 | 0.233  | 0.211  | 0.233  | 0.211  | 0.202  | 0.175  | 0.162  | 0.166  |  0.15  |  0.12  | -0.112 |
| 2008-11-01 00:00:00 | 0.116  | 0.053  | 0.073  | 0.073  | 0.043  | 0.054  | 0.064  | 0.052  | 0.041  | -0.002 | -0.118 |
| 2008-12-01 00:00:00 | 0.157  | 0.155  | 0.167  | 0.186  |  0.17  | 0.175  | 0.167  | 0.161  | 0.147  | 0.104  | -0.053 |
| 2009-01-01 00:00:00 | 0.091  | 0.081  | 0.091  | 0.093  | 0.073  | 0.084  | 0.077  | 0.064  |  0.06  |  0.06  | -0.031 |
| 2009-02-01 00:00:00 | 0.244  | 0.249  | 0.213  | 0.229  | 0.205  | 0.217  | 0.209  | 0.187  | 0.213  | 0.178  | -0.066 |
| 2009-03-01 00:00:00 |  0.07  | 0.076  | 0.085  | 0.074  | 0.049  | 0.039  | 0.078  | 0.025  | 0.065  | 0.046  | -0.025 |
| 2009-04-01 00:00:00 | 0.078  | 0.071  | 0.085  | 0.075  | 0.045  | 0.054  | 0.051  | 0.038  | 0.062  | 0.046  | -0.031 |
| 2009-05-01 00:00:00 | 0.038  | 0.035  | 0.049  | 0.052  | 0.037  | 0.052  | 0.049  | 0.081  | 0.072  | 0.145  | 0.107  |
| 2009-06-01 00:00:00 | 0.138  | 0.163  |  0.12  | 0.155  | 0.136  |  0.13  | 0.166  | 0.167  | 0.179  | 0.195  | 0.057  |
| 2009-07-01 00:00:00 | -0.155 | -0.136 | -0.135 | -0.147 | -0.146 | -0.168 | -0.171 | -0.177 | -0.194 | -0.245 | -0.09  |
| 2009-08-01 00:00:00 | 0.022  | 0.022  | 0.049  |  0.02  | 0.032  | 0.035  | 0.036  | 0.046  | 0.045  | 0.049  | 0.028  |
| 2009-09-01 00:00:00 | 0.125  | 0.117  | 0.133  | 0.126  | 0.133  | 0.115  | 0.108  |  0.11  | 0.107  | 0.085  | -0.039 |
| 2009-10-01 00:00:00 |  0.16  | 0.155  | 0.174  | 0.175  | 0.151  | 0.147  | 0.142  | 0.112  | 0.103  | 0.078  | -0.082 |
| 2009-11-01 00:00:00 | 0.038  | 0.027  |  0.03  | 0.029  | 0.024  | 0.001  | 0.005  | -0.001 | -0.006 | 0.008  | -0.03  |
| 2009-12-01 00:00:00 | -0.02  | -0.026 | -0.024 | -0.042 | -0.012 | -0.019 | -0.038 | -0.04  | -0.075 | -0.103 | -0.084 |
| 2010-01-01 00:00:00 | 0.068  | 0.062  | 0.059  | 0.073  | 0.055  | 0.057  | 0.058  | 0.047  | 0.039  | 0.021  | -0.048 |
| 2010-02-01 00:00:00 | 0.055  | 0.037  | 0.043  | 0.043  | 0.053  | 0.043  | 0.009  |  0.01  | 0.016  | 0.015  | -0.04  |
| 2010-03-01 00:00:00 | -0.085 | -0.067 | -0.082 | -0.071 | -0.059 | -0.083 | -0.078 | -0.053 | -0.067 | -0.081 | 0.004  |
| 2010-04-01 00:00:00 | -0.088 | -0.092 | -0.095 | -0.075 | -0.067 | -0.079 | -0.072 | -0.071 | -0.081 | -0.094 | -0.006 |
| 2010-05-01 00:00:00 | -0.081 | -0.097 | -0.083 | -0.099 | -0.092 | -0.103 | -0.099 | -0.098 | -0.097 | -0.077 | 0.005  |
| 2010-06-01 00:00:00 | 0.147  | 0.149  | 0.151  |  0.17  | 0.148  | 0.142  | 0.132  | 0.133  | 0.135  | 0.131  | -0.016 |
| 2010-07-01 00:00:00 | 0.108  | 0.112  | 0.098  | 0.094  | 0.081  | 0.085  | 0.122  | 0.079  | 0.059  | 0.019  | -0.089 |
| 2010-08-01 00:00:00 | -0.004 | 0.009  | 0.012  | -0.004 | -0.016 | 0.008  | 0.013  | 0.015  | 0.019  | 0.017  | 0.021  |
| 2010-09-01 00:00:00 | 0.108  | 0.074  | 0.085  | 0.097  |  0.08  | 0.103  | 0.105  | 0.092  | 0.148  | 0.155  | 0.047  |
| 2010-10-01 00:00:00 | 0.036  | 0.021  | 0.002  | 0.015  |  0.01  | 0.019  |  0.02  | -0.001 | -0.035 | -0.066 | -0.102 |
| 2010-11-01 00:00:00 | -0.024 | -0.025 | -0.031 | -0.036 | -0.026 | -0.035 | -0.034 | -0.02  | -0.006 | 0.006  |  0.03  |
| 2010-12-01 00:00:00 | -0.058 | -0.061 | -0.059 | -0.05  | -0.074 | -0.064 | -0.068 | -0.067 | -0.051 | -0.018 |  0.04  |
| 2011-01-01 00:00:00 | 0.098  | 0.093  |  0.11  | 0.096  | 0.105  | 0.103  | 0.101  | 0.097  | 0.069  | 0.052  | -0.046 |
| 2011-02-01 00:00:00 | 0.004  | -0.018 | -0.023 | -0.017 | -0.026 | -0.038 | -0.023 | -0.027 | -0.033 | -0.02  | -0.024 |
| 2011-03-01 00:00:00 | -0.054 | -0.036 | -0.052 | -0.05  | -0.027 | -0.035 | -0.039 | -0.039 | -0.02  | -0.022 | 0.032  |
| 2011-04-01 00:00:00 | -0.081 | -0.067 | -0.055 | -0.083 | -0.082 | -0.076 | -0.084 | -0.085 | -0.077 | -0.066 | 0.016  |
| 2011-05-01 00:00:00 | 0.034  | 0.031  | 0.042  | 0.023  | 0.041  | 0.032  | 0.031  | 0.036  |  0.03  |  0.03  | -0.004 |
| 2011-06-01 00:00:00 | 0.033  | 0.026  | 0.038  | 0.021  | 0.017  | 0.022  | 0.024  | 0.016  |  -0.0  | -0.017 | -0.05  |
| 2011-07-01 00:00:00 | -0.017 | -0.032 | -0.026 | -0.032 | -0.036 | -0.034 | -0.034 | -0.047 | -0.041 | -0.054 | -0.036 |
| 2011-08-01 00:00:00 | -0.123 | -0.115 | -0.124 | -0.131 | -0.136 | -0.128 | -0.141 | -0.125 | -0.111 | -0.093 | 0.029  |
| 2011-09-01 00:00:00 | 0.041  | 0.045  | 0.046  | 0.041  | 0.047  | 0.026  | 0.052  | 0.045  | 0.036  | 0.034  | -0.006 |
| 2011-10-01 00:00:00 | -0.045 | -0.038 | -0.029 | -0.04  | -0.041 | -0.042 | -0.045 | -0.049 | -0.056 | -0.069 | -0.024 |
| 2011-11-01 00:00:00 | -0.17  | -0.17  | -0.174 | -0.151 | -0.164 | -0.159 | -0.137 | -0.13  | -0.102 | -0.082 | 0.087  |
| 2011-12-01 00:00:00 | -0.016 | -0.018 | -0.006 | -0.018 | -0.018 | 0.003  | -0.013 |  -0.0  | -0.002 | 0.045  | 0.062  |
| 2012-01-01 00:00:00 | 0.143  | 0.138  | 0.135  | 0.136  | 0.129  | 0.128  | 0.131  | 0.119  | 0.109  | 0.072  | -0.071 |
| 2012-02-01 00:00:00 | -0.081 | -0.061 | -0.075 | -0.08  | -0.077 | -0.078 | -0.073 | -0.079 | -0.071 | -0.074 | 0.007  |
| 2012-03-01 00:00:00 | 0.088  | 0.069  | 0.064  | 0.073  |  0.07  | 0.064  | 0.063  | 0.053  | 0.063  | 0.072  | -0.016 |
| 2012-04-01 00:00:00 | 0.022  | 0.024  | 0.025  | 0.017  | 0.017  | 0.033  | 0.024  | 0.028  | 0.038  | 0.008  | -0.014 |
| 2012-05-01 00:00:00 | -0.06  | -0.06  | -0.061 | -0.073 | -0.067 | -0.066 | -0.071 | -0.071 | -0.058 | -0.057 | 0.003  |
| 2012-06-01 00:00:00 | -0.11  | -0.094 | -0.092 | -0.103 | -0.099 | -0.089 | -0.087 | -0.082 | -0.075 | -0.054 | 0.057  |
| 2012-07-01 00:00:00 | 0.042  | 0.045  | 0.033  | 0.026  | 0.033  |  0.0   |  0.01  | -0.022 | -0.034 | -0.056 | -0.098 |
| 2012-08-01 00:00:00 | 0.003  | 0.004  | 0.002  | -0.005 | 0.004  | 0.002  | 0.022  | 0.007  | 0.029  | 0.044  |  0.04  |
| 2012-09-01 00:00:00 | -0.004 | 0.002  | 0.008  |  -0.0  | -0.015 |  0.0   | -0.012 | -0.02  | -0.017 | -0.016 | -0.012 |
| 2012-10-01 00:00:00 | -0.119 | -0.121 | -0.125 | -0.113 | -0.124 | -0.113 | -0.123 | -0.103 | -0.097 | -0.059 |  0.06  |
| 2012-11-01 00:00:00 | 0.164  | 0.178  | 0.184  | 0.163  | 0.163  | 0.182  | 0.181  | 0.166  | 0.171  | 0.172  | 0.008  |
| 2012-12-01 00:00:00 |  0.07  | 0.072  | 0.066  | 0.069  | 0.065  | 0.054  | 0.065  | 0.061  | 0.049  | 0.057  | -0.013 |
| 2013-01-01 00:00:00 | 0.044  | 0.033  | 0.036  | 0.037  | 0.038  | 0.043  | 0.042  | 0.039  | 0.024  | -0.004 | -0.047 |
| 2013-02-01 00:00:00 | -0.032 | -0.024 | -0.031 | -0.027 | -0.047 | -0.041 | -0.047 | -0.057 | -0.04  | -0.05  | -0.018 |
| 2013-03-01 00:00:00 | -0.032 | -0.032 | -0.025 | -0.026 | -0.031 | -0.027 | -0.019 | -0.017 | -0.026 | -0.021 | 0.011  |
| 2013-04-01 00:00:00 | 0.158  | 0.154  | 0.147  | 0.142  | 0.152  | 0.156  |  0.15  | 0.125  | 0.125  | 0.067  | -0.091 |
| 2013-05-01 00:00:00 | -0.16  | -0.157 | -0.157 | -0.157 | -0.154 | -0.154 | -0.164 | -0.151 | -0.154 | -0.136 | 0.024  |
| 2013-06-01 00:00:00 | 0.073  | 0.084  | 0.079  | 0.069  | 0.054  |  0.07  | 0.073  | 0.045  | 0.062  | 0.014  | -0.058 |
| 2013-07-01 00:00:00 | 0.102  | 0.093  | 0.076  | 0.064  | 0.102  | 0.072  | 0.082  | 0.063  | 0.069  | 0.058  | -0.045 |
| 2013-08-01 00:00:00 | 0.053  | 0.064  | 0.046  | 0.045  | 0.048  | 0.061  | 0.043  | 0.051  |  0.07  | 0.047  | -0.006 |
| 2013-09-01 00:00:00 | -0.025 | -0.023 | -0.016 | -0.035 | -0.039 | -0.033 | -0.034 | -0.029 | -0.034 | -0.04  | -0.014 |
| 2013-10-01 00:00:00 | 0.092  | 0.095  | 0.083  | 0.083  | 0.084  | 0.083  | 0.055  | 0.063  | 0.052  | 0.039  | -0.054 |
| 2013-11-01 00:00:00 | -0.034 | -0.029 | -0.038 | -0.032 | -0.045 | -0.027 | -0.028 | -0.047 | -0.033 | -0.046 | -0.012 |
| 2013-12-01 00:00:00 | 0.001  | 0.017  | 0.038  | 0.057  | 0.027  | 0.002  | 0.036  | 0.002  | 0.012  | -0.052 | -0.053 |
| 2014-01-01 00:00:00 | 0.047  | 0.042  | 0.044  | 0.044  | 0.045  | 0.015  | 0.023  | 0.016  | -0.003 | -0.021 | -0.068 |
| 2014-02-01 00:00:00 | -0.023 | -0.02  | -0.04  | -0.038 | -0.039 | -0.039 | -0.043 | -0.051 | -0.041 | -0.028 | -0.005 |
| 2014-03-01 00:00:00 | -0.009 | -0.027 | -0.031 | -0.028 | -0.026 | -0.012 | -0.018 | -0.026 | -0.009 | -0.005 | 0.005  |
| 2014-04-01 00:00:00 | 0.027  | 0.035  | 0.034  | 0.028  |  0.05  | 0.025  |  0.02  | 0.022  | 0.018  | 0.002  | -0.024 |
| 2014-05-01 00:00:00 | 0.064  | 0.059  | 0.046  | 0.054  | 0.055  | 0.031  | 0.037  | 0.038  | 0.026  | 0.019  | -0.045 |
| 2014-06-01 00:00:00 |  0.09  | 0.076  | 0.076  | 0.068  |  0.06  | 0.082  | 0.075  | 0.067  | 0.065  | 0.079  | -0.012 |
| 2014-07-01 00:00:00 | 0.065  |  0.06  |  0.06  | 0.054  | 0.044  | 0.057  | 0.038  | 0.053  | 0.041  | 0.004  | -0.061 |
| 2014-08-01 00:00:00 | 0.152  | 0.141  | 0.143  | 0.124  | 0.119  | 0.114  | 0.127  | 0.101  |  0.09  | 0.064  | -0.089 |
| 2014-09-01 00:00:00 | 0.044  | 0.018  | 0.014  | 0.017  | 0.014  | 0.013  | 0.014  | 0.004  | 0.015  | 0.029  | -0.015 |
| 2014-10-01 00:00:00 | 0.067  | 0.049  | 0.062  |  0.07  | 0.045  |  0.04  | 0.048  | 0.055  | 0.076  | 0.123  | 0.056  |
| 2014-11-01 00:00:00 | -0.08  | -0.069 | -0.055 | -0.049 | -0.046 | -0.022 | 0.002  | -0.004 | 0.074  | 0.246  | 0.327  |
| 2014-12-01 00:00:00 | 0.108  | 0.105  | 0.094  | 0.097  | 0.087  | 0.068  | 0.077  | 0.082  | 0.062  | -0.026 | -0.135 |
| 2015-01-01 00:00:00 | 0.078  | 0.077  |  0.09  | 0.087  | 0.094  | 0.099  | 0.088  | 0.104  | 0.073  | 0.052  | -0.026 |
| 2015-02-01 00:00:00 | 0.259  | 0.235  | 0.248  | 0.252  | 0.229  | 0.214  | 0.228  | 0.209  | 0.184  | 0.142  | -0.116 |
| 2015-03-01 00:00:00 | 0.213  | 0.168  |  0.14  | 0.166  | 0.162  | 0.168  | 0.155  | 0.153  | 0.154  | 0.203  | -0.01  |
| 2015-04-01 00:00:00 | 0.302  | 0.264  | 0.261  | 0.253  | 0.252  | 0.252  | 0.204  | 0.182  | 0.119  | 0.036  | -0.266 |
| 2015-05-01 00:00:00 | -0.114 | -0.147 | -0.155 | -0.158 | -0.149 | -0.145 | -0.119 | -0.144 | -0.133 | -0.079 | 0.035  |
| 2015-06-01 00:00:00 | -0.212 | -0.204 | -0.201 | -0.192 | -0.177 | -0.176 | -0.15  | -0.17  | -0.154 | -0.159 | 0.052  |
| 2015-07-01 00:00:00 | -0.151 | -0.156 | -0.145 | -0.149 | -0.161 | -0.136 | -0.177 | -0.177 | -0.15  | -0.133 | 0.018  |
| 2015-08-01 00:00:00 | 0.012  |  0.0   | -0.017 | -0.004 | -0.016 | -0.022 | -0.028 | -0.045 | -0.062 | -0.053 | -0.065 |
| 2015-09-01 00:00:00 | 0.257  | 0.252  |  0.26  | 0.243  | 0.206  | 0.236  | 0.222  |  0.21  | 0.186  | 0.123  | -0.134 |
| 2015-10-01 00:00:00 | 0.152  | 0.146  | 0.116  | 0.116  | 0.096  | 0.063  | 0.069  | 0.049  | 0.024  | 0.009  | -0.143 |
| 2015-11-01 00:00:00 |  0.07  | 0.065  | 0.038  |  0.03  | 0.049  | 0.026  | 0.034  | 0.018  | 0.024  | 0.032  | -0.038 |
| 2015-12-01 00:00:00 | -0.309 | -0.309 | -0.31  | -0.31  | -0.311 | -0.295 | -0.301 | -0.308 | -0.278 | -0.243 | 0.066  |
| 2016-01-01 00:00:00 | -0.012 | -0.031 | -0.023 | -0.032 | -0.028 | -0.021 | -0.021 | -0.025 | -0.013 | -0.025 | -0.013 |
| 2016-02-01 00:00:00 | 0.204  |  0.21  | 0.204  | 0.209  | 0.196  |  0.19  | 0.172  | 0.171  | 0.162  | 0.132  | -0.072 |
| 2016-03-01 00:00:00 | 0.002  | -0.007 | -0.012 | -0.034 | -0.013 | -0.019 | -0.035 | -0.032 | -0.032 | -0.036 | -0.038 |
| 2016-04-01 00:00:00 | -0.017 | -0.009 | -0.006 | -0.012 |  0.0   | 0.007  | 0.002  | -0.01  | -0.005 | 0.001  | 0.018  |
| 2016-05-01 00:00:00 | 0.077  | 0.092  | 0.074  | 0.082  | 0.051  | 0.058  | 0.051  | 0.033  |  0.02  |  0.01  | -0.067 |
| 2016-06-01 00:00:00 | -0.012 | -0.011 | -0.029 | -0.014 | -0.022 | -0.033 | -0.007 | -0.017 | 0.031  | 0.028  | 0.041  |
| 2016-07-01 00:00:00 | 0.064  | 0.052  | 0.043  | 0.035  | 0.034  | 0.045  | 0.037  | 0.035  | 0.033  | 0.031  | -0.033 |
| 2016-08-01 00:00:00 | -0.025 | -0.015 | -0.015 | -0.021 | -0.028 | -0.028 | -0.026 | -0.029 | -0.03  | -0.034 | -0.009 |
| 2016-09-01 00:00:00 |  0.04  | 0.038  |  0.05  | 0.046  | 0.037  | 0.023  | 0.026  | 0.026  | 0.018  | 0.024  | -0.016 |
| 2016-10-01 00:00:00 |  0.03  | 0.016  | 0.029  | 0.025  | 0.014  | 0.015  | 0.016  | 0.014  | 0.036  | 0.045  | 0.015  |
| 2016-11-01 00:00:00 | -0.057 | -0.059 | -0.065 | -0.076 | -0.059 | -0.07  | -0.067 | -0.061 | -0.062 | -0.063 | -0.006 |
| 2016-12-01 00:00:00 | -0.037 | -0.036 | -0.041 | -0.035 | -0.032 | -0.03  | -0.03  | -0.018 | -0.008 | 0.012  | 0.049  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff  |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
| Average | 0.018 | 0.016 | 0.015 | 0.014 | 0.014 | 0.011 | 0.012 | 0.009 | 0.011 | 0.009 | -0.01  |
|  T-Test | 2.397 | 2.178 | 2.063 | 1.907 | 1.945 | 1.614 |  1.8  | 1.441 |  1.72 | 1.434 | -2.028 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
```

The third dataset excludes below 30% stocks from 2000-01-01 to 2016-12-01. The size effect is **significant** since the t-test statistics is -2.028 whose absolute value is more than 2 corresponding to the significance level at 0.05. The monthly excess return is **1.0%** and the annual excess return is about 12.0%. 

```python
# %% dataset 4
# select stocks whose trading days are more than or equal to 10 days
test_data_4 = month_return[month_return['Ndaytrd']>=10]
# construct data for univariate analysis
test_data_4 = test_data_4[['emrwd', 'Msmvttl', 'Time']].dropna()
# time interval between 2000-01-01 to 2016-12-01
test_data_4 = test_data_4[(test_data_4['Time'] >= '2000-01-01') & (test_data_4['Time'] <= '2016-12-01')]
# analysis
uni_4 = Univariate(np.array(test_data_4), number=9)
uni_4.average_by_time()
uni_4.summary_and_test()
uni_4.print_summary_by_time()
uni_4.print_summary()
==========================================================================================================================
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
|         Time        |   1    |   2    |   3    |   4    |   5    |   6    |   7    |   8    |   9    |   10   |  diff  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
| 2000-01-01 00:00:00 | 0.164  | 0.167  | 0.126  | 0.139  | 0.131  |  0.12  | 0.118  | 0.094  | 0.113  | 0.125  | -0.039 |
| 2000-02-01 00:00:00 | 0.208  | 0.203  | 0.128  | 0.151  | 0.085  | 0.113  | 0.052  | 0.053  | 0.044  | 0.002  | -0.206 |
| 2000-03-01 00:00:00 | 0.001  | 0.035  | 0.019  | 0.006  | 0.024  | 0.012  | -0.008 | 0.017  | 0.014  | 0.032  | 0.032  |
| 2000-04-01 00:00:00 | 0.056  |  0.06  | 0.052  | 0.038  | 0.047  | 0.034  | 0.028  | 0.039  | 0.025  | 0.021  | -0.035 |
| 2000-05-01 00:00:00 | 0.019  | 0.021  | 0.032  |  0.02  | 0.044  | 0.019  | 0.024  | 0.014  | 0.031  | 0.034  | 0.015  |
| 2000-06-01 00:00:00 | 0.108  | 0.057  | 0.056  | 0.062  | 0.047  | 0.047  |  0.05  | 0.029  | 0.035  | 0.041  | -0.067 |
| 2000-07-01 00:00:00 | 0.053  | 0.039  | 0.023  | 0.009  | -0.001 | -0.002 | -0.006 | -0.015 | -0.007 | -0.021 | -0.074 |
| 2000-08-01 00:00:00 | 0.016  | -0.027 | -0.033 | -0.022 | -0.038 | -0.053 | -0.059 | -0.045 | -0.059 | -0.056 | -0.072 |
| 2000-09-01 00:00:00 | 0.065  | 0.058  | 0.049  | 0.048  | 0.034  | 0.035  | 0.026  | 0.029  | 0.014  | 0.007  | -0.057 |
| 2000-10-01 00:00:00 | 0.073  | 0.063  | 0.064  | 0.059  | 0.066  | 0.064  | 0.062  | 0.053  | 0.051  | 0.054  | -0.019 |
| 2000-11-01 00:00:00 | -0.002 | 0.028  | 0.025  | 0.008  | 0.014  | 0.005  | 0.006  | 0.011  | -0.003 | -0.024 | -0.023 |
| 2000-12-01 00:00:00 | -0.024 | -0.019 | -0.012 | -0.006 | -0.012 | -0.006 | -0.014 | -0.003 | -0.003 | -0.02  | 0.003  |
| 2001-01-01 00:00:00 | -0.098 | -0.062 | -0.067 | -0.072 | -0.062 | -0.062 | -0.052 | -0.064 | -0.051 | -0.049 |  0.05  |
| 2001-02-01 00:00:00 | 0.114  | 0.103  | 0.088  | 0.088  | 0.079  | 0.084  | 0.079  | 0.076  | 0.062  | 0.058  | -0.056 |
| 2001-03-01 00:00:00 |  0.04  | 0.019  | 0.001  | 0.012  | -0.005 | -0.003 | -0.009 | 0.002  | -0.014 | -0.015 | -0.055 |
| 2001-04-01 00:00:00 | 0.096  | 0.087  | 0.084  | 0.066  | 0.047  | 0.048  | 0.031  | 0.036  | 0.025  | 0.012  | -0.084 |
| 2001-05-01 00:00:00 | 0.016  | 0.007  | 0.017  | 0.016  |  0.01  | 0.013  | 0.011  | -0.001 | 0.005  | -0.006 | -0.022 |
| 2001-06-01 00:00:00 | -0.133 | -0.143 | -0.135 | -0.135 | -0.133 | -0.138 | -0.143 | -0.129 | -0.127 | -0.134 | -0.002 |
| 2001-07-01 00:00:00 | -0.001 | -0.013 | -0.021 | -0.03  | -0.037 | -0.037 | -0.041 | -0.04  | -0.032 | -0.043 | -0.042 |
| 2001-08-01 00:00:00 | -0.087 | -0.059 | -0.069 | -0.065 | -0.053 | -0.062 | -0.048 | -0.043 | -0.047 | -0.032 | 0.055  |
| 2001-09-01 00:00:00 | -0.057 | -0.064 | -0.059 | -0.058 | -0.056 | -0.057 | -0.065 | -0.046 | -0.056 | -0.033 | 0.024  |
| 2001-10-01 00:00:00 | 0.079  | 0.066  | 0.064  | 0.057  | 0.048  | 0.051  | 0.039  | 0.042  | 0.035  | 0.027  | -0.052 |
| 2001-11-01 00:00:00 | -0.09  | -0.083 | -0.077 | -0.073 | -0.072 | -0.075 | -0.064 | -0.067 | -0.054 | -0.047 | 0.044  |
| 2001-12-01 00:00:00 | -0.166 | -0.135 | -0.149 | -0.142 | -0.126 | -0.123 | -0.115 | -0.109 | -0.095 | -0.067 | 0.099  |
| 2002-01-01 00:00:00 | 0.095  | 0.052  | 0.041  | 0.038  | 0.044  | 0.036  | 0.029  |  0.03  | 0.018  | 0.014  | -0.081 |
| 2002-02-01 00:00:00 | 0.102  | 0.099  |  0.09  | 0.089  | 0.081  | 0.075  | 0.072  | 0.073  | 0.062  | 0.037  | -0.065 |
| 2002-03-01 00:00:00 | 0.081  | 0.067  | 0.054  | 0.057  | 0.055  | 0.041  | 0.045  | 0.032  | 0.037  | 0.031  | -0.049 |
| 2002-04-01 00:00:00 | -0.077 | -0.083 | -0.082 | -0.092 | -0.094 | -0.092 | -0.092 | -0.089 | -0.091 | -0.081 | -0.004 |
| 2002-05-01 00:00:00 | 0.091  | 0.091  | 0.106  | 0.113  | 0.114  | 0.116  | 0.118  | 0.136  | 0.133  | 0.156  | 0.065  |
| 2002-06-01 00:00:00 | -0.026 | -0.032 | -0.034 | -0.033 | -0.034 | -0.036 | -0.043 | -0.04  | -0.047 | -0.042 | -0.016 |
| 2002-07-01 00:00:00 | 0.023  | 0.014  | 0.011  |  0.01  | 0.001  | 0.003  | 0.008  | 0.009  | 0.003  | 0.004  | -0.019 |
| 2002-08-01 00:00:00 | -0.063 | -0.06  | -0.055 | -0.059 | -0.06  | -0.062 | -0.057 | -0.053 | -0.047 | -0.049 | 0.014  |
| 2002-09-01 00:00:00 | -0.051 | -0.071 | -0.06  | -0.074 | -0.057 | -0.047 | -0.054 | -0.05  | -0.044 | -0.048 | 0.004  |
| 2002-10-01 00:00:00 | -0.097 | -0.091 | -0.09  | -0.089 | -0.085 | -0.08  | -0.073 | -0.076 | -0.05  | -0.038 | 0.059  |
| 2002-11-01 00:00:00 | -0.029 | -0.053 | -0.052 | -0.056 | -0.056 | -0.054 | -0.057 | -0.054 | -0.05  | -0.047 | -0.018 |
| 2002-12-01 00:00:00 | 0.134  | 0.123  | 0.113  | 0.114  | 0.098  | 0.101  | 0.092  |  0.08  | 0.075  |  0.09  | -0.044 |
| 2003-01-01 00:00:00 | 0.018  | 0.022  | 0.023  | 0.015  | 0.016  |  0.01  | 0.013  | 0.013  | 0.009  | 0.005  | -0.013 |
| 2003-02-01 00:00:00 | -0.042 | -0.031 | -0.042 | -0.034 | -0.033 | -0.033 | -0.021 | -0.022 | -0.007 |  0.01  | 0.052  |
| 2003-03-01 00:00:00 | -0.094 | -0.067 | -0.081 | -0.067 | -0.038 | -0.051 | -0.035 | -0.011 | 0.005  | 0.021  | 0.115  |
| 2003-04-01 00:00:00 | 0.037  | 0.039  | 0.028  | 0.032  | 0.034  | 0.037  | 0.038  | 0.049  | 0.054  | 0.055  | 0.018  |
| 2003-05-01 00:00:00 | -0.055 | -0.061 | -0.068 | -0.066 | -0.07  | -0.072 | -0.075 | -0.079 | -0.057 | -0.065 | -0.01  |
| 2003-06-01 00:00:00 | -0.05  | -0.049 | -0.041 | -0.039 | -0.037 | -0.036 | -0.03  | -0.023 | -0.007 | 0.013  | 0.063  |
| 2003-07-01 00:00:00 | -0.001 | -0.014 | -0.016 | -0.017 | -0.023 | -0.037 | -0.034 | -0.033 | -0.021 | -0.043 | -0.042 |
| 2003-08-01 00:00:00 | -0.054 | -0.056 | -0.053 | -0.043 | -0.051 | -0.037 | -0.035 | -0.046 | -0.047 | -0.037 | 0.017  |
| 2003-09-01 00:00:00 | -0.114 | -0.096 | -0.086 | -0.08  | -0.075 | -0.065 | -0.066 | -0.044 | -0.028 | 0.003  | 0.117  |
| 2003-10-01 00:00:00 | 0.002  | 0.003  | 0.009  | 0.012  | 0.024  | 0.029  | 0.028  | 0.026  | 0.014  | 0.024  | 0.022  |
| 2003-11-01 00:00:00 | -0.069 | -0.038 | -0.033 | -0.016 | -0.034 | -0.006 | 0.004  | 0.025  | 0.032  |  0.07  | 0.138  |
| 2003-12-01 00:00:00 | 0.111  | 0.105  | 0.102  | 0.096  | 0.099  | 0.097  | 0.084  | 0.068  | 0.073  | 0.052  | -0.058 |
| 2004-01-01 00:00:00 | 0.145  | 0.125  | 0.102  |  0.12  |  0.08  | 0.104  | 0.091  | 0.076  | 0.074  | 0.056  | -0.089 |
| 2004-02-01 00:00:00 | 0.048  | 0.055  | 0.054  | 0.044  | 0.035  | 0.055  | 0.038  | 0.033  | 0.034  | 0.026  | -0.022 |
| 2004-03-01 00:00:00 | -0.115 | -0.124 | -0.105 | -0.098 | -0.093 | -0.098 | -0.095 | -0.084 | -0.096 | -0.107 | 0.008  |
| 2004-04-01 00:00:00 | 0.017  | -0.013 | -0.009 | -0.03  | -0.003 | -0.025 | -0.021 | -0.025 | -0.023 | -0.033 | -0.049 |
| 2004-05-01 00:00:00 | -0.139 | -0.132 | -0.13  | -0.128 | -0.134 | -0.132 | -0.13  | -0.116 | -0.122 | -0.091 | 0.048  |
| 2004-06-01 00:00:00 | -0.072 | -0.059 | -0.054 | -0.025 | -0.027 | -0.023 |  0.01  | 0.005  | 0.014  | 0.008  |  0.08  |
| 2004-07-01 00:00:00 | -0.066 | -0.061 | -0.053 | -0.05  | -0.047 | -0.055 | -0.061 | -0.064 | -0.061 | -0.032 | 0.034  |
| 2004-08-01 00:00:00 | 0.031  | 0.051  | 0.053  | 0.056  | 0.048  | 0.051  | 0.056  | 0.057  |  0.06  | 0.059  | 0.028  |
| 2004-09-01 00:00:00 | -0.129 | -0.091 | -0.081 | -0.067 | -0.066 | -0.053 | -0.064 | -0.058 | -0.028 | -0.04  | 0.089  |
| 2004-10-01 00:00:00 | 0.109  | 0.063  |  0.06  | 0.056  | 0.047  | 0.048  | 0.037  | 0.041  |  0.01  | -0.001 | -0.11  |
| 2004-11-01 00:00:00 | -0.089 | -0.092 | -0.093 | -0.077 | -0.086 | -0.08  | -0.091 | -0.08  | -0.07  | -0.056 | 0.033  |
| 2004-12-01 00:00:00 | -0.045 | -0.062 | -0.084 | -0.077 | -0.081 | -0.075 | -0.084 | -0.076 | -0.078 | -0.052 | -0.006 |
| 2005-01-01 00:00:00 | 0.114  | 0.105  | 0.112  | 0.113  | 0.109  | 0.102  | 0.118  | 0.115  | 0.094  | 0.092  | -0.022 |
| 2005-02-01 00:00:00 | -0.137 | -0.14  | -0.132 | -0.142 | -0.136 | -0.136 | -0.12  | -0.113 | -0.108 | -0.086 |  0.05  |
| 2005-03-01 00:00:00 | -0.14  | -0.125 | -0.092 | -0.096 | -0.081 | -0.053 | -0.065 | -0.037 | -0.026 | 0.004  | 0.144  |
| 2005-04-01 00:00:00 | 0.019  | -0.013 | -0.023 | -0.02  | -0.023 | -0.032 | -0.052 | -0.055 | -0.081 | -0.094 | -0.112 |
| 2005-05-01 00:00:00 | 0.001  |  0.0   | -0.001 | 0.004  | -0.003 | -0.001 | -0.006 | -0.001 | -0.002 | 0.029  | 0.028  |
| 2005-06-01 00:00:00 |  -0.1  |  -0.1  | -0.083 | -0.08  | -0.073 | -0.068 | -0.064 | -0.054 | -0.028 | 0.011  | 0.111  |
| 2005-07-01 00:00:00 | 0.258  | 0.196  | 0.192  | 0.174  | 0.173  | 0.152  | 0.136  | 0.124  | 0.119  |  0.05  | -0.208 |
| 2005-08-01 00:00:00 | 0.081  | 0.027  | 0.031  | 0.025  | -0.002 | 0.027  | 0.029  | 0.029  | 0.027  | -0.004 | -0.085 |
| 2005-09-01 00:00:00 | -0.083 | -0.056 | -0.06  | -0.067 | -0.058 | -0.052 | -0.056 | -0.056 | -0.048 | -0.052 | 0.031  |
| 2005-10-01 00:00:00 | 0.032  | 0.028  | 0.037  | 0.017  | 0.015  |  0.01  | 0.013  | -0.003 | -0.014 | -0.012 | -0.044 |
| 2005-11-01 00:00:00 | -0.011 | -0.005 | 0.001  | 0.017  | 0.012  | 0.023  | 0.032  | 0.053  | 0.067  | 0.073  | 0.085  |
| 2005-12-01 00:00:00 | -0.008 | 0.056  | 0.076  |  0.09  | 0.078  | 0.091  |  0.11  |  0.13  | 0.127  | 0.096  | 0.104  |
| 2006-01-01 00:00:00 | 0.094  | 0.047  | 0.026  | 0.032  | 0.021  | 0.022  | 0.017  | 0.019  | -0.001 | 0.043  | -0.051 |
| 2006-02-01 00:00:00 | -0.037 | -0.008 | -0.004 | -0.002 | 0.004  | 0.006  | 0.031  | 0.028  | 0.057  | 0.027  | 0.064  |
| 2006-03-01 00:00:00 | 0.139  | 0.007  | 0.082  |  0.08  | 0.099  | 0.113  | 0.105  | 0.133  | 0.139  | 0.151  | 0.011  |
| 2006-04-01 00:00:00 |  1.07  | 0.313  | 0.307  | 0.308  | 0.274  | 0.269  | 0.258  | 0.237  | 0.213  | 0.164  | -0.906 |
| 2006-05-01 00:00:00 |  0.07  | 0.079  | 0.066  | 0.083  | 0.065  | 0.071  | 0.039  | 0.053  | 0.024  | 0.021  | -0.049 |
| 2006-06-01 00:00:00 | 0.001  | 0.005  | -0.014 | -0.012 | -0.037 | -0.028 | -0.041 | -0.059 | -0.047 | -0.084 | -0.085 |
| 2006-07-01 00:00:00 | 0.022  |  0.03  | 0.025  | 0.023  | 0.032  | 0.033  | 0.035  | 0.045  |  0.04  | 0.027  | 0.005  |
| 2006-08-01 00:00:00 | 0.113  | 0.065  | 0.062  | 0.049  | 0.052  | 0.041  | 0.046  | 0.036  | 0.037  | 0.043  | -0.07  |
| 2006-09-01 00:00:00 | -0.01  | -0.013 | -0.018 | -0.002 | 0.016  | -0.017 | -0.011 |  -0.0  | 0.019  | 0.029  | 0.039  |
| 2006-10-01 00:00:00 | -0.011 | -0.007 | -0.003 | 0.022  | 0.025  | 0.035  | 0.063  | 0.059  | 0.105  | 0.171  | 0.182  |
| 2006-11-01 00:00:00 | 0.011  | 0.036  | 0.035  |  0.05  | 0.035  | 0.042  | 0.069  | 0.085  | 0.095  | 0.153  | 0.141  |
| 2006-12-01 00:00:00 | 0.305  | 0.269  |  0.26  | 0.286  | 0.257  |  0.25  | 0.224  | 0.234  | 0.241  |  0.19  | -0.115 |
| 2007-01-01 00:00:00 | 0.257  | 0.244  | 0.241  | 0.223  | 0.217  | 0.186  | 0.245  | 0.136  |  0.15  | 0.083  | -0.175 |
| 2007-02-01 00:00:00 | 0.272  | 0.261  | 0.216  | 0.204  | 0.191  | 0.164  | 0.175  | 0.143  | 0.085  | 0.087  | -0.185 |
| 2007-03-01 00:00:00 | 0.332  | 0.329  | 0.343  | 0.363  | 0.339  | 0.322  | 0.336  | 0.348  | 0.347  | 0.283  | -0.049 |
| 2007-04-01 00:00:00 | 0.199  | 0.088  | 0.089  | 0.081  | 0.071  | 0.131  | 0.111  | 0.079  | 0.106  | 0.135  | -0.064 |
| 2007-05-01 00:00:00 | -0.22  | -0.23  | -0.216 | -0.211 | -0.189 | -0.155 | -0.159 | -0.13  | -0.092 | -0.04  | 0.181  |
| 2007-06-01 00:00:00 | 0.296  | 0.287  | 0.278  | 0.244  | 0.236  | 0.236  | 0.212  | 0.186  | 0.189  | 0.185  | -0.111 |
| 2007-07-01 00:00:00 | 0.198  | 0.127  | 0.104  | 0.099  | 0.094  | 0.096  | 0.115  | 0.108  | 0.143  |  0.18  | -0.018 |
| 2007-08-01 00:00:00 | 0.046  | 0.016  | 0.018  | 0.025  | 0.035  | 0.042  | 0.029  |  0.04  | 0.054  | 0.075  | 0.029  |
| 2007-09-01 00:00:00 | -0.124 | -0.139 | -0.115 | -0.117 | -0.121 | -0.099 | -0.117 | -0.097 | -0.084 | -0.007 | 0.117  |
| 2007-10-01 00:00:00 | 0.009  | -0.013 | -0.019 | -0.052 | -0.049 | -0.075 | -0.08  |  -0.1  | -0.134 | -0.187 | -0.196 |
| 2007-11-01 00:00:00 | 0.184  | 0.205  | 0.204  | 0.208  |  0.21  |  0.21  |  0.22  | 0.216  |  0.2   | 0.148  | -0.036 |
| 2007-12-01 00:00:00 | -0.054 | -0.06  | -0.063 | -0.051 | -0.077 | -0.047 | -0.059 | -0.069 | -0.084 | -0.12  | -0.067 |
| 2008-01-01 00:00:00 | 0.116  | 0.109  | 0.117  | 0.107  | 0.101  | 0.083  | 0.076  | 0.065  | 0.043  | 0.017  | -0.099 |
| 2008-02-01 00:00:00 | -0.174 | -0.171 | -0.181 | -0.182 | -0.199 | -0.201 | -0.199 | -0.217 | -0.224 | -0.212 | -0.039 |
| 2008-03-01 00:00:00 | -0.087 | -0.091 | -0.077 | -0.075 | -0.069 | -0.051 | -0.049 | -0.006 | 0.017  | 0.043  |  0.13  |
| 2008-04-01 00:00:00 | 0.006  | -0.007 | -0.008 | -0.003 | -0.026 | -0.039 | -0.027 | -0.059 | -0.048 | -0.078 | -0.084 |
| 2008-05-01 00:00:00 | -0.239 | -0.234 | -0.266 | -0.275 | -0.249 | -0.26  | -0.239 | -0.25  | -0.234 | -0.221 | 0.018  |
| 2008-06-01 00:00:00 | 0.137  | 0.118  | 0.116  | 0.111  | 0.108  | 0.103  | 0.072  | 0.076  | 0.052  | 0.005  | -0.132 |
| 2008-07-01 00:00:00 | -0.207 | -0.224 | -0.227 | -0.233 | -0.223 | -0.238 | -0.241 | -0.238 | -0.229 | -0.194 | 0.013  |
| 2008-08-01 00:00:00 | -0.117 | -0.104 | -0.09  | -0.098 | -0.101 | -0.08  | -0.085 | -0.061 | -0.044 | -0.026 |  0.09  |
| 2008-09-01 00:00:00 | -0.225 | -0.232 | -0.249 | -0.265 | -0.247 | -0.266 | -0.272 | -0.262 | -0.275 | -0.248 | -0.023 |
| 2008-10-01 00:00:00 | 0.231  | 0.215  | 0.219  | 0.221  | 0.225  | 0.223  | 0.185  | 0.161  | 0.157  | 0.131  | -0.101 |
| 2008-11-01 00:00:00 | 0.155  |  0.13  | 0.094  | 0.097  | 0.061  | 0.068  | 0.053  | 0.065  | 0.041  | 0.013  | -0.142 |
| 2008-12-01 00:00:00 | 0.149  | 0.161  | 0.163  | 0.159  | 0.162  | 0.187  | 0.162  | 0.169  | 0.158  | 0.119  | -0.03  |
| 2009-01-01 00:00:00 | 0.124  | 0.116  | 0.094  | 0.084  | 0.092  |  0.09  | 0.073  | 0.081  | 0.057  | 0.063  | -0.061 |
| 2009-02-01 00:00:00 | 0.255  | 0.254  | 0.235  | 0.246  | 0.226  | 0.224  |  0.21  | 0.209  | 0.198  | 0.186  | -0.069 |
| 2009-03-01 00:00:00 | 0.102  |  0.11  | 0.078  | 0.074  | 0.081  | 0.073  | 0.038  | 0.066  | 0.041  |  0.05  | -0.052 |
| 2009-04-01 00:00:00 | 0.096  | 0.092  | 0.106  |  0.07  | 0.085  | 0.062  | 0.057  | 0.047  | 0.045  | 0.056  | -0.041 |
| 2009-05-01 00:00:00 | 0.112  | 0.081  | 0.061  | 0.039  |  0.04  | 0.055  | 0.039  | 0.053  | 0.078  | 0.124  | 0.012  |
| 2009-06-01 00:00:00 | 0.134  | 0.125  | 0.133  | 0.136  | 0.143  | 0.155  | 0.129  | 0.153  | 0.182  | 0.183  |  0.05  |
| 2009-07-01 00:00:00 | -0.124 | -0.141 | -0.151 | -0.144 | -0.147 | -0.139 | -0.155 | -0.171 | -0.18  | -0.236 | -0.112 |
| 2009-08-01 00:00:00 | 0.055  | 0.041  | 0.044  | 0.024  |  0.03  | 0.037  | 0.032  | 0.035  |  0.04  | 0.052  | -0.003 |
| 2009-09-01 00:00:00 | 0.124  | 0.133  | 0.129  | 0.128  |  0.12  | 0.132  |  0.12  | 0.112  | 0.108  | 0.092  | -0.032 |
| 2009-10-01 00:00:00 | 0.167  | 0.173  | 0.153  | 0.158  | 0.163  | 0.178  | 0.144  | 0.142  | 0.109  | 0.084  | -0.083 |
| 2009-11-01 00:00:00 | 0.052  | 0.039  | 0.035  | 0.029  | 0.035  | 0.032  | 0.006  | 0.005  | -0.005 | 0.004  | -0.048 |
| 2009-12-01 00:00:00 | -0.016 | -0.011 | -0.033 | -0.026 | -0.018 | -0.031 | -0.019 | -0.035 | -0.049 |  -0.1  | -0.084 |
| 2010-01-01 00:00:00 |  0.09  | 0.082  | 0.078  | 0.064  | 0.061  | 0.068  | 0.059  | 0.057  | 0.043  | 0.025  | -0.065 |
| 2010-02-01 00:00:00 | 0.086  | 0.067  | 0.064  | 0.053  | 0.039  | 0.042  | 0.046  | 0.017  | 0.017  | 0.011  | -0.075 |
| 2010-03-01 00:00:00 | -0.056 | -0.063 | -0.082 | -0.084 | -0.072 | -0.068 | -0.07  | -0.078 | -0.063 | -0.073 | -0.017 |
| 2010-04-01 00:00:00 | -0.088 | -0.08  | -0.073 | -0.088 | -0.094 | -0.077 | -0.08  | -0.065 | -0.078 | -0.089 |  -0.0  |
| 2010-05-01 00:00:00 | -0.082 | -0.083 | -0.087 | -0.083 | -0.091 | -0.094 | -0.099 | -0.101 | -0.098 | -0.081 | 0.001  |
| 2010-06-01 00:00:00 | 0.168  | 0.164  | 0.153  | 0.149  | 0.149  | 0.164  | 0.143  | 0.138  | 0.133  |  0.13  | -0.038 |
| 2010-07-01 00:00:00 | 0.107  | 0.106  |  0.09  | 0.113  | 0.097  | 0.096  | 0.084  | 0.109  | 0.075  | 0.027  | -0.08  |
| 2010-08-01 00:00:00 | 0.025  | -0.012 | -0.007 | 0.002  | 0.007  | -0.004 | -0.008 | 0.016  |  0.02  | 0.016  | -0.009 |
| 2010-09-01 00:00:00 | 0.062  | 0.078  | 0.074  | 0.098  | 0.082  | 0.091  | 0.093  | 0.098  | 0.114  | 0.156  | 0.094  |
| 2010-10-01 00:00:00 | 0.039  | 0.036  |  0.04  | 0.028  | 0.014  | 0.012  | 0.016  | 0.018  | -0.015 | -0.06  | -0.099 |
| 2010-11-01 00:00:00 | -0.007 | -0.023 | -0.015 | -0.024 | -0.029 | -0.035 | -0.027 | -0.034 | -0.018 | 0.007  | 0.014  |
| 2010-12-01 00:00:00 | -0.031 | -0.055 | -0.053 | -0.059 | -0.06  | -0.058 | -0.067 | -0.065 | -0.065 | -0.025 | 0.006  |
| 2011-01-01 00:00:00 | 0.099  | 0.104  | 0.101  | 0.093  | 0.106  | 0.096  | 0.105  | 0.102  | 0.085  | 0.059  | -0.04  |
| 2011-02-01 00:00:00 | 0.034  | 0.004  | -0.008 | -0.001 | -0.019 | -0.024 | -0.036 | -0.022 | -0.027 | -0.027 | -0.06  |
| 2011-03-01 00:00:00 | -0.029 | -0.04  | -0.039 | -0.051 | -0.046 | -0.046 | -0.029 | -0.037 | -0.034 | -0.019 |  0.01  |
| 2011-04-01 00:00:00 | -0.062 | -0.074 | -0.068 | -0.075 | -0.06  | -0.081 | -0.081 | -0.081 | -0.083 | -0.067 | -0.005 |
| 2011-05-01 00:00:00 | 0.044  | 0.045  | 0.035  |  0.03  | 0.046  | 0.025  | 0.034  | 0.032  | 0.036  | 0.029  | -0.015 |
| 2011-06-01 00:00:00 |  0.04  | 0.029  |  0.03  | 0.033  | 0.033  | 0.021  | 0.016  | 0.024  | 0.011  | -0.012 | -0.052 |
| 2011-07-01 00:00:00 | 0.008  | -0.009 | -0.014 | -0.019 | -0.031 | -0.031 | -0.035 | -0.033 | -0.047 | -0.052 | -0.06  |
| 2011-08-01 00:00:00 | -0.109 | -0.117 | -0.122 | -0.119 | -0.121 | -0.133 | -0.13  | -0.137 | -0.122 | -0.096 | 0.013  |
| 2011-09-01 00:00:00 | 0.054  | 0.044  | 0.046  |  0.04  | 0.046  | 0.044  | 0.039  | 0.046  | 0.039  | 0.035  | -0.019 |
| 2011-10-01 00:00:00 | -0.03  | -0.022 | -0.042 | -0.048 | -0.027 | -0.038 | -0.045 | -0.04  | -0.055 | -0.065 | -0.035 |
| 2011-11-01 00:00:00 | -0.177 | -0.178 | -0.169 | -0.171 | -0.172 | -0.152 | -0.164 | -0.142 | -0.12  | -0.085 | 0.092  |
| 2011-12-01 00:00:00 |  0.01  | -0.007 | -0.021 | -0.023 | -0.007 | -0.014 | -0.009 | -0.007 | -0.004 | 0.035  | 0.025  |
| 2012-01-01 00:00:00 |  0.16  | 0.155  | 0.149  | 0.142  | 0.137  | 0.136  | 0.127  | 0.127  | 0.117  | 0.082  | -0.078 |
| 2012-02-01 00:00:00 | -0.079 | -0.081 | -0.073 | -0.07  | -0.076 | -0.077 | -0.076 | -0.078 | -0.073 | -0.074 | 0.004  |
| 2012-03-01 00:00:00 | 0.061  | 0.064  | 0.069  | 0.084  | 0.065  | 0.068  | 0.072  |  0.06  | 0.057  | 0.069  | 0.008  |
| 2012-04-01 00:00:00 |  0.04  | 0.029  | 0.012  | 0.023  | 0.023  |  0.02  | 0.023  | 0.031  | 0.032  | 0.013  | -0.028 |
| 2012-05-01 00:00:00 | -0.018 | -0.035 | -0.055 | -0.058 | -0.061 | -0.07  | -0.068 | -0.071 | -0.062 | -0.061 | -0.043 |
| 2012-06-01 00:00:00 | -0.125 | -0.108 | -0.095 | -0.101 | -0.097 | -0.102 | -0.093 | -0.087 | -0.081 | -0.057 | 0.068  |
| 2012-07-01 00:00:00 | 0.068  | 0.064  | 0.055  | 0.047  | 0.032  | 0.033  | 0.013  | 0.005  | -0.023 | -0.053 | -0.121 |
| 2012-08-01 00:00:00 | 0.014  | 0.016  | -0.007 | 0.004  | 0.004  | -0.001 | -0.001 | 0.018  | 0.017  | 0.039  | 0.026  |
| 2012-09-01 00:00:00 | 0.012  |  0.01  | 0.004  | -0.001 | 0.003  |  -0.0  | -0.01  | -0.008 | -0.018 | -0.016 | -0.028 |
| 2012-10-01 00:00:00 | -0.095 | -0.12  | -0.115 | -0.12  | -0.122 | -0.116 | -0.124 | -0.116 | -0.105 | -0.066 | 0.029  |
| 2012-11-01 00:00:00 | 0.167  | 0.175  | 0.165  | 0.169  | 0.181  | 0.164  | 0.174  | 0.179  | 0.166  | 0.175  | 0.008  |
| 2012-12-01 00:00:00 | 0.062  | 0.057  | 0.073  | 0.071  | 0.071  | 0.064  | 0.059  | 0.065  | 0.056  | 0.054  | -0.008 |
| 2013-01-01 00:00:00 |  0.06  | 0.041  | 0.041  | 0.041  | 0.037  | 0.034  | 0.039  | 0.041  | 0.036  | 0.005  | -0.055 |
| 2013-02-01 00:00:00 | -0.025 | -0.026 | -0.017 | -0.03  | -0.03  | -0.025 | -0.048 | -0.045 | -0.047 | -0.053 | -0.028 |
| 2013-03-01 00:00:00 | -0.023 | -0.048 | -0.04  | -0.031 | -0.032 | -0.027 | -0.027 | -0.019 | -0.021 | -0.022 | 0.002  |
| 2013-04-01 00:00:00 | 0.177  | 0.155  | 0.157  | 0.153  | 0.153  | 0.146  | 0.151  | 0.152  | 0.132  | 0.076  | -0.102 |
| 2013-05-01 00:00:00 | -0.139 | -0.157 | -0.155 | -0.155 | -0.161 | -0.158 | -0.15  | -0.164 | -0.153 | -0.14  | -0.001 |
| 2013-06-01 00:00:00 | 0.123  | 0.086  | 0.072  | 0.075  | 0.083  | 0.063  | 0.063  | 0.072  | 0.051  | 0.028  | -0.095 |
| 2013-07-01 00:00:00 | 0.104  | 0.092  | 0.112  |  0.1   | 0.076  |  0.08  | 0.089  | 0.078  | 0.062  | 0.063  | -0.041 |
| 2013-08-01 00:00:00 | 0.076  | 0.053  | 0.052  | 0.053  | 0.059  | 0.043  | 0.056  | 0.049  | 0.056  | 0.054  | -0.021 |
| 2013-09-01 00:00:00 | -0.006 | -0.013 | -0.018 | -0.024 | -0.017 | -0.029 | -0.039 | -0.033 | -0.038 | -0.034 | -0.027 |
| 2013-10-01 00:00:00 | 0.131  | 0.128  | 0.111  | 0.086  | 0.097  | 0.083  | 0.076  | 0.068  | 0.055  | 0.044  | -0.087 |
| 2013-11-01 00:00:00 | -0.02  | -0.029 | -0.031 | -0.032 | -0.039 | -0.03  | -0.038 | -0.03  | -0.038 | -0.044 | -0.023 |
| 2013-12-01 00:00:00 | 0.035  | 0.062  | 0.024  |  0.01  | 0.031  | 0.046  | 0.007  | 0.035  | 0.004  | -0.031 | -0.066 |
| 2014-01-01 00:00:00 | 0.067  |  0.05  | 0.047  | 0.047  | 0.044  | 0.044  | 0.032  | 0.017  | 0.009  | -0.018 | -0.085 |
| 2014-02-01 00:00:00 | 0.025  | 0.003  | -0.013 | -0.021 | -0.033 | -0.037 | -0.042 | -0.043 | -0.043 | -0.036 | -0.061 |
| 2014-03-01 00:00:00 | 0.022  | 0.006  | -0.008 | -0.012 | -0.03  | -0.03  | -0.016 | -0.015 | -0.025 | -0.004 | -0.026 |
| 2014-04-01 00:00:00 | 0.115  | 0.055  | 0.048  | 0.027  | 0.036  | 0.032  | 0.037  | 0.022  |  0.02  | 0.008  | -0.107 |
| 2014-05-01 00:00:00 | 0.079  |  0.09  | 0.073  | 0.062  | 0.052  | 0.056  | 0.042  | 0.037  | 0.034  | 0.019  | -0.06  |
| 2014-06-01 00:00:00 | 0.104  | 0.075  | 0.075  | 0.083  | 0.077  | 0.069  | 0.072  | 0.072  | 0.066  | 0.077  | -0.027 |
| 2014-07-01 00:00:00 | 0.111  | 0.091  | 0.068  | 0.066  | 0.057  | 0.056  | 0.046  | 0.046  | 0.048  | 0.013  | -0.098 |
| 2014-08-01 00:00:00 | 0.211  | 0.191  | 0.158  | 0.146  | 0.146  | 0.122  |  0.12  |  0.12  | 0.104  | 0.066  | -0.145 |
| 2014-09-01 00:00:00 | 0.021  | 0.019  | 0.033  | 0.036  | 0.014  | 0.017  | 0.009  | 0.017  | 0.009  | 0.025  | 0.005  |
| 2014-10-01 00:00:00 | 0.069  | 0.075  | 0.047  | 0.064  | 0.054  |  0.07  | 0.037  | 0.048  | 0.062  | 0.109  |  0.04  |
| 2014-11-01 00:00:00 | -0.108 | -0.083 | -0.078 | -0.076 | -0.067 | -0.048 | -0.036 | 0.006  | 0.021  | 0.202  | 0.309  |
| 2014-12-01 00:00:00 | 0.116  | 0.106  | 0.112  | 0.104  |  0.09  | 0.099  | 0.074  | 0.076  | 0.075  | -0.001 | -0.116 |
| 2015-01-01 00:00:00 | 0.117  | 0.086  | 0.081  | 0.074  |  0.09  | 0.087  | 0.099  | 0.087  | 0.095  | 0.058  | -0.059 |
| 2015-02-01 00:00:00 | 0.271  | 0.243  | 0.243  | 0.251  |  0.24  | 0.242  | 0.224  | 0.225  | 0.201  | 0.153  | -0.118 |
| 2015-03-01 00:00:00 | 0.217  | 0.179  | 0.171  |  0.2   | 0.148  | 0.164  | 0.161  | 0.158  | 0.147  | 0.196  | -0.021 |
| 2015-04-01 00:00:00 | 0.373  | 0.317  | 0.294  | 0.284  | 0.276  | 0.256  | 0.253  | 0.203  | 0.158  | 0.059  | -0.314 |
| 2015-05-01 00:00:00 | -0.047 | -0.096 | -0.123 | -0.124 | -0.155 | -0.156 | -0.156 | -0.118 | -0.133 | -0.098 | -0.05  |
| 2015-06-01 00:00:00 | -0.161 | -0.178 | -0.209 | -0.209 | -0.203 | -0.19  | -0.179 | -0.152 | -0.159 | -0.164 | -0.003 |
| 2015-07-01 00:00:00 | -0.088 | -0.125 | -0.121 | -0.149 | -0.156 | -0.15  | -0.151 | -0.165 | -0.168 | -0.139 | -0.051 |
| 2015-08-01 00:00:00 | 0.004  | -0.005 | -0.003 | 0.009  | -0.011 | -0.011 | -0.01  | -0.034 | -0.046 | -0.061 | -0.065 |
| 2015-09-01 00:00:00 | 0.301  |  0.27  | 0.276  | 0.257  | 0.258  | 0.237  | 0.222  | 0.219  | 0.209  | 0.136  | -0.165 |
| 2015-10-01 00:00:00 | 0.203  | 0.193  | 0.173  | 0.148  | 0.128  | 0.111  | 0.081  | 0.061  | 0.045  | 0.013  | -0.19  |
| 2015-11-01 00:00:00 | 0.152  | 0.099  | 0.085  | 0.066  | 0.053  | 0.029  | 0.038  | 0.034  | 0.019  | 0.031  | -0.121 |
| 2015-12-01 00:00:00 | -0.303 | -0.296 | -0.309 | -0.31  | -0.306 | -0.311 | -0.305 | -0.298 | -0.301 | -0.25  | 0.053  |
| 2016-01-01 00:00:00 | 0.009  | -0.005 | -0.009 | -0.022 | -0.021 | -0.028 | -0.031 | -0.02  | -0.019 | -0.022 | -0.03  |
| 2016-02-01 00:00:00 | 0.257  | 0.223  |  0.22  | 0.201  | 0.208  | 0.214  | 0.187  | 0.179  | 0.169  | 0.137  | -0.12  |
| 2016-03-01 00:00:00 | 0.062  | 0.042  | 0.016  |  0.0   | -0.011 | -0.027 | -0.016 | -0.034 | -0.03  | -0.036 | -0.098 |
| 2016-04-01 00:00:00 | -0.035 | -0.029 | -0.023 | -0.011 | -0.01  | -0.007 | 0.003  | 0.002  | -0.005 | -0.004 | 0.031  |
| 2016-05-01 00:00:00 | 0.068  | 0.085  | 0.085  | 0.082  | 0.082  | 0.072  | 0.055  | 0.054  | 0.027  | 0.013  | -0.055 |
| 2016-06-01 00:00:00 | 0.002  | 0.001  | -0.009 | -0.014 | -0.02  | -0.02  | -0.026 | -0.011 | -0.003 | 0.034  | 0.032  |
| 2016-07-01 00:00:00 | 0.085  | 0.066  | 0.061  |  0.06  | 0.046  | 0.039  | 0.039  | 0.036  | 0.032  | 0.034  | -0.051 |
| 2016-08-01 00:00:00 | 0.057  | 0.016  | -0.005 | -0.019 | -0.014 | -0.021 | -0.031 | -0.026 | -0.031 | -0.032 | -0.089 |
| 2016-09-01 00:00:00 | 0.051  | 0.056  | 0.051  | 0.042  | 0.043  | 0.047  | 0.024  | 0.027  | 0.022  | 0.023  | -0.028 |
| 2016-10-01 00:00:00 | 0.062  | 0.055  | 0.036  | 0.025  | 0.026  | 0.021  | 0.016  | 0.016  | 0.021  | 0.044  | -0.019 |
| 2016-11-01 00:00:00 | 0.007  | -0.039 | -0.039 | -0.06  | -0.063 | -0.071 | -0.067 | -0.065 | -0.06  | -0.063 | -0.07  |
| 2016-12-01 00:00:00 | -0.043 | -0.037 | -0.043 | -0.04  | -0.037 | -0.034 | -0.03  | -0.029 | -0.021 | 0.012  | 0.055  |
+---------------------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+--------+
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff  |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
| Average | 0.036 | 0.024 | 0.019 | 0.018 | 0.015 | 0.015 | 0.011 | 0.012 |  0.01 | 0.009 | -0.027 |
|  T-Test | 3.823 |  3.07 | 2.584 | 2.358 |  2.08 | 2.044 | 1.619 | 1.796 | 1.566 | 1.508 | -3.949 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
```

The fourth dataset includes below 30% stocks from 2000-01-01 to 2016-12-01. The size effect is **significant** since the t-test statistics is -3.949 whose absolute value is more than 2 corresponding to the significance level at 0.05. The monthly excess return is **2.7%** and the annual excess return is about 32.4%. 

The size effect provides **0.6%** excess return a month in U.S. market. 



### Value Effect

The value effect was discovered since 1980s and became famous since the research by Fama and French (1993). The value factor, as one of systematic factors, is constructed by the variable, book to market ratio (BM). The positive correlation between the BM and the future return is widely tested by literatures (Fama and French, 1993, 1995; Stattman, 1980; Barber and Lyon, 1997). Other than BM, some value-related variables are also taken into consideration, and the most common one is earnings to price ratio, EP (Basu, 1983). Aras and Yilmaz (2008) and Cakici et al. (2013) discovered the value effect is existing in 12 and 18 emerging markets, respectively. 

As for the value effect in China market, Liu et al. (2019) argue that EP is more suitable than BM, through which they construct the value factor in China market. In this demo, the BM and EP are both tested, while some adjustment are attached to these variables, and precisely the reverse form of theses two variables are used respectively named, price to earnings ratio (PE) and price to book ratio (PB). Thus, the relation between the variables and the future return is negative.

Following the conventions, stocks are grouped by two variables, market value (size) and value variables, independently and formed a 5*5 portfolio matrix. The dataset contains monthly China A share stock between 2000-01-01 to 2021-12-31 from the CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.**

```python
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
company_data = pd.read_hdf('.\data\last_filter_pe.h5', key='data')
```

Data need some preprocessing.

```python
# %% preprocessing data
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
# %% merge data
from pandas.tseries.offsets import *

month_return['Stkcd_merge'] = month_return['Stkcd'].astype(dtype='string')
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])
#month_return['Date_merge'] += MonthEnd()

company_data['Stkcd_merge'] = company_data['Symbol'].dropna().astype(dtype='int').astype(dtype='string')
company_data['Date_merge'] = pd.to_datetime(company_data['TradingDate'])
company_data['Date_merge'] += MonthBegin()
```

Consistent with the size effect, the dataset starts from 2000-01. 

```python
# %% dataset starts from '2000-01'
company_data = company_data[company_data['Date_merge'] >= '2000-01']
month_return = month_return[month_return['Date_merge'] >= '2000-01']
return_company = pd.merge(company_data, month_return, on=['Stkcd_merge', 'Date_merge'])
```

Four datasets are tested. Due to specific requirement of the IPO, some dominant company would purchase a small listed company and join the A share market. Thus, in the research by Liu et al. (2016), the stocks whose size is below the 30% are abandoned. The PE and PB are both tested. 

```python
# %% construct test_data for bivariate analysis
# dataset 1 : PE
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'PE1A', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Independent-sort Bivariate Analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.019  | 0.017  | 0.013  | 0.013  |  0.01  | -0.009 |
|       | 3.024  | 2.693  | 2.003  |  1.89  | 1.472  | -3.551 |
|   2   | 0.014  | 0.015  | 0.011  | 0.011  | 0.009  | -0.005 |
|       |  2.25  | 2.415  | 1.779  | 1.658  | 1.374  | -1.947 |
|   3   | 0.014  |  0.01  | 0.009  | 0.009  | 0.005  | -0.009 |
|       | 2.298  | 1.648  | 1.478  |  1.36  | 0.778  | -3.19  |
|   4   | 0.011  | 0.011  | 0.009  | 0.009  | 0.005  | -0.006 |
|       | 1.901  | 1.871  | 1.507  | 1.431  | 0.799  | -1.98  |
|   5   | 0.013  | 0.009  | 0.007  | 0.006  | 0.002  | -0.011 |
|       | 2.204  | 1.678  | 1.258  | 0.988  | 0.331  | -2.984 |
|  Diff | -0.007 | -0.008 | -0.006 | -0.007 | -0.008 | -0.001 |
|       | -1.876 | -2.628 | -1.819 | -2.117 | -2.389 | -0.446 |
+-------+--------+--------+--------+--------+--------+--------+

# Risk-adjustment Using Market factor
risk_model = risk_premium['MKT']
risk_model = risk_model['2000':'2019']
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.019  | 0.017  | 0.013  | 0.013  |  0.01  | -0.009 |
|       | 3.024  | 2.693  | 2.003  |  1.89  | 1.472  | -3.551 |
| alpha | 0.017  | 0.015  | 0.011  |  0.01  | 0.008  | -0.009 |
|       |  2.53  | 2.294  | 1.723  | 1.579  | 1.064  | -3.467 |
|   2   | 0.014  | 0.015  | 0.011  | 0.011  | 0.009  | -0.005 |
|       |  2.25  | 2.415  | 1.779  | 1.658  | 1.374  | -1.947 |
| alpha | 0.012  | 0.013  | 0.009  | 0.009  | 0.007  | -0.004 |
|       | 1.888  | 1.955  | 1.356  | 1.358  | 1.031  | -2.071 |
|   3   | 0.014  |  0.01  | 0.009  | 0.009  | 0.005  | -0.009 |
|       | 2.298  | 1.648  | 1.478  |  1.36  | 0.778  | -3.19  |
| alpha | 0.012  | 0.008  | 0.007  | 0.006  | 0.003  | -0.009 |
|       | 1.824  | 1.293  | 1.145  | 1.044  | 0.444  | -3.508 |
|   4   | 0.011  | 0.011  | 0.009  | 0.009  | 0.005  | -0.006 |
|       | 1.901  | 1.871  | 1.507  | 1.431  | 0.799  | -1.98  |
| alpha |  0.01  | 0.009  | 0.007  | 0.007  | 0.004  | -0.006 |
|       | 1.476  | 1.421  | 1.124  | 1.067  | 0.599  | -2.197 |
|   5   | 0.013  | 0.009  | 0.007  | 0.006  | 0.002  | -0.011 |
|       | 2.204  | 1.678  | 1.258  | 0.988  | 0.331  | -2.984 |
| alpha | 0.011  | 0.008  | 0.005  | 0.004  |  0.0   | -0.011 |
|       | 1.726  | 1.252  | 0.873  |  0.68  | 0.042  | -3.074 |
|  Diff | -0.007 | -0.008 | -0.006 | -0.007 | -0.008 | -0.001 |
|       | -1.876 | -2.628 | -1.819 | -2.117 | -2.389 | -0.446 |
| alpha | -0.005 | -0.007 | -0.005 | -0.006 | -0.007 | -0.002 |
|       | -1.847 | -2.257 | -1.383 | -1.603 | -1.851 | -0.792 |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PE1A1  | PE1A2  | PE1A3  | PE1A4  | PE1A5  |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.018  | 0.015  | 0.013  | 0.011  |  0.01  | -0.008 |
|          |  2.94  | 2.257  | 2.027  | 1.687  | 1.445  | -3.787 |
| Msmvttl2 | 0.014  | 0.013  | 0.012  | 0.009  |  0.01  | -0.004 |
|          | 2.225  | 2.182  | 1.955  | 1.369  |  1.45  | -1.617 |
| Msmvttl3 | 0.013  |  0.01  | 0.009  | 0.009  | 0.005  | -0.008 |
|          | 2.187  | 1.668  |  1.44  | 1.413  | 0.748  | -3.215 |
| Msmvttl4 | 0.011  | 0.011  | 0.009  | 0.008  | 0.006  | -0.005 |
|          | 1.822  | 1.866  | 1.571  | 1.372  | 0.932  | -1.674 |
| Msmvttl5 | 0.013  | 0.012  | 0.008  | 0.006  | 0.004  | -0.009 |
|          | 2.261  | 2.163  | 1.545  | 1.067  | 0.732  | -2.473 |
|   Diff   | -0.005 | -0.002 | -0.005 | -0.006 | -0.006 | -0.001 |
|          | -1.349 | -0.641 | -1.334 | -1.534 | -1.665 | -0.17  |
+----------+--------+--------+--------+--------+--------+--------+
==================================================================

# Risk-adjustment 
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PE1A1  | PE1A2  | PE1A3  | PE1A4  | PE1A5  |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.018  | 0.015  | 0.013  | 0.011  |  0.01  | -0.008 |
|          |  2.94  | 2.257  | 2.027  | 1.687  | 1.445  | -3.787 |
|  alpha   | 0.016  | 0.012  | 0.011  | 0.009  | 0.008  | -0.008 |
|          | 2.529  | 1.873  | 1.769  |  1.29  | 1.061  | -3.959 |
| Msmvttl2 | 0.014  | 0.013  | 0.012  | 0.009  |  0.01  | -0.004 |
|          | 2.225  | 2.182  | 1.955  | 1.369  |  1.45  | -1.617 |
|  alpha   | 0.012  | 0.011  |  0.01  | 0.007  | 0.008  | -0.004 |
|          | 1.861  | 1.741  | 1.521  | 1.109  | 1.086  | -1.971 |
| Msmvttl3 | 0.013  |  0.01  | 0.009  | 0.009  | 0.005  | -0.008 |
|          | 2.187  | 1.668  |  1.44  | 1.413  | 0.748  | -3.215 |
|  alpha   | 0.011  | 0.008  | 0.007  | 0.007  | 0.003  | -0.008 |
|          | 1.719  | 1.352  | 1.096  | 1.056  | 0.441  | -3.324 |
| Msmvttl4 | 0.011  | 0.011  | 0.009  | 0.008  | 0.006  | -0.005 |
|          | 1.822  | 1.866  | 1.571  | 1.372  | 0.932  | -1.674 |
|  alpha   | 0.009  | 0.009  | 0.007  | 0.006  | 0.005  | -0.005 |
|          | 1.393  | 1.525  |  1.16  | 0.991  |  0.7   | -1.788 |
| Msmvttl5 | 0.013  | 0.012  | 0.008  | 0.006  | 0.004  | -0.009 |
|          | 2.261  | 2.163  | 1.545  | 1.067  | 0.732  | -2.473 |
|  alpha   | 0.012  | 0.011  | 0.007  | 0.004  | 0.003  | -0.009 |
|          |  1.83  | 1.628  | 1.169  | 0.718  | 0.406  | -2.612 |
|   Diff   | -0.005 | -0.002 | -0.005 | -0.006 | -0.006 | -0.001 |
|          | -1.349 | -0.641 | -1.334 | -1.534 | -1.665 | -0.17  |
|  alpha   | -0.004 | -0.002 | -0.004 | -0.004 | -0.005 | -0.001 |
|          | -1.315 | -0.431 | -0.939 | -1.031 | -1.407 | -0.297 |
+----------+--------+--------+--------+--------+--------+--------+
```

The first dataset contains no tail 30% stocks from 2000-01-01 to 2019-12-01 and the value factor is PE. The value effect is **significant** since the t-test statistics for differenced portfolio are -3.551, -1.947, -3.19, -1.98, -2.984, respectively, whose absolute values are generally more than 2 corresponding to the significance level at 0.05. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2 : PB
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'PBV1A', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2000-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Independent-sort Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.016  | 0.015  | 0.012  | 0.014  | 0.008  | -0.008 |
|       |  2.41  | 2.321  | 1.904  | 1.969  | 1.135  | -2.467 |
|   2   | 0.013  | 0.012  | 0.012  | 0.011  | 0.006  | -0.007 |
|       | 2.075  |  1.87  | 1.877  | 1.645  | 0.955  | -1.902 |
|   3   | 0.012  | 0.009  | 0.008  |  0.01  | 0.007  | -0.005 |
|       | 1.898  | 1.479  | 1.302  | 1.571  | 1.075  | -1.492 |
|   4   | 0.012  | 0.011  | 0.008  | 0.006  | 0.008  | -0.004 |
|       | 1.911  | 1.804  | 1.284  | 0.996  | 1.266  | -1.075 |
|   5   | 0.011  | 0.011  | 0.008  | 0.007  | 0.006  | -0.005 |
|       | 1.975  | 1.995  | 1.423  | 1.282  | 1.111  | -1.185 |
|  Diff | -0.004 | -0.004 | -0.004 | -0.006 | -0.002 | 0.003  |
|       | -1.301 | -1.127 | -1.38  | -1.726 | -0.418 | 0.785  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Risk adjustment
risk_model = risk_premium['MKT']
risk_model = risk_model['2000':'2019']
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.016  | 0.015  | 0.012  | 0.014  | 0.008  | -0.008 |
|       |  2.41  | 2.321  | 1.904  | 1.969  | 1.135  | -2.467 |
| alpha | 0.013  | 0.013  |  0.01  | 0.011  | 0.005  | -0.008 |
|       |  2.1   | 1.901  | 1.522  | 1.521  | 0.804  | -2.722 |
|   2   | 0.013  | 0.012  | 0.012  | 0.011  | 0.006  | -0.007 |
|       | 2.075  |  1.87  | 1.877  | 1.645  | 0.955  | -1.902 |
| alpha | 0.011  |  0.01  |  0.01  | 0.009  | 0.004  | -0.007 |
|       | 1.663  | 1.515  |  1.54  | 1.295  | 0.632  | -2.229 |
|   3   | 0.012  | 0.009  | 0.008  |  0.01  | 0.007  | -0.005 |
|       | 1.898  | 1.479  | 1.302  | 1.571  | 1.075  | -1.492 |
| alpha |  0.01  | 0.007  | 0.006  | 0.008  | 0.005  | -0.005 |
|       | 1.522  | 1.102  | 0.982  | 1.183  |  0.73  | -1.719 |
|   4   | 0.012  | 0.011  | 0.008  | 0.006  | 0.008  | -0.004 |
|       | 1.911  | 1.804  | 1.284  | 0.996  | 1.266  | -1.075 |
| alpha |  0.01  | 0.009  | 0.006  | 0.004  | 0.006  | -0.004 |
|       | 1.496  | 1.382  | 0.954  |  0.72  | 0.938  | -1.243 |
|   5   | 0.011  | 0.011  | 0.008  | 0.007  | 0.006  | -0.005 |
|       | 1.975  | 1.995  | 1.423  | 1.282  | 1.111  | -1.185 |
| alpha |  0.01  |  0.01  | 0.007  | 0.006  | 0.005  | -0.005 |
|       |  1.53  | 1.621  | 1.036  | 0.878  | 0.741  | -1.268 |
|  Diff | -0.004 | -0.004 | -0.004 | -0.006 | -0.002 | 0.003  |
|       | -1.301 | -1.127 | -1.38  | -1.726 | -0.418 | 0.785  |
| alpha | -0.004 | -0.002 | -0.003 | -0.005 |  -0.0  | 0.003  |
|       | -1.193 | -0.745 | -0.989 | -1.195 | -0.091 | 0.785  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PBV1A1 | PBV1A2 | PBV1A3 | PBV1A4 | PBV1A5 |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.016  | 0.015  | 0.013  | 0.014  | 0.009  | -0.007 |
|          |  2.43  |  2.21  | 1.929  | 2.014  | 1.253  | -2.267 |
| Msmvttl2 | 0.013  | 0.012  | 0.013  | 0.011  | 0.006  | -0.006 |
|          | 1.994  | 1.876  | 1.993  | 1.723  | 0.987  | -1.857 |
| Msmvttl3 | 0.011  | 0.009  | 0.008  |  0.01  | 0.007  | -0.004 |
|          | 1.838  | 1.499  | 1.289  | 1.588  | 1.116  | -1.35  |
| Msmvttl4 | 0.012  |  0.01  | 0.007  | 0.006  | 0.008  | -0.004 |
|          | 1.975  | 1.618  | 1.173  | 1.077  | 1.276  | -1.179 |
| Msmvttl5 | 0.012  |  0.01  | 0.009  | 0.005  | 0.007  | -0.005 |
|          | 2.131  |  1.83  | 1.558  | 0.946  | 1.195  | -1.206 |
|   Diff   | -0.004 | -0.004 | -0.004 | -0.008 | -0.002 | 0.002  |
|          | -1.006 | -1.135 | -1.07  | -2.332 | -0.519 | 0.432  |
+----------+--------+--------+--------+--------+--------+--------+
==================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PBV1A1 | PBV1A2 | PBV1A3 | PBV1A4 | PBV1A5 |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.016  | 0.015  | 0.013  | 0.014  | 0.009  | -0.007 |
|          |  2.43  |  2.21  | 1.929  | 2.014  | 1.253  | -2.267 |
|  alpha   | 0.013  | 0.012  |  0.01  | 0.011  | 0.006  | -0.007 |
|          | 2.097  | 1.822  | 1.514  | 1.583  | 0.883  | -2.449 |
| Msmvttl2 | 0.013  | 0.012  | 0.013  | 0.011  | 0.006  | -0.006 |
|          | 1.994  | 1.876  | 1.993  | 1.723  | 0.987  | -1.857 |
|  alpha   |  0.01  |  0.01  | 0.011  |  0.01  | 0.004  | -0.006 |
|          | 1.585  |  1.55  |  1.62  | 1.402  | 0.647  | -2.206 |
| Msmvttl3 | 0.011  | 0.009  | 0.008  |  0.01  | 0.007  | -0.004 |
|          | 1.838  | 1.499  | 1.289  | 1.588  | 1.116  | -1.35  |
|  alpha   | 0.009  | 0.007  | 0.006  | 0.008  | 0.005  | -0.004 |
|          | 1.454  | 1.167  | 0.938  | 1.212  | 0.765  | -1.554 |
| Msmvttl4 | 0.012  |  0.01  | 0.007  | 0.006  | 0.008  | -0.004 |
|          | 1.975  | 1.618  | 1.173  | 1.077  | 1.276  | -1.179 |
|  alpha   |  0.01  | 0.008  | 0.006  | 0.005  | 0.006  | -0.004 |
|          | 1.531  | 1.256  | 0.887  | 0.784  | 0.953  | -1.34  |
| Msmvttl5 | 0.012  |  0.01  | 0.009  | 0.005  | 0.007  | -0.005 |
|          | 2.131  |  1.83  | 1.558  | 0.946  | 1.195  | -1.206 |
|  alpha   | 0.011  | 0.009  | 0.008  | 0.004  | 0.005  | -0.005 |
|          | 1.652  | 1.435  | 1.212  | 0.608  | 0.805  | -1.34  |
|   Diff   | -0.004 | -0.004 | -0.004 | -0.008 | -0.002 | 0.002  |
|          | -1.006 | -1.135 | -1.07  | -2.332 | -0.519 | 0.432  |
|  alpha   | -0.003 | -0.003 | -0.002 | -0.007 | -0.001 | 0.002  |
|          | -0.818 | -0.957 | -0.724 | -1.678 | -0.162 | 0.488  |
+----------+--------+--------+--------+--------+--------+--------+
```

The second dataset contains no tail 30% stocks and the value variable is PB from 2000-01-01 to 2019-12-01. The value effect is partly **significant** since the t-test statistics for differenced portfolio are -2.467, -1.902, -1.492, -1.075, -1.185, respectively, whose absolute values are generally no more than 2 corresponding to the significance level at 0.05. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 3 : PE 
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_3 = return_company[return_company['Ndaytrd']>=10]
test_data_3 = test_data_3[['emrwd', 'Msmvttl', 'PE1A', 'Date_merge']].dropna()
test_data_3 = test_data_3[(test_data_3['Date_merge'] >= '2000-01-01') & (test_data_3['Date_merge'] <= '2019-12-01')]

# Independent-sort Bivariate analysis
bi_3 = Bivariate(np.array(test_data_3), number=4)
bi_3.average_by_time()
bi_3.summary_and_test()
bi_3.print_summary_by_time()
bi_3.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.023  | 0.023  | 0.022  | 0.022  | 0.022  | -0.001 |
|       | 3.492  | 3.471  | 3.239  | 3.107  | 3.043  | -0.664 |
|   2   | 0.019  | 0.017  | 0.014  | 0.013  | 0.011  | -0.008 |
|       |  3.04  | 2.619  | 2.163  | 1.915  | 1.635  | -3.531 |
|   3   | 0.014  | 0.013  | 0.011  |  0.01  | 0.009  | -0.005 |
|       | 2.296  | 2.181  | 1.723  |  1.57  | 1.338  | -2.334 |
|   4   | 0.013  | 0.009  | 0.009  | 0.007  | 0.005  | -0.008 |
|       | 2.159  | 1.626  | 1.519  | 1.138  |  0.69  | -3.141 |
|   5   | 0.012  | 0.009  | 0.007  | 0.006  | 0.003  | -0.009 |
|       | 2.098  | 1.648  | 1.273  | 0.992  | 0.521  | -2.597 |
|  Diff | -0.011 | -0.014 | -0.015 | -0.016 | -0.018 | -0.007 |
|       | -2.816 | -3.834 | -4.025 | -4.372 | -5.071 | -2.236 |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Risk Adjustment
risk_model = risk_premium['MKT']
risk_model = risk_model['2000':'2019']
bi_3.factor_adjustment(risk_model)
bi_3.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.023  | 0.023  | 0.022  | 0.022  | 0.022  | -0.001 |
|       | 3.492  | 3.471  | 3.239  | 3.107  | 3.043  | -0.664 |
| alpha | 0.021  |  0.02  | 0.019  | 0.019  | 0.019  | -0.002 |
|       | 2.983  | 2.997  | 2.683  | 2.628  | 2.494  | -1.041 |
|   2   | 0.019  | 0.017  | 0.014  | 0.013  | 0.011  | -0.008 |
|       |  3.04  | 2.619  | 2.163  | 1.915  | 1.635  | -3.531 |
| alpha | 0.016  | 0.014  | 0.012  | 0.011  | 0.009  | -0.008 |
|       | 2.644  | 2.218  | 1.844  | 1.564  |  1.25  | -3.46  |
|   3   | 0.014  | 0.013  | 0.011  |  0.01  | 0.009  | -0.005 |
|       | 2.296  | 2.181  | 1.723  |  1.57  | 1.338  | -2.334 |
| alpha | 0.012  | 0.011  | 0.009  | 0.008  | 0.007  | -0.005 |
|       | 1.914  | 1.779  | 1.344  | 1.262  |  0.98  | -2.709 |
|   4   | 0.013  | 0.009  | 0.009  | 0.007  | 0.005  | -0.008 |
|       | 2.159  | 1.626  | 1.519  | 1.138  |  0.69  | -3.141 |
| alpha | 0.011  | 0.008  | 0.007  | 0.005  | 0.003  | -0.008 |
|       | 1.731  |  1.28  | 1.127  | 0.862  | 0.409  | -3.648 |
|   5   | 0.012  | 0.009  | 0.007  | 0.006  | 0.003  | -0.009 |
|       | 2.098  | 1.648  | 1.273  | 0.992  | 0.521  | -2.597 |
| alpha |  0.01  | 0.007  | 0.005  | 0.004  | 0.002  | -0.009 |
|       | 1.598  | 1.193  | 0.874  | 0.647  | 0.277  | -2.897 |
|  Diff | -0.011 | -0.014 | -0.015 | -0.016 | -0.018 | -0.007 |
|       | -2.816 | -3.834 | -4.025 | -4.372 | -5.071 | -2.236 |
| alpha | -0.01  | -0.013 | -0.014 | -0.014 | -0.017 | -0.007 |
|       | -2.534 | -2.77  | -2.761 | -3.106 | -3.862 | -2.331 |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_3_de = Bivariate(test_data_3, number=4)
bi_3_de.fit(conditional=True)
bi_3_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PE1A1  | PE1A2  | PE1A3  | PE1A4  | PE1A5  |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.023  | 0.023  | 0.022  | 0.022  | 0.022  | -0.001 |
|          | 3.463  | 3.313  | 3.113  | 3.161  | 2.992  | -0.499 |
| Msmvttl2 | 0.018  | 0.016  | 0.014  | 0.013  | 0.012  | -0.006 |
|          | 2.855  | 2.461  | 2.072  |  1.85  |  1.68  | -3.032 |
| Msmvttl3 | 0.014  | 0.013  | 0.011  |  0.01  | 0.009  | -0.005 |
|          | 2.217  | 2.197  | 1.768  | 1.557  | 1.284  | -2.425 |
| Msmvttl4 | 0.012  | 0.011  | 0.009  | 0.009  | 0.004  | -0.008 |
|          | 2.049  | 1.896  |  1.45  | 1.427  | 0.633  | -3.034 |
| Msmvttl5 | 0.013  | 0.011  | 0.008  | 0.006  | 0.005  | -0.008 |
|          | 2.282  | 1.894  | 1.584  |  1.19  | 0.839  | -2.33  |
|   Diff   | -0.009 | -0.012 | -0.013 | -0.016 | -0.017 | -0.007 |
|          | -2.064 | -2.804 | -3.221 | -4.152 | -4.434 | -1.881 |
+----------+--------+--------+--------+--------+--------+--------+
==================================================================

# Risk Adjustment
bi_3_de.factor_adjustment(risk_model)
bi_3_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PE1A1  | PE1A2  | PE1A3  | PE1A4  | PE1A5  |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.023  | 0.023  | 0.022  | 0.022  | 0.022  | -0.001 |
|          | 3.463  | 3.313  | 3.113  | 3.161  | 2.992  | -0.499 |
|  alpha   |  0.02  |  0.02  | 0.019  | 0.019  | 0.019  | -0.001 |
|          |  2.95  |  2.71  | 2.691  | 2.621  | 2.434  | -0.798 |
| Msmvttl2 | 0.018  | 0.016  | 0.014  | 0.013  | 0.012  | -0.006 |
|          | 2.855  | 2.461  | 2.072  |  1.85  |  1.68  | -3.032 |
|  alpha   | 0.015  | 0.013  | 0.012  |  0.01  | 0.009  | -0.006 |
|          | 2.456  | 2.057  | 1.812  | 1.473  | 1.279  | -3.127 |
| Msmvttl3 | 0.014  | 0.013  | 0.011  |  0.01  | 0.009  | -0.005 |
|          | 2.217  | 2.197  | 1.768  | 1.557  | 1.284  | -2.425 |
|  alpha   | 0.012  | 0.012  | 0.009  | 0.008  | 0.007  | -0.005 |
|          | 1.831  | 1.775  | 1.413  | 1.236  | 0.938  | -2.902 |
| Msmvttl4 | 0.012  | 0.011  | 0.009  | 0.009  | 0.004  | -0.008 |
|          | 2.049  | 1.896  |  1.45  | 1.427  | 0.633  | -3.034 |
|  alpha   |  0.01  | 0.009  | 0.007  | 0.007  | 0.002  | -0.008 |
|          |  1.64  | 1.541  | 1.089  | 1.109  | 0.365  | -3.268 |
| Msmvttl5 | 0.013  | 0.011  | 0.008  | 0.006  | 0.005  | -0.008 |
|          | 2.282  | 1.894  | 1.584  |  1.19  | 0.839  | -2.33  |
|  alpha   | 0.012  | 0.009  | 0.007  | 0.005  | 0.003  | -0.008 |
|          | 1.774  | 1.438  | 1.165  | 0.803  | 0.501  | -2.625 |
|   Diff   | -0.009 | -0.012 | -0.013 | -0.016 | -0.017 | -0.007 |
|          | -2.064 | -2.804 | -3.221 | -4.152 | -4.434 | -1.881 |
|  alpha   | -0.008 | -0.011 | -0.012 | -0.014 | -0.015 | -0.007 |
|          | -1.82  | -1.909 | -2.355 | -2.986 | -3.436 | -1.972 |
+----------+--------+--------+--------+--------+--------+--------+
```

The third dataset contains tail 30% stocks and the value variable is PE from 2000-01-01 to 2019-12-01. The value effect is partly **significant** since the t-test statistics for differenced portfolio are -0.664, -3.531, -2.334, -3.141, -2.597, respectively, whose absolute values are generally more than 2 corresponding to the significance level at 0.05. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 4 : PB
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_4 = return_company[(return_company['Ndaytrd']>=10)]
test_data_4 = test_data_4[['emrwd', 'Msmvttl', 'PBV1A', 'Date_merge']].dropna()
test_data_4 = test_data_4[(test_data_4['Date_merge'] >= '2000-01-01') & (test_data_4['Date_merge'] <= '2019-12-01')]
# analysis
bi_4 = Bivariate(np.array(test_data_4), number=4)
bi_4.average_by_time()
bi_4.summary_and_test()
bi_4.print_summary_by_time()
bi_4.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.022  | 0.024  | 0.025  | 0.022  |  0.02  | -0.002 |
|       | 3.342  | 3.475  | 3.554  | 3.054  | 2.714  | -0.905 |
|   2   | 0.017  | 0.016  | 0.013  | 0.015  | 0.009  | -0.008 |
|       | 2.632  | 2.365  | 1.939  | 2.239  | 1.337  | -2.653 |
|   3   | 0.013  | 0.013  | 0.012  |  0.01  | 0.007  | -0.006 |
|       | 2.045  | 2.071  |  1.9   | 1.616  | 1.051  | -1.827 |
|   4   | 0.011  |  0.01  | 0.009  | 0.008  | 0.007  | -0.004 |
|       | 1.783  | 1.592  | 1.416  | 1.299  | 1.167  | -1.093 |
|   5   | 0.011  | 0.011  | 0.008  | 0.007  | 0.006  | -0.006 |
|       | 1.975  | 1.914  | 1.382  | 1.174  | 0.997  | -1.392 |
|  Diff | -0.011 | -0.013 | -0.017 | -0.015 | -0.015 | -0.004 |
|       | -2.803 | -3.498 | -4.532 | -3.934 | -3.144 | -0.891 |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Risk Adjustment
risk_model = risk_premium['MKT']
risk_model = risk_model['2000':'2019']
bi_4.factor_adjustment(risk_model)
bi_4.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.022  | 0.024  | 0.025  | 0.022  |  0.02  | -0.002 |
|       | 3.342  | 3.475  | 3.554  | 3.054  | 2.714  | -0.905 |
| alpha |  0.02  | 0.021  | 0.022  | 0.019  | 0.017  | -0.003 |
|       | 2.773  | 2.872  | 3.019  | 2.511  | 2.226  | -1.715 |
|   2   | 0.017  | 0.016  | 0.013  | 0.015  | 0.009  | -0.008 |
|       | 2.632  | 2.365  | 1.939  | 2.239  | 1.337  | -2.653 |
| alpha | 0.015  | 0.013  | 0.011  | 0.013  | 0.007  | -0.008 |
|       |  2.23  | 1.957  | 1.572  | 1.744  | 1.032  |  -2.8  |
|   3   | 0.013  | 0.013  | 0.012  |  0.01  | 0.007  | -0.006 |
|       | 2.045  | 2.071  |  1.9   | 1.616  | 1.051  | -1.827 |
| alpha | 0.011  | 0.011  |  0.01  | 0.008  | 0.005  | -0.006 |
|       |  1.65  | 1.702  | 1.531  | 1.274  | 0.729  | -2.156 |
|   4   | 0.011  |  0.01  | 0.009  | 0.008  | 0.007  | -0.004 |
|       | 1.783  | 1.592  | 1.416  | 1.299  | 1.167  | -1.093 |
| alpha | 0.009  | 0.008  | 0.007  | 0.006  | 0.005  | -0.004 |
|       | 1.409  | 1.203  | 1.036  | 0.994  | 0.806  | -1.155 |
|   5   | 0.011  | 0.011  | 0.008  | 0.007  | 0.006  | -0.006 |
|       | 1.975  | 1.914  | 1.382  | 1.174  | 0.997  | -1.392 |
| alpha |  0.01  |  0.01  | 0.006  | 0.005  | 0.004  | -0.006 |
|       | 1.507  | 1.496  | 0.991  | 0.815  | 0.632  | -1.592 |
|  Diff | -0.011 | -0.013 | -0.017 | -0.015 | -0.015 | -0.004 |
|       | -2.803 | -3.498 | -4.532 | -3.934 | -3.144 | -0.891 |
| alpha | -0.01  | -0.011 | -0.016 | -0.014 | -0.013 | -0.003 |
|       | -2.266 | -2.591 | -3.095 | -2.767 | -2.484 | -0.71  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_4_de = Bivariate(test_data_4, number=4)
bi_4_de.fit(conditional=True)
bi_4_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PBV1A1 | PBV1A2 | PBV1A3 | PBV1A4 | PBV1A5 |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.023  | 0.024  | 0.025  | 0.022  |  0.02  | -0.003 |
|          | 3.364  | 3.478  | 3.614  | 3.142  | 2.629  | -1.141 |
| Msmvttl2 | 0.017  | 0.016  | 0.013  | 0.015  |  0.01  | -0.007 |
|          | 2.585  | 2.424  | 2.012  | 2.226  | 1.476  | -2.287 |
| Msmvttl3 | 0.013  | 0.013  | 0.012  | 0.011  | 0.007  | -0.006 |
|          |  2.07  | 1.977  | 1.916  | 1.762  | 1.075  | -1.91  |
| Msmvttl4 | 0.011  | 0.009  | 0.008  | 0.008  | 0.007  | -0.004 |
|          | 1.858  | 1.481  | 1.344  | 1.359  | 1.179  | -1.239 |
| Msmvttl5 | 0.012  |  0.01  | 0.008  | 0.006  | 0.006  | -0.006 |
|          |  2.08  | 1.785  | 1.453  | 0.977  | 1.055  | -1.371 |
|   Diff   | -0.011 | -0.014 | -0.017 | -0.017 | -0.014 | -0.003 |
|          | -2.615 | -3.36  | -4.379 | -4.139 | -2.871 | -0.726 |
+----------+--------+--------+--------+--------+--------+--------+
==================================================================

# Risk Adjustment
bi_4_de.factor_adjustment(risk_model)
bi_4_de.print_summary()
==================================================================
+----------+--------+--------+--------+--------+--------+--------+
|  Group   | PBV1A1 | PBV1A2 | PBV1A3 | PBV1A4 | PBV1A5 |  Diff  |
+----------+--------+--------+--------+--------+--------+--------+
| Msmvttl1 | 0.023  | 0.024  | 0.025  | 0.022  |  0.02  | -0.003 |
|          | 3.364  | 3.478  | 3.614  | 3.142  | 2.629  | -1.141 |
|  alpha   |  0.02  | 0.021  | 0.023  |  0.02  | 0.016  | -0.004 |
|          | 2.733  | 2.943  | 3.024  | 2.582  | 2.165  | -1.794 |
| Msmvttl2 | 0.017  | 0.016  | 0.013  | 0.015  |  0.01  | -0.007 |
|          | 2.585  | 2.424  | 2.012  | 2.226  | 1.476  | -2.287 |
|  alpha   | 0.014  | 0.014  | 0.011  | 0.013  | 0.008  | -0.007 |
|          | 2.196  | 2.031  | 1.594  |  1.76  | 1.122  | -2.375 |
| Msmvttl3 | 0.013  | 0.013  | 0.012  | 0.011  | 0.007  | -0.006 |
|          |  2.07  | 1.977  | 1.916  | 1.762  | 1.075  | -1.91  |
|  alpha   | 0.011  | 0.011  |  0.01  |  0.01  | 0.005  | -0.006 |
|          | 1.677  |  1.64  | 1.517  |  1.45  | 0.736  | -2.243 |
| Msmvttl4 | 0.011  | 0.009  | 0.008  | 0.008  | 0.007  | -0.004 |
|          | 1.858  | 1.481  | 1.344  | 1.359  | 1.179  | -1.239 |
|  alpha   | 0.009  | 0.007  | 0.006  | 0.006  | 0.005  | -0.004 |
|          | 1.463  | 1.134  | 1.005  | 1.028  |  0.83  | -1.352 |
| Msmvttl5 | 0.012  |  0.01  | 0.008  | 0.006  | 0.006  | -0.006 |
|          |  2.08  | 1.785  | 1.453  | 0.977  | 1.055  | -1.371 |
|  alpha   |  0.01  | 0.009  | 0.007  | 0.004  | 0.004  | -0.006 |
|          | 1.594  | 1.395  | 1.087  | 0.647  |  0.7   | -1.633 |
|   Diff   | -0.011 | -0.014 | -0.017 | -0.017 | -0.014 | -0.003 |
|          | -2.615 | -3.36  | -4.379 | -4.139 | -2.871 | -0.726 |
|  alpha   | -0.01  | -0.012 | -0.016 | -0.015 | -0.012 | -0.002 |
|          | -2.109 | -2.55  | -3.328 | -2.861 | -2.408 | -0.629 |
+----------+--------+--------+--------+--------+--------+--------+
```

The fourth dataset contains tail 30% stocks and the value variable is PB from 2000-01-01 to 2019-12-01. The value effect is partly **significant** since the t-test statistics for differenced portfolio are -0.905, -2.653, -1.827, -1.093, -1.392, respectively, whose absolute values are generally no more than 2 corresponding to the significance level at 0.05. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**





### Profitability Factor

The relation of profitability and future return is more discussed in literature (Fama and French, 2015; Hou et al., 2015), through which the profitability factor is constituted and included in two main asset pricing model, **Fama-French 5 factor model** and **HXZ's model.** There are many proxy variables for profitability factor. These variables are highly correlated and the most common one is return on equity (ROE). Besides the ROE, ROA is supported by several literatures (Novy-Marx, 2013; Ball et al., 2015). Another substitution is return on tangible capital (ROTC), which is proposed by Greenblatt (2006, 2010). Through empirical evidence, it is suggested that profitability is positively related with future return in American stock market, while in China stock market the relation needs further discussion.

In this demo, the ROE(TTM) is used as the proxy variable for profitability factor. The dataset starts from Jan, 2004 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% import package
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
company_data = pd.read_hdf('.\data\last_filter_pe.h5', key='data')
```

The data needs some preprocessing.

```python
# %% preprocessing data
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)

# %% prepare merge data
from pandas.tseries.offsets import *

month_return['Stkcd_merge'] = month_return['Stkcd'].astype(dtype='string')
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])
month_return['Yearmonth'] = month_return['Date_merge'].map(lambda x : 1000*x.year + x.month)
#month_return['Date_merge'] += MonthEnd()

# in this demo, the ROE(TTM) are used
# ROE(TTM) = PBV1B/PE(TTM) 
company_data['ROE(TTM)'] = company_data['PBV1B']/company_data['PE1TTM']
company_data['Stkcd_merge'] = company_data['Symbol'].dropna().astype(dtype='int').astype(dtype='string')
company_data['Date_merge'] = pd.to_datetime(company_data['TradingDate'])
company_data['Yearmonth'] = company_data['Date_merge'].map(lambda x : 1000*x.year + x.month)
company_data['Date_merge'] += MonthBegin()

# %% dataset starts from '2000-01'
company_data = company_data[company_data['Date_merge'] >= '2000-01']
month_return = month_return[month_return['Date_merge'] >= '2000-01']
return_company = pd.merge(company_data, month_return, on=['Stkcd_merge', 'Date_merge'])

```

Two datasets are constituted. One includes tail 30% stock, while one includes not. Univariate analysis and Bivariate analysis are attached.

```python
# %% construct test_data for bivariate analysis
# dataset 1 : no tail stocks & ROE Bivariate
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'ROE(TTM)', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2004-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'ROE(TTM)', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.012 | 0.011 | 0.013 | 0.013 | 0.013 | 0.015 | 0.016 | 0.015 | 0.017 | 0.017 | 0.005 |
|  T-Test | 1.465 | 1.372 | 1.648 | 1.826 | 1.884 | 2.048 | 2.354 |  2.3  | 2.548 | 2.494 | 1.473 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
====================================================================================================

# Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+-------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff |
+-------+--------+--------+--------+--------+--------+-------+
|   1   | 0.014  | 0.017  | 0.021  | 0.023  |  0.02  | 0.006 |
|       | 1.683  | 2.197  | 2.712  | 3.026  | 2.519  | 2.308 |
|   2   | 0.014  | 0.015  | 0.017  | 0.018  | 0.019  | 0.005 |
|       | 1.702  | 1.895  | 2.228  | 2.604  | 2.567  | 1.699 |
|   3   | 0.008  | 0.011  | 0.012  | 0.016  | 0.018  |  0.01 |
|       | 1.091  | 1.373  | 1.712  | 2.246  | 2.624  | 3.775 |
|   4   | 0.008  | 0.011  |  0.01  | 0.014  | 0.016  | 0.008 |
|       | 1.002  | 1.442  | 1.468  | 2.109  | 2.305  |  2.41 |
|   5   | 0.004  | 0.009  | 0.008  |  0.01  | 0.016  | 0.012 |
|       | 0.565  | 1.271  | 1.257  | 1.613  | 2.417  | 3.234 |
|  Diff | -0.009 | -0.008 | -0.012 | -0.013 | -0.004 | 0.005 |
|       | -2.446 | -2.151 | -3.025 | -3.231 | -0.917 | 1.502 |
+-------+--------+--------+--------+--------+--------+-------+
===============================================================

# Risk adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2004':'2019']
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
==============================================================
+-------+--------+--------+--------+--------+--------+-------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff |
+-------+--------+--------+--------+--------+--------+-------+
|   1   | 0.014  | 0.017  | 0.021  | 0.023  |  0.02  | 0.006 |
|       | 1.683  | 2.197  | 2.712  | 3.026  | 2.519  | 2.308 |
| alpha | 0.013  | 0.016  | 0.019  | 0.022  |  0.02  | 0.007 |
|       | 1.546  | 2.033  | 2.438  | 2.492  | 2.237  | 2.902 |
|   2   | 0.014  | 0.015  | 0.017  | 0.018  | 0.019  | 0.005 |
|       | 1.702  | 1.895  | 2.228  | 2.604  | 2.567  | 1.699 |
| alpha | 0.013  | 0.014  | 0.017  | 0.018  | 0.018  | 0.004 |
|       | 1.517  | 1.709  | 2.014  | 2.326  |  2.36  | 1.449 |
|   3   | 0.008  | 0.011  | 0.012  | 0.016  | 0.018  |  0.01 |
|       | 1.091  | 1.373  | 1.712  | 2.246  | 2.624  | 3.775 |
| alpha | 0.008  |  0.01  | 0.012  | 0.015  | 0.017  | 0.009 |
|       | 0.958  |  1.19  | 1.461  | 1.997  | 2.162  | 3.132 |
|   4   | 0.008  | 0.011  |  0.01  | 0.014  | 0.016  | 0.008 |
|       | 1.002  | 1.442  | 1.468  | 2.109  | 2.305  |  2.41 |
| alpha | 0.009  |  0.01  | 0.009  | 0.015  | 0.015  | 0.006 |
|       | 0.913  | 1.339  | 1.162  | 1.937  | 1.833  | 2.256 |
|   5   | 0.004  | 0.009  | 0.008  |  0.01  | 0.016  | 0.012 |
|       | 0.565  | 1.271  | 1.257  | 1.613  | 2.417  | 3.234 |
| alpha | 0.004  | 0.008  | 0.009  | 0.009  | 0.015  | 0.011 |
|       | 0.444  | 0.909  | 1.106  | 1.215  | 1.803  | 2.872 |
|  Diff | -0.009 | -0.008 | -0.012 | -0.013 | -0.004 | 0.005 |
|       | -2.446 | -2.151 | -3.025 | -3.231 | -0.917 | 1.502 |
| alpha | -0.008 | -0.008 | -0.01  | -0.012 | -0.005 | 0.004 |
|       | -1.86  | -2.15  | -2.315 | -2.652 | -0.856 |  0.91 |
+-------+--------+--------+--------+--------+--------+-------+
==============================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+-------+
|  Group   | ROE(TTM)1 | ROE(TTM)2 | ROE(TTM)3 | ROE(TTM)4 | ROE(TTM)5 |  Diff |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
| Msmvttl1 |   0.013   |   0.016   |   0.017   |   0.022   |   0.021   | 0.008 |
|          |    1.64   |    1.96   |   2.155   |   2.927   |   2.753   | 3.698 |
| Msmvttl2 |   0.015   |   0.013   |   0.016   |   0.018   |   0.018   | 0.004 |
|          |   1.766   |   1.699   |   2.074   |   2.483   |    2.57   | 1.215 |
| Msmvttl3 |   0.009   |   0.009   |   0.013   |   0.015   |   0.018   | 0.009 |
|          |   1.123   |   1.188   |   1.827   |    2.13   |   2.591   | 3.573 |
| Msmvttl4 |   0.009   |    0.01   |   0.012   |   0.014   |   0.016   | 0.007 |
|          |   1.181   |    1.41   |   1.645   |   2.174   |   2.327   |  2.27 |
| Msmvttl5 |   0.007   |   0.008   |   0.011   |   0.015   |   0.016   |  0.01 |
|          |   0.945   |   1.245   |   1.728   |   2.323   |   2.456   | 2.956 |
|   Diff   |   -0.007  |   -0.008  |   -0.006  |   -0.007  |   -0.005  | 0.002 |
|          |   -1.82   |   -1.737  |   -1.313  |   -1.625  |   -1.073  | 0.578 |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
================================================================================

# Risk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+-------+
|  Group   | ROE(TTM)1 | ROE(TTM)2 | ROE(TTM)3 | ROE(TTM)4 | ROE(TTM)5 |  Diff |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
| Msmvttl1 |   0.013   |   0.016   |   0.017   |   0.022   |   0.021   | 0.008 |
|          |    1.64   |    1.96   |   2.155   |   2.927   |   2.753   | 3.698 |
|  alpha   |   0.012   |   0.015   |   0.016   |   0.021   |    0.02   | 0.008 |
|          |   1.496   |   1.808   |   2.008   |   2.632   |    2.33   | 3.948 |
| Msmvttl2 |   0.015   |   0.013   |   0.016   |   0.018   |   0.018   | 0.004 |
|          |   1.766   |   1.699   |   2.074   |   2.483   |    2.57   | 1.215 |
|  alpha   |   0.014   |   0.013   |   0.015   |   0.018   |   0.018   | 0.004 |
|          |   1.539   |   1.618   |   1.816   |   2.228   |   2.324   | 1.164 |
| Msmvttl3 |   0.009   |   0.009   |   0.013   |   0.015   |   0.018   | 0.009 |
|          |   1.123   |   1.188   |   1.827   |    2.13   |   2.591   | 3.573 |
|  alpha   |   0.008   |   0.008   |   0.013   |   0.014   |   0.017   | 0.008 |
|          |   0.995   |   1.031   |   1.537   |   1.904   |    2.15   | 3.126 |
| Msmvttl4 |   0.009   |    0.01   |   0.012   |   0.014   |   0.016   | 0.007 |
|          |   1.181   |    1.41   |   1.645   |   2.174   |   2.327   |  2.27 |
|  alpha   |   0.009   |   0.009   |   0.011   |   0.015   |   0.015   | 0.006 |
|          |   1.079   |   1.154   |   1.389   |   1.954   |   1.851   |  2.01 |
| Msmvttl5 |   0.007   |   0.008   |   0.011   |   0.015   |   0.016   |  0.01 |
|          |   0.945   |   1.245   |   1.728   |   2.323   |   2.456   | 2.956 |
|  alpha   |   0.006   |   0.009   |    0.01   |   0.015   |   0.016   |  0.01 |
|          |   0.723   |   1.063   |   1.249   |   1.677   |    1.9    | 2.797 |
|   Diff   |   -0.007  |   -0.008  |   -0.006  |   -0.007  |   -0.005  | 0.002 |
|          |   -1.82   |   -1.737  |   -1.313  |   -1.625  |   -1.073  | 0.578 |
|  alpha   |   -0.006  |   -0.006  |   -0.006  |   -0.006  |   -0.004  | 0.002 |
|          |   -1.624  |   -1.401  |   -1.333  |   -1.174  |   -0.782  | 0.528 |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
```

The result from dataset #1 is interesting that in univariate analysis the differenced return is not significant since the t-value is below 2.3, while in bivariate analysis the differenced return in most part is significant since the t-value is greater than 2.3, suggesting that profitability factor provides excess return. The factor adjustment tends to **weaken the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2 : tail stocks & ROE Bivariate  
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[return_company['Ndaytrd']>=10]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'ROE(TTM)', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2004-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'ROE(TTM)', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.017 | 0.016 | 0.016 | 0.017 | 0.017 | 0.016 | 0.017 | 0.017 | 0.017 | 0.017 |  0.0  |
|  T-Test | 2.132 | 2.032 | 2.037 |  2.2  | 2.298 | 2.293 | 2.392 | 2.549 | 2.586 | 2.572 | 0.019 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
====================================================================================================

# Independent-sort Bivariate Analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
================================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.025  | 0.026  | 0.026  | 0.028  | 0.024  | -0.001 |
|       | 3.043  | 3.195  | 3.306  | 3.489  | 2.874  | -0.434 |
|   2   | 0.015  | 0.018  | 0.019  | 0.023  | 0.021  | 0.006  |
|       | 1.833  | 2.238  | 2.488  | 3.105  | 2.701  | 2.495  |
|   3   | 0.013  | 0.011  | 0.016  | 0.017  | 0.019  | 0.006  |
|       | 1.626  | 1.466  | 2.135  |  2.38  |  2.65  | 2.073  |
|   4   | 0.009  | 0.011  | 0.012  | 0.015  | 0.016  | 0.008  |
|       | 1.086  | 1.359  | 1.656  | 2.101  | 2.394  | 2.546  |
|   5   | 0.006  | 0.008  | 0.009  |  0.01  | 0.015  |  0.01  |
|       | 0.748  | 1.091  | 1.321  | 1.638  | 2.377  | 2.831  |
|  Diff | -0.019 | -0.018 | -0.017 | -0.018 | -0.009 | 0.011  |
|       | -4.676 | -4.202 | -3.963 | -3.927 | -1.68  | 2.951  |
+-------+--------+--------+--------+--------+--------+--------+
================================================================

# Risk adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2004':'2019']
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.025  | 0.026  | 0.026  | 0.028  | 0.024  | -0.001 |
|       | 3.043  | 3.195  | 3.306  | 3.489  | 2.874  | -0.434 |
| alpha | 0.023  | 0.024  | 0.025  | 0.026  | 0.022  | -0.002 |
|       | 2.593  | 2.772  |  2.93  | 2.984  | 2.345  | -0.956 |
|   2   | 0.015  | 0.018  | 0.019  | 0.023  | 0.021  | 0.006  |
|       | 1.833  | 2.238  | 2.488  | 3.105  | 2.701  | 2.495  |
| alpha | 0.014  | 0.017  | 0.018  | 0.022  |  0.02  | 0.006  |
|       | 1.678  |  2.1   | 2.214  | 2.738  | 2.328  | 3.018  |
|   3   | 0.013  | 0.011  | 0.016  | 0.017  | 0.019  | 0.006  |
|       | 1.626  | 1.466  | 2.135  |  2.38  |  2.65  | 2.073  |
| alpha | 0.012  | 0.011  | 0.016  | 0.017  | 0.018  | 0.005  |
|       | 1.409  | 1.372  | 1.886  | 2.153  | 2.315  | 1.971  |
|   4   | 0.009  | 0.011  | 0.012  | 0.015  | 0.016  | 0.008  |
|       | 1.086  | 1.359  | 1.656  | 2.101  | 2.394  | 2.546  |
| alpha | 0.008  |  0.01  | 0.011  | 0.014  | 0.016  | 0.007  |
|       |  0.96  | 1.256  |  1.36  | 1.874  | 2.001  | 2.724  |
|   5   | 0.006  | 0.008  | 0.009  |  0.01  | 0.015  |  0.01  |
|       | 0.748  | 1.091  | 1.321  | 1.638  | 2.377  | 2.831  |
| alpha | 0.006  | 0.008  | 0.009  | 0.011  | 0.015  | 0.009  |
|       | 0.664  | 0.894  | 1.037  | 1.338  | 1.788  | 2.208  |
|  Diff | -0.019 | -0.018 | -0.017 | -0.018 | -0.009 | 0.011  |
|       | -4.676 | -4.202 | -3.963 | -3.927 | -1.68  | 2.951  |
| alpha | -0.017 | -0.016 | -0.016 | -0.016 | -0.007 | 0.011  |
|       | -3.328 | -2.902 | -2.865 | -3.026 | -1.07  | 3.015  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+-------+
|  Group   | ROE(TTM)1 | ROE(TTM)2 | ROE(TTM)3 | ROE(TTM)4 | ROE(TTM)5 |  Diff |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
| Msmvttl1 |   0.025   |   0.025   |   0.026   |   0.026   |   0.027   | 0.002 |
|          |   2.985   |   3.104   |   3.202   |   3.343   |   3.293   | 0.789 |
| Msmvttl2 |   0.015   |   0.017   |   0.019   |   0.022   |   0.021   | 0.006 |
|          |   1.848   |   2.086   |   2.381   |   2.846   |   2.805   |  3.2  |
| Msmvttl3 |   0.013   |   0.011   |   0.015   |   0.017   |   0.019   | 0.006 |
|          |    1.61   |    1.48   |   1.981   |   2.366   |   2.628   |  2.01 |
| Msmvttl4 |   0.009   |   0.011   |   0.013   |   0.016   |   0.016   | 0.007 |
|          |   1.158   |   1.433   |   1.824   |   2.249   |    2.4    | 2.495 |
| Msmvttl5 |   0.007   |   0.009   |   0.011   |   0.014   |   0.017   |  0.01 |
|          |   1.014   |   1.267   |   1.783   |    2.22   |   2.512   | 3.116 |
|   Diff   |   -0.018  |   -0.017  |   -0.014  |   -0.012  |   -0.01   | 0.008 |
|          |   -4.476  |   -3.908  |   -3.107  |   -2.627  |   -1.928  | 2.589 |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+-------+
|  Group   | ROE(TTM)1 | ROE(TTM)2 | ROE(TTM)3 | ROE(TTM)4 | ROE(TTM)5 |  Diff |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
| Msmvttl1 |   0.025   |   0.025   |   0.026   |   0.026   |   0.027   | 0.002 |
|          |   2.985   |   3.104   |   3.202   |   3.343   |   3.293   | 0.789 |
|  alpha   |   0.023   |   0.024   |   0.024   |   0.025   |   0.025   | 0.002 |
|          |   2.543   |   2.662   |   2.829   |   2.943   |   2.768   | 0.991 |
| Msmvttl2 |   0.015   |   0.017   |   0.019   |   0.022   |   0.021   | 0.006 |
|          |   1.848   |   2.086   |   2.381   |   2.846   |   2.805   |  3.2  |
|  alpha   |   0.014   |   0.016   |   0.018   |    0.02   |    0.02   | 0.006 |
|          |   1.697   |    1.94   |   2.157   |   2.556   |   2.448   | 3.445 |
| Msmvttl3 |   0.013   |   0.011   |   0.015   |   0.017   |   0.019   | 0.006 |
|          |    1.61   |    1.48   |   1.981   |   2.366   |   2.628   |  2.01 |
|  alpha   |   0.012   |   0.011   |   0.015   |   0.017   |   0.018   | 0.005 |
|          |   1.386   |    1.41   |    1.74   |   2.145   |   2.316   | 2.062 |
| Msmvttl4 |   0.009   |   0.011   |   0.013   |   0.016   |   0.016   | 0.007 |
|          |   1.158   |   1.433   |   1.824   |   2.249   |    2.4    | 2.495 |
|  alpha   |   0.009   |    0.01   |   0.013   |   0.015   |   0.016   | 0.006 |
|          |    1.06   |   1.204   |   1.553   |   2.017   |   1.969   | 2.489 |
| Msmvttl5 |   0.007   |   0.009   |   0.011   |   0.014   |   0.017   |  0.01 |
|          |   1.014   |   1.267   |   1.783   |    2.22   |   2.512   | 3.116 |
|  alpha   |   0.007   |   0.008   |   0.011   |   0.014   |   0.016   | 0.009 |
|          |   0.847   |    1.03   |   1.345   |   1.644   |   1.942   | 2.518 |
|   Diff   |   -0.018  |   -0.017  |   -0.014  |   -0.012  |   -0.01   | 0.008 |
|          |   -4.476  |   -3.908  |   -3.107  |   -2.627  |   -1.928  | 2.589 |
|  alpha   |   -0.015  |   -0.016  |   -0.013  |   -0.011  |   -0.009  | 0.007 |
|          |   -3.209  |   -3.128  |   -2.502  |   -1.789  |   -1.311  | 2.075 |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
```

The result from dataset #2 is interesting that in univariate analysis the differenced return is not significant since the t-value is below 2.3, while in bivariate analysis the differenced return in most part is significant since the t-value is greater than 2.3, suggesting that profitability factor provides excess return. The factor adjustment tends to **weaken the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**





### Investment Factor

The investment factor gradually becomes popular since the introduction by Fama and French (2015). It is also included in the HXZ's model (2015) and Zhang (2017) expands it to ICAPM. Before its popularity, Titman et al. (2014) is among the early research of the factor, who use abnormal capital investment as proxy variable. However, in subsequent literature, most research uses asset growth rate as proxy variable, including Fama and French (2015) and Hou et al. (2015). In market of developed countries, investment factor is negatively correlated with future return, while in most developing country, the relation is much more tender. In China market, there exists no significant investment effect by most literatures (Guo et al., 2017; Qiao, 2019; Liu et al., 2019).

In this demo, annual asset growth rate is used as the proxy variable for profitability factor, which is calculated from the financial data and derivative ratios. The dataset starts from Jan, 2004 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% import package
from numpy import dtype
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
company_data = pd.read_hdf('.\data\last_filter_pe.h5', key='data')
```

The data needs some preprocessing.

```python
# %% preprocessing data
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
```

Annual asset growth rate is used as the proxy variable for profitability factor, which is calculated from the financial data and derivative ratios. 

```python
# %% calculate the total asset
# asset = debt + equity
# debt = company_value - market_value
# equity = market_value / PB
company_data['debt'] = company_data['EV1'] - company_data['MarketValue']
company_data['equity'] = company_data['MarketValue']/company_data['PBV1A']
company_data['asset'] = company_data['debt'] + company_data['equity']

# asset growth rate
company_data['asset_growth_rate'] = company_data['asset'].groupby(['Symbol']).diff(12)/company_data['asset']
```

Continue data preprocessing.

```python
# %% prepare merge data
from pandas.tseries.offsets import *

month_return['Stkcd_merge'] = month_return['Stkcd'].astype(dtype='string')
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])
#month_return['Yearmonth'] = month_return['Date_merge'].map(lambda x : 1000*x.year + x.month)
#month_return['Date_merge'] += MonthEnd()

company_data['Stkcd_merge'] = company_data['Symbol'].dropna().astype(dtype='int').astype(dtype='string')
company_data['Date_merge'] = pd.to_datetime(company_data['TradingDate'])
#company_data['Yearmonth'] = company_data['Date_merge'].map(lambda x : 1000*x.year + x.month)
company_data['Date_merge'] += MonthBegin()

# %% dataset starts from '2000-01'
company_data = company_data[company_data['Date_merge'] >= '2000-01']
month_return = month_return[month_return['Date_merge'] >= '2000-01']
return_company = pd.merge(company_data, month_return, on=['Stkcd_merge', 'Date_merge'])
```

Two datasets are constituted. One includes tail 30% stock, while one includes not. Univariate analysis and Bivariate analysis are attached.

```python
# %% construct test_data for bivariate analysis
# dataset 1 : no tail stocks & ROE Bivariate
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'asset_growth_rate', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2004-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'asset_growth_rate', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.011 | 0.012 | 0.013 | 0.013 | 0.015 | 0.014 | 0.013 | 0.015 | 0.015 | 0.016 | 0.005 |
|  T-Test | 1.393 | 1.655 | 1.783 | 1.879 | 2.054 | 1.985 | 1.955 | 2.162 | 2.064 | 2.152 | 1.907 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
====================================================================================================

# Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
==============================================================
+-------+--------+--------+--------+--------+--------+-------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff |
+-------+--------+--------+--------+--------+--------+-------+
|   1   | 0.015  | 0.017  | 0.018  | 0.018  |  0.02  | 0.005 |
|       | 1.848  | 2.119  | 2.336  | 2.404  | 2.482  | 1.985 |
|   2   | 0.012  | 0.014  | 0.017  | 0.015  | 0.019  | 0.007 |
|       | 1.509  | 1.784  | 2.301  | 1.984  | 2.434  |  2.8  |
|   3   |  0.01  | 0.012  | 0.015  | 0.014  | 0.014  | 0.004 |
|       | 1.314  | 1.695  | 2.026  | 1.884  | 1.912  | 1.862 |
|   4   | 0.009  |  0.01  | 0.011  | 0.013  | 0.015  | 0.006 |
|       | 1.194  | 1.507  | 1.579  | 1.831  | 2.009  |  2.45 |
|   5   | 0.007  |  0.01  | 0.011  | 0.014  | 0.012  | 0.005 |
|       |  1.03  | 1.517  | 1.685  | 2.106  | 1.749  |  1.7  |
|  Diff | -0.008 | -0.007 | -0.008 | -0.005 | -0.007 |  0.0  |
|       | -1.902 | -1.646 | -1.897 | -1.213 | -1.771 | 0.088 |
+-------+--------+--------+--------+--------+--------+-------+
==============================================================

# Factor adjustment
# Fama French 3 factors model adjust 
# risk factor model
risk_model = risk_factor['2004':'2019'][['MKT', 'SMB','HML']]
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
=============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
|  Group   | asset_growth_rate1 | asset_growth_rate2 | asset_growth_rate3 | asset_growth_rate4 | asset_growth_rate5 |  Diff |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
| Msmvttl1 |       0.015        |       0.017        |       0.018        |       0.018        |        0.02        | 0.005 |
|          |       1.848        |       2.119        |       2.336        |       2.404        |       2.482        | 1.985 |
|  alpha   |       0.014        |       0.016        |       0.017        |       0.017        |       0.019        | 0.005 |
|          |       1.655        |       1.951        |       2.203        |       2.159        |       2.157        | 1.959 |
| Msmvttl2 |       0.012        |       0.014        |       0.017        |       0.015        |       0.019        | 0.007 |
|          |       1.509        |       1.784        |       2.301        |       1.984        |       2.434        |  2.8  |
|  alpha   |       0.011        |       0.014        |       0.017        |       0.015        |       0.017        | 0.006 |
|          |       1.309        |       1.671        |       2.117        |       1.902        |       1.996        | 3.213 |
| Msmvttl3 |        0.01        |       0.012        |       0.015        |       0.014        |       0.014        | 0.004 |
|          |       1.314        |       1.695        |       2.026        |       1.884        |       1.912        | 1.862 |
|  alpha   |       0.009        |       0.011        |       0.015        |       0.013        |       0.013        | 0.004 |
|          |       1.134        |       1.451        |       1.814        |       1.713        |        1.54        | 1.349 |
| Msmvttl4 |       0.009        |        0.01        |       0.011        |       0.013        |       0.015        | 0.006 |
|          |       1.194        |       1.507        |       1.579        |       1.831        |       2.009        |  2.45 |
|  alpha   |       0.009        |        0.01        |        0.01        |       0.012        |       0.014        | 0.005 |
|          |       1.097        |        1.37        |       1.327        |       1.512        |       1.674        | 3.089 |
| Msmvttl5 |       0.007        |        0.01        |       0.011        |       0.014        |       0.012        | 0.005 |
|          |        1.03        |       1.517        |       1.685        |       2.106        |       1.749        |  1.7  |
|  alpha   |       0.007        |       0.009        |        0.01        |       0.013        |       0.012        | 0.005 |
|          |       0.871        |       1.241        |       1.281        |       1.599        |       1.382        | 1.714 |
|   Diff   |       -0.008       |       -0.007       |       -0.008       |       -0.005       |       -0.007       |  0.0  |
|          |       -1.902       |       -1.646       |       -1.897       |       -1.213       |       -1.771       | 0.088 |
|  alpha   |       -0.007       |       -0.006       |       -0.007       |       -0.004       |       -0.007       |  0.0  |
|          |       -1.97        |       -1.449       |       -1.592       |       -0.834       |       -1.414       |  0.12 |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
=============================================================================================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
==============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | asset_growth_rate1 | asset_growth_rate2 | asset_growth_rate3 | asset_growth_rate4 | asset_growth_rate5 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.014        |       0.017        |       0.017        |       0.019        |       0.018        | 0.005  |
|          |       1.727        |       2.106        |        2.18        |       2.503        |       2.352        | 2.072  |
| Msmvttl2 |       0.012        |       0.014        |       0.016        |       0.015        |       0.019        | 0.007  |
|          |       1.505        |       1.765        |       2.081        |       1.946        |       2.464        | 2.831  |
| Msmvttl3 |        0.01        |       0.012        |       0.014        |       0.014        |       0.014        | 0.004  |
|          |       1.371        |       1.637        |       1.974        |        1.92        |       1.918        |  1.7   |
| Msmvttl4 |       0.009        |       0.011        |       0.011        |       0.013        |       0.015        | 0.007  |
|          |       1.249        |       1.533        |       1.602        |       1.821        |       2.054        |  2.6   |
| Msmvttl5 |       0.009        |        0.01        |       0.011        |       0.014        |       0.013        | 0.004  |
|          |        1.29        |       1.625        |       1.715        |       2.176        |       1.794        | 1.425  |
|   Diff   |       -0.005       |       -0.007       |       -0.006       |       -0.005       |       -0.006       | -0.001 |
|          |       -1.355       |       -1.527       |       -1.47        |       -1.196       |       -1.365       | -0.219 |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
==============================================================================================================================

# RIsk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
==============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | asset_growth_rate1 | asset_growth_rate2 | asset_growth_rate3 | asset_growth_rate4 | asset_growth_rate5 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.014        |       0.017        |       0.017        |       0.019        |       0.018        | 0.005  |
|          |       1.727        |       2.106        |        2.18        |       2.503        |       2.352        | 2.072  |
|  alpha   |       0.013        |       0.016        |       0.017        |       0.018        |       0.017        | 0.004  |
|          |       1.516        |       1.901        |       2.062        |       2.319        |       2.037        | 1.876  |
| Msmvttl2 |       0.012        |       0.014        |       0.016        |       0.015        |       0.019        | 0.007  |
|          |       1.505        |       1.765        |       2.081        |       1.946        |       2.464        | 2.831  |
|  alpha   |       0.012        |       0.013        |       0.016        |       0.015        |       0.018        | 0.006  |
|          |       1.306        |       1.596        |       1.969        |       1.871        |        2.09        | 2.959  |
| Msmvttl3 |        0.01        |       0.012        |       0.014        |       0.014        |       0.014        | 0.004  |
|          |       1.371        |       1.637        |       1.974        |        1.92        |       1.918        |  1.7   |
|  alpha   |        0.01        |       0.011        |       0.014        |       0.013        |       0.013        | 0.004  |
|          |       1.186        |       1.368        |        1.81        |        1.69        |       1.573        | 1.293  |
| Msmvttl4 |       0.009        |       0.011        |       0.011        |       0.013        |       0.015        | 0.007  |
|          |       1.249        |       1.533        |       1.602        |       1.821        |       2.054        |  2.6   |
|  alpha   |       0.009        |        0.01        |        0.01        |       0.013        |       0.015        | 0.006  |
|          |       1.124        |       1.392        |       1.274        |       1.544        |       1.721        | 3.201  |
| Msmvttl5 |       0.009        |        0.01        |       0.011        |       0.014        |       0.013        | 0.004  |
|          |        1.29        |       1.625        |       1.715        |       2.176        |       1.794        | 1.425  |
|  alpha   |       0.008        |        0.01        |        0.01        |       0.014        |       0.013        | 0.005  |
|          |       1.051        |       1.276        |       1.211        |        1.73        |       1.445        |  1.67  |
|   Diff   |       -0.005       |       -0.007       |       -0.006       |       -0.005       |       -0.006       | -0.001 |
|          |       -1.355       |       -1.527       |       -1.47        |       -1.196       |       -1.365       | -0.219 |
|  alpha   |       -0.005       |       -0.006       |       -0.007       |       -0.004       |       -0.005       |  0.0   |
|          |       -1.266       |       -1.484       |       -1.251       |       -0.802       |       -0.968       | 0.058  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
```

The result from dataset #1 is consistent with literatures that in univariate analysis the differenced return is not significant since the t-value is below 2.3, while in bivariate analysis the differenced return in most part is insignificant since the t-value is less than 2.3, suggesting that investment factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2 : tail stocks & ROE Bivariate  
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[return_company['Ndaytrd']>=10]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'asset_growth_rate', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2004-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'asset_growth_rate', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.017 | 0.017 | 0.017 | 0.017 | 0.017 | 0.017 | 0.016 | 0.017 | 0.017 | 0.018 | 0.001 |
|  T-Test | 2.052 | 2.204 | 2.301 | 2.303 | 2.323 |  2.33 | 2.249 | 2.392 | 2.283 | 2.411 | 0.313 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
====================================================================================================

# Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+-------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff |
+-------+--------+--------+--------+--------+--------+-------+
|   1   | 0.027  | 0.026  | 0.027  | 0.027  | 0.027  |  0.0  |
|       | 3.113  |  3.25  | 3.257  | 3.312  | 3.372  | 0.079 |
|   2   | 0.015  | 0.019  |  0.02  | 0.021  | 0.021  | 0.006 |
|       | 1.885  | 2.331  | 2.482  | 2.706  | 2.674  | 2.551 |
|   3   | 0.012  | 0.014  | 0.017  | 0.015  | 0.017  | 0.005 |
|       | 1.561  | 1.788  | 2.198  | 2.067  | 2.286  | 2.264 |
|   4   | 0.009  |  0.01  | 0.013  | 0.013  | 0.015  | 0.005 |
|       | 1.271  | 1.475  | 1.745  | 1.888  | 1.999  | 2.397 |
|   5   | 0.007  | 0.011  |  0.01  | 0.012  | 0.013  | 0.006 |
|       | 0.987  | 1.729  | 1.582  | 1.882  |  1.83  |  2.2  |
|  Diff | -0.02  | -0.015 | -0.017 | -0.014 | -0.014 | 0.006 |
|       | -4.431 | -3.522 | -3.695 | -3.205 | -3.197 | 1.813 |
+-------+--------+--------+--------+--------+--------+-------+
===============================================================

# Factor adjustment
# Fama French 3 factors model adjust 
# risk factor model
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.027  | 0.026  | 0.027  | 0.027  | 0.027  |  0.0   |
|       | 3.113  |  3.25  | 3.257  | 3.312  | 3.372  | 0.079  |
| alpha | 0.025  | 0.024  | 0.025  | 0.026  | 0.025  |  -0.0  |
|       | 2.716  | 2.713  | 2.785  | 2.901  | 2.894  | -0.047 |
|   2   | 0.015  | 0.019  |  0.02  | 0.021  | 0.021  | 0.006  |
|       | 1.885  | 2.331  | 2.482  | 2.706  | 2.674  | 2.551  |
| alpha | 0.014  | 0.018  | 0.019  |  0.02  |  0.02  | 0.006  |
|       | 1.649  | 2.113  | 2.268  | 2.462  | 2.335  |  3.0   |
|   3   | 0.012  | 0.014  | 0.017  | 0.015  | 0.017  | 0.005  |
|       | 1.561  | 1.788  | 2.198  | 2.067  | 2.286  | 2.264  |
| alpha | 0.012  | 0.013  | 0.017  | 0.015  | 0.016  | 0.004  |
|       | 1.365  | 1.577  | 2.051  |  1.98  | 1.968  | 1.962  |
|   4   | 0.009  |  0.01  | 0.013  | 0.013  | 0.015  | 0.005  |
|       | 1.271  | 1.475  | 1.745  | 1.888  | 1.999  | 2.397  |
| alpha | 0.009  |  0.01  | 0.012  | 0.013  | 0.014  | 0.005  |
|       | 1.138  | 1.281  | 1.572  |  1.66  | 1.612  | 2.137  |
|   5   | 0.007  | 0.011  |  0.01  | 0.012  | 0.013  | 0.006  |
|       | 0.987  | 1.729  | 1.582  | 1.882  |  1.83  |  2.2   |
| alpha | 0.007  | 0.011  |  0.01  | 0.012  | 0.012  | 0.005  |
|       | 0.879  | 1.445  | 1.227  | 1.478  | 1.453  | 2.232  |
|  Diff | -0.02  | -0.015 | -0.017 | -0.014 | -0.014 | 0.006  |
|       | -4.431 | -3.522 | -3.695 | -3.205 | -3.197 | 1.813  |
| alpha | -0.018 | -0.013 | -0.015 | -0.014 | -0.013 | 0.005  |
|       | -3.702 | -2.572 | -2.825 | -2.332 | -2.022 |  1.56  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
=============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
|  Group   | asset_growth_rate1 | asset_growth_rate2 | asset_growth_rate3 | asset_growth_rate4 | asset_growth_rate5 |  Diff |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
| Msmvttl1 |       0.027        |       0.027        |       0.027        |       0.026        |       0.027        | 0.001 |
|          |       3.004        |       3.188        |       3.354        |       3.199        |       3.411        | 0.223 |
| Msmvttl2 |       0.015        |       0.018        |       0.019        |       0.021        |        0.02        | 0.005 |
|          |        1.89        |       2.234        |       2.348        |       2.754        |       2.579        | 2.327 |
| Msmvttl3 |       0.012        |       0.014        |       0.017        |       0.015        |       0.018        | 0.005 |
|          |       1.591        |       1.815        |        2.19        |       1.966        |       2.326        | 2.319 |
| Msmvttl4 |       0.009        |       0.011        |       0.013        |       0.014        |       0.015        | 0.005 |
|          |       1.279        |       1.562        |       1.808        |       1.948        |       1.965        | 2.383 |
| Msmvttl5 |       0.009        |        0.01        |       0.011        |       0.014        |       0.013        | 0.004 |
|          |       1.398        |       1.569        |       1.678        |       2.028        |       1.817        | 1.353 |
|   Diff   |       -0.017       |       -0.017       |       -0.017       |       -0.013       |       -0.014       | 0.003 |
|          |       -3.627       |       -3.415       |       -3.638       |       -2.696       |       -3.202       |  0.86 |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
=============================================================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
=============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
|  Group   | asset_growth_rate1 | asset_growth_rate2 | asset_growth_rate3 | asset_growth_rate4 | asset_growth_rate5 |  Diff |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
| Msmvttl1 |       0.027        |       0.027        |       0.027        |       0.026        |       0.027        | 0.001 |
|          |       3.004        |       3.188        |       3.354        |       3.199        |       3.411        | 0.223 |
|  alpha   |       0.025        |       0.025        |       0.025        |       0.025        |       0.025        | 0.001 |
|          |       2.644        |        2.72        |       2.858        |       2.768        |       2.914        | 0.261 |
| Msmvttl2 |       0.015        |       0.018        |       0.019        |       0.021        |        0.02        | 0.005 |
|          |        1.89        |       2.234        |       2.348        |       2.754        |       2.579        | 2.327 |
|  alpha   |       0.014        |       0.017        |       0.018        |        0.02        |       0.019        | 0.005 |
|          |       1.653        |       2.034        |       2.147        |       2.484        |       2.269        |  2.56 |
| Msmvttl3 |       0.012        |       0.014        |       0.017        |       0.015        |       0.018        | 0.005 |
|          |       1.591        |       1.815        |        2.19        |       1.966        |       2.326        | 2.319 |
|  alpha   |       0.012        |       0.013        |       0.017        |       0.014        |       0.017        | 0.004 |
|          |       1.398        |       1.611        |       2.054        |       1.895        |       2.006        | 1.941 |
| Msmvttl4 |       0.009        |       0.011        |       0.013        |       0.014        |       0.015        | 0.005 |
|          |       1.279        |       1.562        |       1.808        |       1.948        |       1.965        | 2.383 |
|  alpha   |       0.009        |        0.01        |       0.012        |       0.013        |       0.014        | 0.005 |
|          |       1.116        |       1.379        |       1.602        |       1.718        |       1.577        | 2.234 |
| Msmvttl5 |       0.009        |        0.01        |       0.011        |       0.014        |       0.013        | 0.004 |
|          |       1.398        |       1.569        |       1.678        |       2.028        |       1.817        | 1.353 |
|  alpha   |       0.009        |       0.009        |        0.01        |       0.013        |       0.013        | 0.004 |
|          |       1.169        |       1.217        |       1.222        |       1.636        |       1.488        | 1.545 |
|   Diff   |       -0.017       |       -0.017       |       -0.017       |       -0.013       |       -0.014       | 0.003 |
|          |       -3.627       |       -3.415       |       -3.638       |       -2.696       |       -3.202       |  0.86 |
|  alpha   |       -0.015       |       -0.016       |       -0.015       |       -0.012       |       -0.012       | 0.003 |
|          |       -3.292       |       -2.822       |       -2.637       |       -1.908       |       -2.144       | 0.985 |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+-------+
```

The result from dataset #2 is consistent with literatures that in univariate analysis the differenced return is not significant since the t-value is below 2.3, while in bivariate analysis the differenced return in most part is insignificant since the t-value is less than 2.3, suggesting that investment factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**



### Momentum Effect

The momentum factor starts from Jegadeesh and Titman (1993) and exists widely in global stock markets (Jegadeesh and Titman, 2001; Rouwenhorst, 1998, 1999; De Groot et al., 2012; Asness et al., 2013) as well as in other markets, like commodity market (Narayan et al., 2015) and bond market (Isreal et al., 2018). However, in China stock market, it is suggested that there exist no such effect (Liu and Lee, 2001; Li et al., 2010).

The momentum effect is quite simple that stocks perform well in past would continue good performance in the future and vice versa. The conventional proxy variable for momentum effect is total yield from past 12 month to past 1 month. Since there may exist short term reversal effect, the last month yield is excluded.

In this demo, the conventional proxy variable in preceding text is chosen. The dataset starts from Jan, 2000 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% import package
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
#month_return = month_return.set_index(['Stkcd', 'Trdmnt'], drop=False)
```

Data need some preprocessing.

```python
# %% preprocessing data
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
```

Construct momentum proxy variable.

```python
# %% construct momentum variable
import numpy as np

month_return['rolling_12'] = np.array(month_return.groupby(['Stkcd'])['Mretwd'].rolling(12).sum())
month_return['momentum'] = month_return['rolling_12'] - month_return['Mretwd']
```

Attach some further data preprocessing.

```python
# %% construct label
month_return['Stkcd_merge'] = month_return['Stkcd'].astype(dtype='string')
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])
# data starts from 2000-01
return_company = month_return[month_return['Date_merge']>='2000-01']
```

Two datasets are constituted. One includes tail 30% stock, while one includes not. Univariate analysis and Bivariate analysis are attached.

```python
# %% construct test_data for bivariate analysis
# dataset 1
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'momentum', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'momentum', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
===================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |  10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+------+-------+
| Average | 0.008 |  0.01 |  0.01 | 0.012 | 0.011 | 0.011 | 0.011 | 0.012 | 0.011 | 0.01 | 0.002 |
|  T-Test | 1.304 | 1.542 | 1.625 | 1.935 |  1.86 | 1.874 | 1.849 | 1.944 | 1.779 | 1.63 | 0.517 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+------+-------+
===================================================================================================

# Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
==============================================================
+-------+--------+--------+--------+--------+--------+-------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff |
+-------+--------+--------+--------+--------+--------+-------+
|   1   | 0.012  | 0.015  | 0.014  | 0.015  | 0.013  | 0.001 |
|       | 1.781  | 2.256  |  2.24  | 2.234  | 1.916  | 0.467 |
|   2   |  0.01  | 0.013  | 0.012  | 0.012  | 0.011  |  0.0  |
|       | 1.599  | 2.074  | 1.873  | 1.836  | 1.613  |  0.14 |
|   3   | 0.009  | 0.009  | 0.009  | 0.011  |  0.01  | 0.001 |
|       |  1.42  | 1.514  | 1.447  | 1.711  |  1.58  | 0.329 |
|   4   | 0.007  | 0.008  |  0.01  | 0.011  | 0.008  | 0.002 |
|       | 1.064  | 1.401  | 1.735  | 1.831  | 1.378  | 0.492 |
|   5   | 0.006  | 0.008  | 0.009  | 0.008  | 0.009  | 0.003 |
|       | 1.002  | 1.395  |  1.58  | 1.403  |  1.67  |  0.99 |
|  Diff | -0.006 | -0.007 | -0.006 | -0.007 | -0.004 | 0.002 |
|       | -1.875 | -2.071 | -1.829 | -1.895 | -1.016 | 0.584 |
+-------+--------+--------+--------+--------+--------+-------+

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.012  | 0.015  | 0.014  | 0.015  | 0.013  | 0.001  |
|       | 1.781  | 2.256  |  2.24  | 2.234  | 1.916  | 0.467  |
| alpha | 0.012  | 0.014  | 0.013  | 0.014  | 0.013  | 0.002  |
|       | 1.645  | 1.907  | 2.051  | 1.991  | 1.656  | 0.512  |
|   2   |  0.01  | 0.013  | 0.012  | 0.012  | 0.011  |  0.0   |
|       | 1.599  | 2.074  | 1.873  | 1.836  | 1.613  |  0.14  |
| alpha |  0.01  | 0.013  | 0.012  | 0.011  |  0.01  |  -0.0  |
|       | 1.478  | 1.773  | 1.736  | 1.543  | 1.372  | -0.108 |
|   3   | 0.009  | 0.009  | 0.009  | 0.011  |  0.01  | 0.001  |
|       |  1.42  | 1.514  | 1.447  | 1.711  |  1.58  | 0.329  |
| alpha | 0.009  | 0.008  | 0.008  |  0.01  |  0.01  | 0.001  |
|       | 1.302  | 1.236  | 1.192  |  1.47  | 1.511  |  0.44  |
|   4   | 0.007  | 0.008  |  0.01  | 0.011  | 0.008  | 0.002  |
|       | 1.064  | 1.401  | 1.735  | 1.831  | 1.378  | 0.492  |
| alpha | 0.006  | 0.008  |  0.01  | 0.011  | 0.009  | 0.003  |
|       | 0.942  | 1.168  | 1.419  | 1.536  | 1.395  |  1.01  |
|   5   | 0.006  | 0.008  | 0.009  | 0.008  | 0.009  | 0.003  |
|       | 1.002  | 1.395  |  1.58  | 1.403  |  1.67  |  0.99  |
| alpha | 0.005  | 0.007  | 0.009  | 0.008  |  0.01  | 0.005  |
|       | 0.659  | 1.022  | 1.388  | 1.152  | 1.573  |  1.39  |
|  Diff | -0.006 | -0.007 | -0.006 | -0.007 | -0.004 | 0.002  |
|       | -1.875 | -2.071 | -1.829 | -1.895 | -1.016 | 0.584  |
| alpha | -0.007 | -0.006 | -0.004 | -0.007 | -0.003 | 0.004  |
|       | -2.139 | -1.876 | -1.244 | -1.586 | -0.629 | 0.993  |
+-------+--------+--------+--------+--------+--------+--------+

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+-------+
|  Group   | momentum1 | momentum2 | momentum3 | momentum4 | momentum5 |  Diff |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
| Msmvttl1 |   0.012   |   0.014   |   0.013   |   0.015   |   0.014   | 0.002 |
|          |   1.823   |   2.097   |   1.997   |   2.245   |   2.048   | 0.581 |
| Msmvttl2 |    0.01   |   0.014   |   0.012   |   0.011   |   0.011   | 0.001 |
|          |   1.563   |   2.096   |   1.876   |   1.769   |   1.616   | 0.208 |
| Msmvttl3 |   0.009   |   0.009   |   0.009   |    0.01   |    0.01   | 0.002 |
|          |   1.343   |    1.44   |   1.526   |   1.665   |   1.599   | 0.572 |
| Msmvttl4 |   0.007   |   0.009   |   0.009   |   0.011   |   0.008   | 0.001 |
|          |   1.131   |   1.546   |   1.615   |   1.778   |   1.378   | 0.395 |
| Msmvttl5 |   0.007   |   0.009   |   0.009   |   0.009   |   0.011   | 0.004 |
|          |    1.24   |   1.644   |   1.641   |   1.585   |   1.908   |  1.14 |
|   Diff   |   -0.005  |   -0.005  |   -0.004  |   -0.006  |   -0.003  | 0.003 |
|          |   -1.621  |   -1.379  |   -1.197  |   -1.606  |   -0.675  | 0.769 |
+----------+-----------+-----------+-----------+-----------+-----------+-------+

# Risk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+-------+
|  Group   | momentum1 | momentum2 | momentum3 | momentum4 | momentum5 |  Diff |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
| Msmvttl1 |   0.012   |   0.014   |   0.013   |   0.015   |   0.014   | 0.002 |
|          |   1.823   |   2.097   |   1.997   |   2.245   |   2.048   | 0.581 |
|  alpha   |   0.012   |   0.013   |   0.013   |   0.014   |   0.014   | 0.002 |
|          |   1.686   |   1.796   |   1.819   |   1.969   |   1.841   | 0.591 |
| Msmvttl2 |    0.01   |   0.014   |   0.012   |   0.011   |   0.011   | 0.001 |
|          |   1.563   |   2.096   |   1.876   |   1.769   |   1.616   | 0.208 |
|  alpha   |    0.01   |   0.013   |   0.012   |   0.011   |    0.01   |  0.0  |
|          |   1.466   |   1.807   |   1.723   |    1.59   |   1.394   | 0.088 |
| Msmvttl3 |   0.009   |   0.009   |   0.009   |    0.01   |    0.01   | 0.002 |
|          |   1.343   |    1.44   |   1.526   |   1.665   |   1.599   | 0.572 |
|  alpha   |   0.008   |   0.008   |   0.008   |    0.01   |    0.01   | 0.002 |
|          |   1.223   |   1.205   |   1.232   |   1.415   |   1.532   | 0.708 |
| Msmvttl4 |   0.007   |   0.009   |   0.009   |   0.011   |   0.008   | 0.001 |
|          |   1.131   |   1.546   |   1.615   |   1.778   |   1.378   | 0.395 |
|  alpha   |   0.007   |   0.008   |   0.009   |    0.01   |   0.009   | 0.003 |
|          |   0.989   |   1.299   |   1.301   |   1.517   |   1.433   | 0.992 |
| Msmvttl5 |   0.007   |   0.009   |   0.009   |   0.009   |   0.011   | 0.004 |
|          |    1.24   |   1.644   |   1.641   |   1.585   |   1.908   |  1.14 |
|  alpha   |   0.007   |   0.008   |   0.009   |   0.009   |   0.012   | 0.006 |
|          |   0.937   |   1.202   |    1.33   |    1.36   |   1.771   | 1.589 |
|   Diff   |   -0.005  |   -0.005  |   -0.004  |   -0.006  |   -0.003  | 0.003 |
|          |   -1.621  |   -1.379  |   -1.197  |   -1.606  |   -0.675  | 0.769 |
|  alpha   |   -0.005  |   -0.005  |   -0.004  |   -0.005  |   -0.001  | 0.004 |
|          |   -1.522  |   -1.298  |   -1.013  |   -1.034  |   -0.286  | 1.468 |
+----------+-----------+-----------+-----------+-----------+-----------+-------+
```

The result from dataset #1 is consistent with literatures that in univariate analysis the differenced return is insignificant since the t-value is below 2.3, while in bivariate analysis the differenced return in most part is insignificant since the t-value is less than 2.3, suggesting that momentum factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[return_company['Ndaytrd']>=10]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'momentum', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2005-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_1[['emrwd', 'momentum', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
===================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |  10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+------+-------+
| Average | 0.008 |  0.01 |  0.01 | 0.012 | 0.011 | 0.011 | 0.011 | 0.012 | 0.011 | 0.01 | 0.002 |
|  T-Test | 1.304 | 1.542 | 1.625 | 1.935 |  1.86 | 1.874 | 1.849 | 1.944 | 1.779 | 1.63 | 0.517 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+------+-------+
===================================================================================================

# Independent-sort Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.037  | 0.033  | 0.033  | 0.032  | 0.034  | -0.003 |
|       | 3.631  | 3.617  | 3.778  | 3.489  | 3.164  | -0.953 |
|   2   |  0.02  | 0.023  | 0.023  | 0.023  |  0.02  |  0.0   |
|       | 2.359  | 2.748  | 2.837  | 2.712  | 2.307  | 0.057  |
|   3   | 0.017  |  0.02  | 0.018  | 0.017  | 0.018  | 0.001  |
|       | 2.077  | 2.441  | 2.355  | 2.136  | 2.107  | 0.281  |
|   4   | 0.014  | 0.013  | 0.015  | 0.016  | 0.016  | 0.002  |
|       | 1.702  | 1.798  | 1.975  | 2.047  | 2.029  | 0.687  |
|   5   |  0.01  | 0.013  | 0.014  | 0.012  | 0.013  | 0.003  |
|       | 1.424  | 1.859  | 2.104  | 1.751  | 1.824  | 0.654  |
|  Diff | -0.026 | -0.02  | -0.018 | -0.02  | -0.021 | 0.006  |
|       | -4.106 | -3.852 | -4.186 | -3.809 | -2.916 | 1.186  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2005':'2019']
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.037  | 0.033  | 0.033  | 0.032  | 0.034  | -0.003 |
|       | 3.631  | 3.617  | 3.778  | 3.489  | 3.164  | -0.953 |
| alpha | 0.037  | 0.032  |  0.03  |  0.03  | 0.033  | -0.004 |
|       | 3.164  | 3.236  | 3.291  | 3.016  | 2.745  | -1.181 |
|   2   |  0.02  | 0.023  | 0.023  | 0.023  |  0.02  |  0.0   |
|       | 2.359  | 2.748  | 2.837  | 2.712  | 2.307  | 0.057  |
| alpha | 0.019  | 0.021  | 0.022  | 0.022  | 0.019  |  0.0   |
|       | 2.329  | 2.584  | 2.603  | 2.475  | 2.096  | 0.019  |
|   3   | 0.017  |  0.02  | 0.018  | 0.017  | 0.018  | 0.001  |
|       | 2.077  | 2.441  | 2.355  | 2.136  | 2.107  | 0.281  |
| alpha | 0.017  | 0.019  | 0.018  | 0.016  | 0.017  |  0.0   |
|       | 2.079  | 2.237  |  2.26  |  2.01  | 1.925  | 0.154  |
|   4   | 0.014  | 0.013  | 0.015  | 0.016  | 0.016  | 0.002  |
|       | 1.702  | 1.798  | 1.975  | 2.047  | 2.029  | 0.687  |
| alpha | 0.013  | 0.012  | 0.014  | 0.015  | 0.016  | 0.003  |
|       | 1.626  | 1.629  | 1.725  | 1.824  |  1.85  | 0.751  |
|   5   |  0.01  | 0.013  | 0.014  | 0.012  | 0.013  | 0.003  |
|       | 1.424  | 1.859  | 2.104  | 1.751  | 1.824  | 0.654  |
| alpha |  0.01  | 0.013  | 0.014  | 0.012  | 0.014  | 0.004  |
|       | 1.173  | 1.484  | 1.773  | 1.386  | 1.676  | 0.837  |
|  Diff | -0.026 | -0.02  | -0.018 | -0.02  | -0.021 | 0.006  |
|       | -4.106 | -3.852 | -4.186 | -3.809 | -2.916 | 1.186  |
| alpha | -0.027 | -0.019 | -0.016 | -0.019 | -0.019 | 0.008  |
|       | -3.941 | -3.516 | -2.868 | -3.331 | -2.567 | 1.645  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
=================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+--------+
|  Group   | momentum1 | momentum2 | momentum3 | momentum4 | momentum5 |  Diff  |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
| Msmvttl1 |   0.036   |   0.034   |   0.035   |   0.031   |   0.031   | -0.004 |
|          |   3.527   |   3.661   |   3.746   |   3.581   |   3.302   | -1.194 |
| Msmvttl2 |    0.02   |   0.023   |   0.023   |   0.022   |   0.021   | 0.001  |
|          |   2.377   |   2.763   |   2.746   |   2.653   |   2.407   | 0.224  |
| Msmvttl3 |   0.017   |    0.02   |   0.018   |   0.017   |   0.018   | 0.001  |
|          |   2.072   |   2.451   |   2.333   |   2.142   |   2.091   | 0.269  |
| Msmvttl4 |   0.014   |   0.014   |   0.016   |   0.017   |   0.015   | 0.001  |
|          |   1.737   |   1.895   |   2.045   |   2.224   |   1.862   | 0.257  |
| Msmvttl5 |   0.012   |   0.013   |   0.014   |   0.014   |   0.014   | 0.002  |
|          |   1.679   |   1.923   |   2.102   |   1.993   |   1.863   | 0.394  |
|   Diff   |   -0.023  |   -0.02   |   -0.021  |   -0.018  |   -0.017  | 0.006  |
|          |   -3.716  |   -3.788  |   -3.638  |   -3.408  |   -2.896  | 1.205  |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
=================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
=================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+--------+
|  Group   | momentum1 | momentum2 | momentum3 | momentum4 | momentum5 |  Diff  |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
| Msmvttl1 |   0.036   |   0.034   |   0.035   |   0.031   |   0.031   | -0.004 |
|          |   3.527   |   3.661   |   3.746   |   3.581   |   3.302   | -1.194 |
|  alpha   |   0.035   |   0.033   |   0.034   |   0.028   |   0.029   | -0.006 |
|          |   3.246   |    3.24   |   3.292   |   3.187   |   2.961   | -1.488 |
| Msmvttl2 |    0.02   |   0.023   |   0.023   |   0.022   |   0.021   | 0.001  |
|          |   2.377   |   2.763   |   2.746   |   2.653   |   2.407   | 0.224  |
|  alpha   |   0.019   |   0.021   |   0.022   |   0.021   |    0.02   | 0.001  |
|          |   2.323   |   2.592   |   2.615   |   2.407   |   2.176   | 0.207  |
| Msmvttl3 |   0.017   |    0.02   |   0.018   |   0.017   |   0.018   | 0.001  |
|          |   2.072   |   2.451   |   2.333   |   2.142   |   2.091   | 0.269  |
|  alpha   |   0.017   |   0.019   |   0.018   |   0.016   |   0.017   | 0.001  |
|          |   2.094   |   2.198   |   2.255   |   2.067   |   1.927   | 0.182  |
| Msmvttl4 |   0.014   |   0.014   |   0.016   |   0.017   |   0.015   | 0.001  |
|          |   1.737   |   1.895   |   2.045   |   2.224   |   1.862   | 0.257  |
|  alpha   |   0.013   |   0.013   |   0.014   |   0.017   |   0.015   | 0.002  |
|          |   1.644   |   1.659   |   1.755   |   1.946   |   1.762   | 0.445  |
| Msmvttl5 |   0.012   |   0.013   |   0.014   |   0.014   |   0.014   | 0.002  |
|          |   1.679   |   1.923   |   2.102   |   1.993   |   1.863   | 0.394  |
|  alpha   |   0.012   |   0.013   |   0.013   |   0.014   |   0.015   | 0.003  |
|          |   1.415   |   1.468   |   1.636   |   1.659   |   1.726   | 0.698  |
|   Diff   |   -0.023  |   -0.02   |   -0.021  |   -0.018  |   -0.017  | 0.006  |
|          |   -3.716  |   -3.788  |   -3.638  |   -3.408  |   -2.896  | 1.205  |
|  alpha   |   -0.023  |   -0.021  |   -0.021  |   -0.015  |   -0.015  | 0.008  |
|          |   -3.75   |   -3.493  |   -3.386  |   -2.322  |   -2.355  | 1.691  |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
```

The result from dataset #2 is consistent with literatures that in univariate analysis the differenced return is insignificant since the t-value is below 2.3, while in bivariate analysis the differenced return in most part is insignificant since the t-value is less than 2.3, suggesting that momentum factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**



### Turnover Factor

Trading volume would effect the stock performance, which has a long history in industry while in academic research is burgeoning. Instead of trading volume, turnover is a standard substitution. The common sense is that turnover is generally negative correlated with the future return (Chordia et al., 2001). While Subrahmanyam (2005) found the asymmetric structure that for poor performance stock, the correlation is negative; for good performance stock, the correlation is positive. In other global market, Hu (1997) and Chang et al. (2010) find negative correlation in Japan market; Dey (2005) find positive correlation in emerging market. In China market, Liu et al. (2019) find negative correlation, which can explain the short term reversal effect.

In this demo, the proxy variable for turnover factor is abnormal turnover, which is the ratio of average turnover in past 1 month to average turnover in past 12 month. he dataset starts from Jan, 2000 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% import package
import pandas as pd
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
trade_data = pd.read_hdf('.\data\mean_filter_trade.h5', key='data')
```

Conduct some data preprocessing.

```python
# %% preprocessing data
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
```

Construct the proxy variable.

```python
# %% constrcut variable
import numpy as np
trade_data['rolling_Turnover'] = np.array(trade_data['Turnover'].groupby('Symbol').rolling(12).mean())
trade_data['specific_Turnover'] = trade_data['Turnover'] / trade_data['rolling_Turnover']
```

Some further data processing.

```python
# %% prepare merge data
from pandas.tseries.offsets import *

month_return['Stkcd_merge'] = month_return['Stkcd'].astype(dtype='string')
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])
#month_return['Yearmonth'] = month_return['Date_merge'].map(lambda x : 1000*x.year + x.month)
#month_return['Date_merge'] += MonthEnd()

trade_data['Stkcd_merge'] = trade_data['Symbol'].dropna().astype(dtype='int').astype(dtype='string')
trade_data['TradingDate'] = trade_data.index.map(lambda x : x[1])
trade_data['Date_merge'] = pd.to_datetime(trade_data['TradingDate'])
#company_data['Yearmonth'] = company_data['Date_merge'].map(lambda x : 1000*x.year + x.month)
trade_data['Date_merge'] += MonthBegin()

# %% dataset starts from '2000-01'
trade_data = trade_data[trade_data['Date_merge'] >= '2000-01']
month_return = month_return[month_return['Date_merge'] >= '2000-01']
return_company = pd.merge(trade_data, month_return, on=['Stkcd_merge', 'Date_merge'])
```

Two datasets are constituted. One includes tail 30% stock, while one includes not. Univariate analysis and Bivariate analysis are attached.

```python
# %% construct test_data for bivariate analysis
# dataset 1 : 
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'specific_Turnover', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'specific_Turnover', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
=====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff  |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
| Average | 0.009 | 0.011 | 0.012 | 0.013 | 0.012 | 0.012 | 0.011 | 0.011 | 0.009 | 0.005 | -0.004 |
|  T-Test | 1.644 | 1.945 | 2.088 | 2.132 |  2.02 | 1.997 |  1.87 |  1.74 | 1.545 | 0.841 | -1.426 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
=====================================================================================================

# Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
================================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.014  | 0.016  | 0.015  | 0.014  | 0.009  | -0.004 |
|       | 2.153  | 2.447  | 2.307  | 2.139  | 1.412  | -1.827 |
|   2   | 0.011  | 0.013  | 0.013  | 0.011  | 0.009  | -0.002 |
|       | 1.878  | 2.081  | 2.029  | 1.661  | 1.364  | -0.882 |
|   3   |  0.01  |  0.01  | 0.011  |  0.01  | 0.005  | -0.005 |
|       | 1.732  | 1.628  | 1.768  | 1.665  | 0.842  | -1.928 |
|   4   | 0.009  | 0.011  |  0.01  | 0.009  | 0.007  | -0.002 |
|       | 1.656  | 1.857  | 1.679  | 1.587  |  1.13  | -0.723 |
|   5   | 0.008  | 0.011  |  0.01  | 0.009  | 0.005  | -0.003 |
|       | 1.515  | 2.045  | 1.935  |  1.63  | 0.854  | -1.275 |
|  Diff | -0.005 | -0.005 | -0.004 | -0.005 | -0.005 | 0.001  |
|       | -1.561 | -1.536 | -1.264 | -1.361 | -1.333 | 0.367  |
+-------+--------+--------+--------+--------+--------+--------+
================================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.014  | 0.016  | 0.015  | 0.014  | 0.009  | -0.004 |
|       | 2.153  | 2.447  | 2.307  | 2.139  | 1.412  | -1.827 |
| alpha | 0.013  | 0.016  | 0.014  | 0.014  | 0.008  | -0.005 |
|       | 1.947  | 2.153  | 1.983  | 2.019  | 1.183  | -2.608 |
|   2   | 0.011  | 0.013  | 0.013  | 0.011  | 0.009  | -0.002 |
|       | 1.878  | 2.081  | 2.029  | 1.661  | 1.364  | -0.882 |
| alpha | 0.012  | 0.013  | 0.012  |  0.01  | 0.009  | -0.003 |
|       | 1.597  | 1.925  | 1.849  | 1.531  | 1.173  | -1.764 |
|   3   |  0.01  |  0.01  | 0.011  |  0.01  | 0.005  | -0.005 |
|       | 1.732  | 1.628  | 1.768  | 1.665  | 0.842  | -1.928 |
| alpha | 0.011  | 0.009  |  0.01  | 0.009  | 0.004  | -0.006 |
|       |  1.56  | 1.429  | 1.591  | 1.475  | 0.634  | -3.213 |
|   4   | 0.009  | 0.011  |  0.01  | 0.009  | 0.007  | -0.002 |
|       | 1.656  | 1.857  | 1.679  | 1.587  |  1.13  | -0.723 |
| alpha |  0.01  | 0.011  | 0.009  | 0.008  | 0.007  | -0.003 |
|       | 1.404  | 1.606  | 1.458  | 1.334  | 0.964  | -1.437 |
|   5   | 0.008  | 0.011  |  0.01  | 0.009  | 0.005  | -0.003 |
|       | 1.515  | 2.045  | 1.935  |  1.63  | 0.854  | -1.275 |
| alpha | 0.009  | 0.011  | 0.011  | 0.009  | 0.005  | -0.004 |
|       |  1.23  | 1.704  | 1.651  | 1.361  | 0.713  | -1.914 |
|  Diff | -0.005 | -0.005 | -0.004 | -0.005 | -0.005 | 0.001  |
|       | -1.561 | -1.536 | -1.264 | -1.361 | -1.333 | 0.367  |
| alpha | -0.004 | -0.005 | -0.004 | -0.005 | -0.003 | 0.001  |
|       | -1.057 | -1.349 | -0.986 | -1.143 | -0.832 | 0.537  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
==============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | specific_Turnover1 | specific_Turnover2 | specific_Turnover3 | specific_Turnover4 | specific_Turnover5 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.014        |       0.015        |       0.015        |       0.014        |        0.01        | -0.004 |
|          |       2.121        |       2.361        |       2.227        |       2.185        |       1.483        | -1.678 |
| Msmvttl2 |       0.012        |       0.013        |       0.013        |       0.011        |       0.009        | -0.002 |
|          |        1.91        |        2.1         |       1.948        |       1.754        |       1.354        | -1.002 |
| Msmvttl3 |        0.01        |        0.01        |        0.01        |       0.011        |       0.006        | -0.004 |
|          |       1.666        |       1.699        |       1.715        |       1.681        |       0.883        | -1.684 |
| Msmvttl4 |       0.009        |       0.011        |       0.011        |        0.01        |       0.006        | -0.003 |
|          |       1.656        |       1.849        |       1.874        |       1.659        |       0.949        | -1.139 |
| Msmvttl5 |       0.007        |       0.011        |       0.011        |       0.011        |       0.005        | -0.003 |
|          |       1.402        |       2.085        |       2.093        |       1.891        |       0.793        | -1.051 |
|   Diff   |       -0.006       |       -0.004       |       -0.004       |       -0.004       |       -0.005       | 0.001  |
|          |       -1.788       |       -1.188       |       -0.984       |       -1.064       |       -1.512       |  0.31  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
==============================================================================================================================

# Risk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
==============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | specific_Turnover1 | specific_Turnover2 | specific_Turnover3 | specific_Turnover4 | specific_Turnover5 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.014        |       0.015        |       0.015        |       0.014        |        0.01        | -0.004 |
|          |       2.121        |       2.361        |       2.227        |       2.185        |       1.483        | -1.678 |
|  alpha   |       0.013        |       0.015        |       0.014        |       0.014        |       0.009        | -0.004 |
|          |       1.915        |        2.08        |       1.928        |       2.103        |        1.26        | -2.325 |
| Msmvttl2 |       0.012        |       0.013        |       0.013        |       0.011        |       0.009        | -0.002 |
|          |        1.91        |        2.1         |       1.948        |       1.754        |       1.354        | -1.002 |
|  alpha   |       0.012        |       0.013        |       0.012        |       0.011        |       0.009        | -0.003 |
|          |       1.659        |       1.934        |        1.76        |       1.606        |       1.185        | -2.273 |
| Msmvttl3 |        0.01        |        0.01        |        0.01        |       0.011        |       0.006        | -0.004 |
|          |       1.666        |       1.699        |       1.715        |       1.681        |       0.883        | -1.684 |
|  alpha   |        0.01        |        0.01        |        0.01        |        0.01        |       0.005        | -0.006 |
|          |       1.508        |       1.498        |       1.534        |       1.473        |       0.678        | -2.96  |
| Msmvttl4 |       0.009        |       0.011        |       0.011        |        0.01        |       0.006        | -0.003 |
|          |       1.656        |       1.849        |       1.874        |       1.659        |       0.949        | -1.139 |
|  alpha   |       0.009        |       0.011        |       0.011        |       0.009        |       0.005        | -0.004 |
|          |       1.413        |       1.616        |        1.56        |       1.494        |       0.766        | -2.048 |
| Msmvttl5 |       0.007        |       0.011        |       0.011        |       0.011        |       0.005        | -0.003 |
|          |       1.402        |       2.085        |       2.093        |       1.891        |       0.793        | -1.051 |
|  alpha   |       0.008        |       0.012        |       0.011        |        0.01        |       0.004        | -0.004 |
|          |       1.134        |        1.71        |       1.768        |       1.469        |       0.601        | -1.843 |
|   Diff   |       -0.006       |       -0.004       |       -0.004       |       -0.004       |       -0.005       | 0.001  |
|          |       -1.788       |       -1.188       |       -0.984       |       -1.064       |       -1.512       |  0.31  |
|  alpha   |       -0.005       |       -0.003       |       -0.003       |       -0.004       |       -0.005       |  0.0   |
|          |       -1.437       |       -0.868       |       -0.671       |       -1.043       |       -1.232       | 0.183  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
```

The result from dataset #1 is not completely consistent with literatures that in univariate analysis the differenced return is insignificant since the absolute t-value is below 2.3, while in bivariate analysis the differenced return in most part is insignificant since the absolute t-value is less than 2.3, suggesting that turnover factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2 : 
from portfolio_analysis import Bivariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[return_company['Ndaytrd']>=10]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'specific_Turnover', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2004-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'specific_Turnover', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
=====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff  |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
| Average | 0.016 | 0.018 | 0.019 |  0.02 | 0.019 | 0.019 | 0.018 | 0.016 | 0.016 | 0.012 | -0.004 |
|  T-Test | 2.218 | 2.511 |  2.59 | 2.648 | 2.566 | 2.555 | 2.422 | 2.217 | 2.077 | 1.454 | -1.353 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+
=====================================================================================================

# Independent-sort Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.029  |  0.03  | 0.033  | 0.026  | 0.025  | -0.004 |
|       | 3.507  | 3.455  | 3.075  | 3.203  | 2.579  | -1.289 |
|   2   | 0.018  | 0.021  | 0.022  | 0.018  | 0.013  | -0.004 |
|       | 2.334  | 2.697  | 2.715  | 2.257  | 1.631  | -1.955 |
|   3   | 0.015  | 0.016  | 0.017  | 0.015  | 0.012  | -0.003 |
|       | 2.115  | 2.237  | 2.255  | 1.969  | 1.529  | -1.119 |
|   4   | 0.012  | 0.013  | 0.013  | 0.014  | 0.009  | -0.003 |
|       |  1.86  | 1.759  | 1.822  | 1.858  | 1.177  | -1.216 |
|   5   | 0.011  | 0.015  | 0.012  | 0.012  | 0.009  | -0.002 |
|       | 1.729  | 2.289  | 1.812  | 1.752  | 1.254  | -0.724 |
|  Diff | -0.018 | -0.015 | -0.021 | -0.015 | -0.016 | 0.002  |
|       | -3.758 | -3.114 | -2.752 | -3.186 | -2.481 |  0.48  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2004':'2019']
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
===============================================================
+-------+--------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |   5    |  Diff  |
+-------+--------+--------+--------+--------+--------+--------+
|   1   | 0.029  |  0.03  | 0.033  | 0.026  | 0.025  | -0.004 |
|       | 3.507  | 3.455  | 3.075  | 3.203  | 2.579  | -1.289 |
| alpha | 0.028  | 0.029  | 0.032  | 0.024  | 0.024  | -0.004 |
|       | 3.031  | 2.749  | 2.737  | 2.676  | 2.213  | -1.18  |
|   2   | 0.018  | 0.021  | 0.022  | 0.018  | 0.013  | -0.004 |
|       | 2.334  | 2.697  | 2.715  | 2.257  | 1.631  | -1.955 |
| alpha | 0.017  |  0.02  | 0.021  | 0.017  | 0.011  | -0.006 |
|       | 2.158  | 2.405  |  2.38  | 2.001  | 1.353  | -2.672 |
|   3   | 0.015  | 0.016  | 0.017  | 0.015  | 0.012  | -0.003 |
|       | 2.115  | 2.237  | 2.255  | 1.969  | 1.529  | -1.119 |
| alpha | 0.016  | 0.016  | 0.016  | 0.014  | 0.011  | -0.005 |
|       | 1.909  | 2.136  | 1.973  | 1.896  | 1.282  | -2.623 |
|   4   | 0.012  | 0.013  | 0.013  | 0.014  | 0.009  | -0.003 |
|       |  1.86  | 1.759  | 1.822  | 1.858  | 1.177  | -1.216 |
| alpha | 0.013  | 0.012  | 0.012  | 0.012  | 0.008  | -0.005 |
|       | 1.626  | 1.495  | 1.586  | 1.632  | 0.924  | -3.123 |
|   5   | 0.011  | 0.015  | 0.012  | 0.012  | 0.009  | -0.002 |
|       | 1.729  | 2.289  | 1.812  | 1.752  | 1.254  | -0.724 |
| alpha | 0.012  | 0.015  | 0.012  | 0.011  | 0.008  | -0.004 |
|       | 1.336  | 1.876  | 1.561  | 1.388  | 0.916  | -1.945 |
|  Diff | -0.018 | -0.015 | -0.021 | -0.015 | -0.016 | 0.002  |
|       | -3.758 | -3.114 | -2.752 | -3.186 | -2.481 |  0.48  |
| alpha | -0.016 | -0.014 | -0.02  | -0.013 | -0.016 |  0.0   |
|       | -2.902 | -2.732 | -2.876 | -2.258 | -2.465 | 0.062  |
+-------+--------+--------+--------+--------+--------+--------+
===============================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
==============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | specific_Turnover1 | specific_Turnover2 | specific_Turnover3 | specific_Turnover4 | specific_Turnover5 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.028        |       0.029        |       0.031        |       0.034        |       0.023        | -0.005 |
|          |       3.371        |       3.396        |       3.523        |       3.108        |       2.607        | -1.892 |
| Msmvttl2 |       0.018        |        0.02        |       0.022        |       0.018        |       0.013        | -0.004 |
|          |       2.328        |       2.613        |        2.81        |       2.265        |       1.621        | -2.07  |
| Msmvttl3 |       0.015        |       0.017        |       0.017        |       0.015        |       0.012        | -0.004 |
|          |       2.118        |       2.265        |       2.219        |       2.006        |       1.468        | -1.401 |
| Msmvttl4 |       0.013        |       0.013        |       0.013        |       0.014        |       0.009        | -0.004 |
|          |       1.879        |       1.844        |       1.875        |       1.854        |       1.132        | -1.385 |
| Msmvttl5 |       0.011        |       0.013        |       0.014        |       0.011        |       0.009        | -0.001 |
|          |       1.671        |       2.006        |       2.208        |       1.671        |        1.31        | -0.474 |
|   Diff   |       -0.017       |       -0.016       |       -0.017       |       -0.022       |       -0.014       | 0.003  |
|          |       -3.706       |       -3.182       |       -3.386       |       -2.867       |       -2.528       | 0.928  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
==============================================================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
===============================================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | specific_Turnover1 | specific_Turnover2 | specific_Turnover3 | specific_Turnover4 | specific_Turnover5 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.028        |       0.029        |       0.031        |       0.034        |       0.023        | -0.005 |
|          |       3.371        |       3.396        |       3.523        |       3.108        |       2.607        | -1.892 |
|  alpha   |       0.026        |       0.027        |        0.03        |       0.033        |       0.021        | -0.004 |
|          |       2.941        |       2.925        |       2.821        |       2.735        |       2.226        |  -1.8  |
| Msmvttl2 |       0.018        |        0.02        |       0.022        |       0.018        |       0.013        | -0.004 |
|          |       2.328        |       2.613        |        2.81        |       2.265        |       1.621        | -2.07  |
|  alpha   |       0.017        |        0.02        |       0.022        |       0.017        |       0.011        | -0.006 |
|          |       2.153        |        2.33        |       2.463        |       2.081        |       1.326        | -2.996 |
| Msmvttl3 |       0.015        |       0.017        |       0.017        |       0.015        |       0.012        | -0.004 |
|          |       2.118        |       2.265        |       2.219        |       2.006        |       1.468        | -1.401 |
|  alpha   |       0.016        |       0.017        |       0.016        |       0.014        |       0.011        | -0.005 |
|          |       1.907        |       2.149        |        1.95        |       1.886        |       1.284        | -2.633 |
| Msmvttl4 |       0.013        |       0.013        |       0.013        |       0.014        |       0.009        | -0.004 |
|          |       1.879        |       1.844        |       1.875        |       1.854        |       1.132        | -1.385 |
|  alpha   |       0.013        |       0.013        |       0.012        |       0.013        |       0.007        | -0.006 |
|          |       1.614        |       1.562        |       1.624        |       1.636        |       0.882        | -3.374 |
| Msmvttl5 |       0.011        |       0.013        |       0.014        |       0.011        |       0.009        | -0.001 |
|          |       1.671        |       2.006        |       2.208        |       1.671        |        1.31        | -0.474 |
|  alpha   |       0.011        |       0.013        |       0.014        |        0.01        |       0.008        | -0.003 |
|          |       1.318        |       1.642        |        1.8         |       1.202        |       0.954        | -1.509 |
|   Diff   |       -0.017       |       -0.016       |       -0.017       |       -0.022       |       -0.014       | 0.003  |
|          |       -3.706       |       -3.182       |       -3.386       |       -2.867       |       -2.528       | 0.928  |
|  alpha   |       -0.015       |       -0.014       |       -0.016       |       -0.023       |       -0.013       | 0.001  |
|          |       -2.835       |       -2.632       |       -2.713       |       -2.967       |       -2.339       | 0.379  |
+----------+--------------------+--------------------+--------------------+--------------------+--------------------+--------+
```

The result from dataset #2 is not completely consistent with literatures that in univariate analysis the differenced return is insignificant since the absolute t-value is below 2.3, while in bivariate analysis the differenced return in most part is insignificant since the absolute t-value is less than 2.3, suggesting that turnover factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**



### Liquidity Factor

Liquidity is found an supplementary factor that drive stock return especially small stocks. A security's liquidity refers to the ease with which the security can be bought and/or sold. CAPM and APT assume that all security are perfectly liquid, meaning that transaction cost are zero. The classic measure of liquidity is from Amihud (2002), which is defined as 
$$
Illiq_i=\frac 1D\sum_{d=1}^D{\frac {|R_{i,d}|}{VOLD_{i,d}}},
$$
where R is the return of stock i on day d, VOLD is the money volume of stock i traded on day d, and D is the number of days in the estimation period. If a stock is more liquid, then the indicator tend to be small and vice versa. 

It is widely observed that illiquidity is positive correlated with future stock return. In another word, liquidity is negative correlated with future stock return.

In this demo, the proxy variable for liquidity factor is Amihud's indicator. The dataset starts from Jan, 2000 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% set path
import sys, os

sys.path.append(os.path.abspath(".."))

# %% import data
# Monthly return of stocks in China security market
import pandas as pd

month_return = pd.read_hdf('.\data\month_return.h5', key='month_return')
company_data = pd.read_hdf('.\data\last_filter_pe.h5', key='data')
```

Data preprocessing

```python
# %% preprocessing data
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)
```

Construct proxy variable

```python
# %% construct proxy variable
import numpy as np

month_return['liquidity_monthly'] = month_return['Mretwd'].apply(np.abs) / month_return['Mnvaltrd']
```

Further data preprocessing

```python
# %% construct dataset
month_return['Stkcd_merge'] = month_return['Stkcd'].astype(dtype='string')
month_return['Date_merge'] = pd.to_datetime(month_return['Trdmnt'])

return_company = month_return
```

Dataset #1. The result from dataset #1 is consistent with literatures that in univariate analysis the differenced return is significant since the absolute t-value is greater than 2.3, and in bivariate analysis the differenced return in most part is significant since the absolute t-value is greater than 2.3, suggesting that liquidity factor provides excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 1 : 
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'liquidity_monthly', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'liquidity_monthly', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
===================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.005 | 0.006 | 0.008 | 0.008 | 0.009 |  0.01 | 0.011 | 0.012 | 0.014 | 0.017 | 0.012 |
|  T-Test |  0.9  |  1.08 | 1.329 | 1.276 | 1.515 | 1.608 | 1.878 | 2.002 | 2.299 | 2.797 | 4.404 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+

# Independent-sort Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=3)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
====================================================
+-------+-------+-------+--------+--------+--------+
| Group |   1   |   2   |   3    |   4    |  Diff  |
+-------+-------+-------+--------+--------+--------+
|   1   | 0.004 | 0.007 | 0.011  | 0.018  | 0.013  |
|       | 0.675 |  1.12 | 1.609  |  2.66  | 5.671  |
|   2   | 0.006 | 0.008 |  0.01  | 0.014  | 0.008  |
|       | 0.926 | 1.188 | 1.627  | 2.386  | 3.765  |
|   3   | 0.004 | 0.008 | 0.011  | 0.012  | 0.007  |
|       | 0.711 | 1.318 | 1.805  | 2.079  | 3.194  |
|   4   | 0.008 |  0.01 |  0.01  |  0.01  | 0.002  |
|       | 1.459 | 1.711 |  1.83  | 1.644  | 0.484  |
|  Diff | 0.003 | 0.002 | -0.001 | -0.008 | -0.012 |
|       | 1.026 | 0.715 | -0.26  | -2.397 | -3.497 |
+-------+-------+-------+--------+--------+--------+
====================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
====================================================
+-------+-------+-------+--------+--------+--------+
| Group |   1   |   2   |   3    |   4    |  Diff  |
+-------+-------+-------+--------+--------+--------+
|   1   | 0.004 | 0.007 | 0.011  | 0.018  | 0.013  |
|       | 0.675 |  1.12 | 1.609  |  2.66  | 5.671  |
| alpha | 0.003 | 0.006 |  0.01  | 0.018  | 0.015  |
|       | 0.385 | 0.852 | 1.387  | 2.499  |  7.72  |
|   2   | 0.006 | 0.008 |  0.01  | 0.014  | 0.008  |
|       | 0.926 | 1.188 | 1.627  | 2.386  | 3.765  |
| alpha | 0.004 | 0.007 |  0.01  | 0.015  | 0.011  |
|       | 0.608 | 0.947 | 1.482  | 2.198  | 6.722  |
|   3   | 0.004 | 0.008 | 0.011  | 0.012  | 0.007  |
|       | 0.711 | 1.318 | 1.805  | 2.079  | 3.194  |
| alpha | 0.004 | 0.007 |  0.01  | 0.013  | 0.009  |
|       | 0.572 | 1.119 |  1.53  | 1.959  | 4.325  |
|   4   | 0.008 |  0.01 |  0.01  |  0.01  | 0.002  |
|       | 1.459 | 1.711 |  1.83  | 1.644  | 0.484  |
| alpha | 0.008 | 0.009 |  0.01  | 0.011  | 0.003  |
|       | 1.179 | 1.393 | 1.622  | 1.569  | 0.865  |
|  Diff | 0.003 | 0.002 | -0.001 | -0.008 | -0.012 |
|       | 1.026 | 0.715 | -0.26  | -2.397 | -3.497 |
| alpha | 0.005 | 0.003 | 0.001  | -0.006 | -0.011 |
|       | 1.404 | 1.009 | 0.164  | -1.97  | -3.135 |
+-------+-------+-------+--------+--------+--------+
====================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=3)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
=========================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | liquidity_monthly1 | liquidity_monthly2 | liquidity_monthly3 | liquidity_monthly4 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.007        |        0.01        |       0.015        |       0.019        | 0.013  |
|          |       1.023        |       1.538        |       2.219        |       2.909        |  6.07  |
| Msmvttl2 |       0.007        |        0.01        |       0.011        |       0.015        | 0.008  |
|          |       1.025        |       1.482        |       1.734        |       2.434        | 3.936  |
| Msmvttl3 |       0.004        |       0.008        |        0.01        |       0.012        | 0.007  |
|          |        0.71        |        1.31        |       1.684        |       2.064        | 3.571  |
| Msmvttl4 |       0.007        |       0.009        |        0.01        |       0.009        | 0.002  |
|          |       1.295        |       1.531        |       1.751        |       1.718        | 1.047  |
|   Diff   |        0.0         |       -0.002       |       -0.005       |       -0.01        | -0.01  |
|          |       0.055        |       -0.506       |       -1.594       |       -3.182       | -4.244 |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
=========================================================================================================

# Risk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
=========================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | liquidity_monthly1 | liquidity_monthly2 | liquidity_monthly3 | liquidity_monthly4 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.007        |        0.01        |       0.015        |       0.019        | 0.013  |
|          |       1.023        |       1.538        |       2.219        |       2.909        |  6.07  |
|  alpha   |       0.005        |       0.009        |       0.015        |       0.019        | 0.014  |
|          |       0.711        |       1.316        |       2.083        |       2.714        | 7.476  |
| Msmvttl2 |       0.007        |        0.01        |       0.011        |       0.015        | 0.008  |
|          |       1.025        |       1.482        |       1.734        |       2.434        | 3.936  |
|  alpha   |       0.005        |       0.009        |       0.011        |       0.015        |  0.01  |
|          |       0.732        |       1.254        |       1.617        |       2.264        | 6.989  |
| Msmvttl3 |       0.004        |       0.008        |        0.01        |       0.012        | 0.007  |
|          |        0.71        |        1.31        |       1.684        |       2.064        | 3.571  |
|  alpha   |       0.004        |       0.007        |       0.009        |       0.013        | 0.009  |
|          |       0.569        |        1.1         |       1.367        |       1.945        | 4.717  |
| Msmvttl4 |       0.007        |       0.009        |        0.01        |       0.009        | 0.002  |
|          |       1.295        |       1.531        |       1.751        |       1.718        | 1.047  |
|  alpha   |       0.007        |       0.008        |       0.009        |        0.01        | 0.003  |
|          |       1.102        |       1.209        |       1.385        |       1.512        |  1.2   |
|   Diff   |        0.0         |       -0.002       |       -0.005       |       -0.01        | -0.01  |
|          |       0.055        |       -0.506       |       -1.594       |       -3.182       | -4.244 |
|  alpha   |       0.002        |       -0.001       |       -0.005       |       -0.01        | -0.012 |
|          |       0.578        |       -0.231       |       -1.347       |       -2.983       | -5.334 |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
```

Dataset #2. The result from dataset #2 is consistent with literatures that in univariate analysis the differenced return is significant since the absolute t-value is greater than 2.3, and in bivariate analysis the differenced return in most part is significant since the absolute t-value is greater than 2.3, suggesting that liquidity factor provides excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2 : tail stocks & ROE Bivariate  
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[return_company['Ndaytrd']>=10]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'liquidity_monthly', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2000-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'liquidity_monthly', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
=====================================================================
+---------+-------+-------+-------+------+-------+-------+-------+-------+------+-------+-------+
|  Group  |   1   |   2   |   3   |  4   |   5   |   6   |   7   |   8   |  9   |   10  |  Diff |
+---------+-------+-------+-------+------+-------+-------+-------+-------+------+-------+-------+
| Average | 0.006 | 0.007 | 0.008 | 0.01 | 0.012 | 0.014 | 0.014 | 0.016 | 0.02 | 0.028 | 0.023 |
|  T-Test | 0.997 | 1.197 | 1.399 | 1.65 | 1.858 | 2.192 | 2.254 |  2.61 | 3.06 | 3.636 | 5.148 |
+---------+-------+-------+-------+------+-------+-------+-------+-------+------+-------+-------+

# Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=3)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
======================================================
+-------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |  Diff  |
+-------+--------+--------+--------+--------+--------+
|   1   | 0.011  | 0.017  |  0.02  | 0.028  | 0.017  |
|       | 1.591  |  2.43  | 2.761  | 3.556  | 5.125  |
|   2   | 0.006  | 0.009  | 0.014  | 0.019  | 0.013  |
|       | 0.898  | 1.295  | 2.098  |  2.88  |  6.09  |
|   3   | 0.006  | 0.009  | 0.011  | 0.016  |  0.01  |
|       | 0.876  | 1.491  | 1.839  | 2.643  | 4.418  |
|   4   | 0.008  | 0.009  |  0.01  | 0.012  | 0.004  |
|       | 1.389  | 1.637  | 1.916  | 2.019  | 1.351  |
|  Diff | -0.003 | -0.008 | -0.009 | -0.016 | -0.012 |
|       | -0.871 | -2.214 | -2.66  | -3.303 | -3.088 |
+-------+--------+--------+--------+--------+--------+
======================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
======================================================
+-------+--------+--------+--------+--------+--------+
| Group |   1    |   2    |   3    |   4    |  Diff  |
+-------+--------+--------+--------+--------+--------+
|   1   | 0.011  | 0.017  |  0.02  | 0.028  | 0.017  |
|       | 1.591  |  2.43  | 2.761  | 3.556  | 5.125  |
| alpha | 0.008  | 0.014  | 0.018  | 0.028  | 0.019  |
|       | 1.058  | 1.833  | 2.325  | 3.006  | 5.448  |
|   2   | 0.006  | 0.009  | 0.014  | 0.019  | 0.013  |
|       | 0.898  | 1.295  | 2.098  |  2.88  |  6.09  |
| alpha | 0.004  | 0.008  | 0.014  | 0.019  | 0.015  |
|       | 0.581  | 1.046  | 1.901  | 2.678  | 8.767  |
|   3   | 0.006  | 0.009  | 0.011  | 0.016  |  0.01  |
|       | 0.876  | 1.491  | 1.839  | 2.643  | 4.418  |
| alpha | 0.004  | 0.008  | 0.011  | 0.017  | 0.013  |
|       | 0.638  | 1.257  |  1.72  | 2.397  | 5.888  |
|   4   | 0.008  | 0.009  |  0.01  | 0.012  | 0.004  |
|       | 1.389  | 1.637  | 1.916  | 2.019  | 1.351  |
| alpha | 0.007  | 0.009  | 0.011  | 0.013  | 0.005  |
|       | 1.127  |  1.37  | 1.783  | 1.836  | 1.338  |
|  Diff | -0.003 | -0.008 | -0.009 | -0.016 | -0.012 |
|       | -0.871 | -2.214 | -2.66  | -3.303 | -3.088 |
| alpha | -0.001 | -0.005 | -0.007 | -0.015 | -0.014 |
|       | -0.221 | -1.295 | -2.076 | -3.332 |  -3.3  |
+-------+--------+--------+--------+--------+--------+
======================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=3)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
=========================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | liquidity_monthly1 | liquidity_monthly2 | liquidity_monthly3 | liquidity_monthly4 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.016        |        0.02        |       0.023        |       0.033        | 0.017  |
|          |        2.34        |       2.849        |       3.245        |       3.669        | 3.395  |
| Msmvttl2 |       0.007        |       0.011        |       0.015        |        0.02        | 0.012  |
|          |        1.08        |       1.657        |       2.211        |       2.972        | 6.519  |
| Msmvttl3 |       0.006        |       0.009        |       0.011        |       0.015        | 0.009  |
|          |       0.891        |       1.359        |        1.74        |       2.438        | 4.372  |
| Msmvttl4 |       0.006        |       0.009        |       0.009        |        0.01        | 0.004  |
|          |       1.123        |       1.528        |       1.545        |       1.867        | 1.954  |
|   Diff   |       -0.01        |       -0.012       |       -0.014       |       -0.023       | -0.013 |
|          |       -2.632       |       -3.118       |       -3.94        |       -3.842       | -2.543 |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
=========================================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
=========================================================================================================
+----------+--------------------+--------------------+--------------------+--------------------+--------+
|  Group   | liquidity_monthly1 | liquidity_monthly2 | liquidity_monthly3 | liquidity_monthly4 |  Diff  |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
| Msmvttl1 |       0.016        |        0.02        |       0.023        |       0.033        | 0.017  |
|          |        2.34        |       2.849        |       3.245        |       3.669        | 3.395  |
|  alpha   |       0.014        |       0.019        |       0.022        |       0.033        |  0.02  |
|          |        1.78        |       2.364        |       2.831        |       2.978        | 3.475  |
| Msmvttl2 |       0.007        |       0.011        |       0.015        |        0.02        | 0.012  |
|          |        1.08        |       1.657        |       2.211        |       2.972        | 6.519  |
|  alpha   |       0.006        |        0.01        |       0.015        |        0.02        | 0.014  |
|          |       0.774        |       1.422        |       2.062        |       2.766        | 8.405  |
| Msmvttl3 |       0.006        |       0.009        |       0.011        |       0.015        | 0.009  |
|          |       0.891        |       1.359        |        1.74        |       2.438        | 4.372  |
|  alpha   |       0.004        |       0.008        |       0.011        |       0.015        | 0.011  |
|          |       0.649        |       1.104        |       1.604        |        2.25        | 6.684  |
| Msmvttl4 |       0.006        |       0.009        |       0.009        |        0.01        | 0.004  |
|          |       1.123        |       1.528        |       1.545        |       1.867        | 1.954  |
|  alpha   |       0.006        |       0.008        |       0.008        |       0.011        | 0.005  |
|          |       0.944        |       1.226        |       1.255        |       1.676        | 2.097  |
|   Diff   |       -0.01        |       -0.012       |       -0.014       |       -0.023       | -0.013 |
|          |       -2.632       |       -3.118       |       -3.94        |       -3.842       | -2.543 |
|  alpha   |       -0.007       |       -0.011       |       -0.013       |       -0.023       | -0.015 |
|          |       -1.668       |       -2.359       |       -2.76        |       -3.655       | -2.894 |
+----------+--------------------+--------------------+--------------------+--------------------+--------+
```



### Skewness Factor

In Markowitz's (1952) mean-variance paradigm, only mean and variance are considered by investor for form a portfolio, and from the paradigm CAPM is developed. Skewness, the third moment, of return is introduced by Arditti (1967, 1971), who shows that investors demand a higher rate of return on investments whose return distributions are negatively skewed. Scott and Horvath (1980) extend the analysis to include other higher moments of return.  

Harvey and Siddique (2000) introduce systematic skewness into the pricing of securities and therefore divide the total skewness into systematic skewness (aka co-skewness) and idiosyncratic skewness. It is often found that co-skewness is negatively correlated with stocks' future return and idiosyncratic skewness is diversified which is challenged by some literatures (Kane, 1982; Barberis and Huang, 2008). 

Total Skewness is defined as
$$
Skew_i=\frac{\frac 1n\sum_{t=1}^n(R_{i,t}-\bar R_i)^3}{(\frac 1n\sum_{t=1}^n(R_{i,t}-\bar R_i)^2)^{\frac 32}}.
$$
Coskewness (Systematic skewness) is defined as (Harvey and Siddique, 2000)
$$
r_{i,t}=\alpha_i+\beta_{MKT, i}MKT_t+Coskew_iMKT_t^2+\epsilon_{i,t}.
$$
Idiosyncratic skewness is defined as 
$$
IdioSkew_i=\frac{\frac 1n\sum_{t=1}^n(\epsilon_{i,t}-\bar \epsilon_i)^3}{(\frac 1n\sum_{t=1}^n(\epsilon_{i,t}-\bar \epsilon_i)^2)^{\frac 32}},
$$
where the residuals are from the regression model
$$
r_{i,t}=\alpha_i+\beta_{MKT, i}MKT_t+\beta_{SMB,i}SMB_t+\beta_{HML,i}HML_t+\epsilon_{i,t}.
$$
The calculation period is 12 months. In this demo, the dataset starts from Jan, 2000 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% set system path
import sys,os

sys.path.append(os.path.abspath(".."))

# %% import data
import pandas as pd

month_return = pd.read_hdf('.\\data\\month_return.h5', key='month_return')
company_data = pd.read_hdf('.\\data\\last_filter_pe.h5', key='data')
trade_data = pd.read_hdf('.\\data\\mean_filter_trade.h5', key='data')
beta = pd.read_hdf('.\\data\\beta.h5', key='data')
risk_premium = pd.read_hdf('.\\data\\risk_premium.h5', key='data')
```

Data preprocessing

```python
# %% data preprocessing
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)

# merge data
data = month_return[['Stkcd', 'Trdmnt', 'Mretwd']]
data['Date_merge'] = pd.to_datetime(data['Trdmnt'])
risk_premium['Date_merge'] = risk_premium.index
data = pd.merge(data, risk_premium[['MKT', 'SMB', 'HML', 'Date_merge']], on=['Date_merge']).dropna()
```

Construct proxy variable

```python
# %% construct proxy variable
import numpy as np
import statsmodels.api as sm
from scipy.stats import skew

skewness = pd.Series(index=data.index, dtype=float, name='skewness')
coskewness = pd.Series(index=data.index, dtype=float, name='coskewness')
idioskewness = pd.Series(index=data.index, dtype=float, name='idioskewness')
for i in data.groupby('Stkcd'):
    row, col = np.shape(i[1])
    for j in range(row-12):
        skewness.loc[i[1].index[j+11]] = skew(i[1].iloc[j:j+12, 2])

        endog = np.array([i[1].iloc[j:j+12, 4], i[1].iloc[j:j+12, 4]**2]).T
        model_coskew = sm.OLS(i[1].iloc[j:j+12, 2], sm.add_constant(endog)).fit()
        coskewness.loc[i[1].index[j+11]] = model_coskew.params[2]
        
        model_idioskew = sm.OLS(i[1].iloc[j:j+12, 2], sm.add_constant(i[1].iloc[j:j+12, 4:7])).fit()
        idioskewness.loc[i[1].index[j+11]] = skew(model_idioskew.resid)

return_company = pd.concat([data, skewness, coskewness, idioskewness, month_return[['cap', 'Msmvttl', 'Ndaytrd', 'emrwd']]], axis=1)
```

Total Skewness. The result from dataset #1 is inconsistent with literatures that in univariate analysis though the differenced return is significant since the absolute t-value is greater than 2.3, but the order of return sequence show no consistency.  

In bivariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, suggesting that total skewness factor provides no excess return. The factor adjustment tends to **weaken the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 1
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'skewness', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'skewness', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()

=====================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+
| Average | 0.008 | 0.008 | 0.007 | 0.009 | 0.007 | 0.009 | 0.009 | 0.009 | 0.008 | 0.011 | 0.003 |
|  T-Test | 8.576 | 8.419 | 7.786 | 9.093 | 7.652 | 9.199 | 9.362 | 8.877 | 8.584 |  10.6 | 2.362 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+-------+

# Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
====================================================================
+-------+---------+---------+---------+---------+---------+--------+
| Group |    1    |    2    |    3    |    4    |    5    |  Diff  |
+-------+---------+---------+---------+---------+---------+--------+
|   1   |  0.024  |  0.022  |  0.021  |  0.023  |  0.025  | 0.001  |
|       |  14.565 |  13.84  |  13.484 |  14.584 |  14.149 | 0.323  |
|   2   |  0.008  |  0.013  |   0.01  |  0.012  |  0.012  | 0.004  |
|       |  5.627  |  9.234  |  6.737  |  8.375  |  7.731  | 1.911  |
|   3   |  0.007  |  0.006  |  0.007  |  0.009  |  0.008  |  0.0   |
|       |  4.488  |  4.209  |  4.475  |  6.156  |  5.395  | 0.111  |
|   4   |  0.004  |  0.006  |  0.006  |  0.004  |  0.006  | 0.001  |
|       |  2.697  |  3.714  |  3.905  |  2.497  |   3.58  | 0.535  |
|   5   |  -0.003 |  -0.004 |  -0.003 |  -0.003 |  -0.002 |  0.0   |
|       |  -1.843 |  -2.713 |  -1.823 |  -2.029 |  -1.567 | 0.228  |
|  Diff |  -0.027 |  -0.026 |  -0.024 |  -0.026 |  -0.027 |  -0.0  |
|       | -11.849 | -11.725 | -10.724 | -11.715 | -12.268 | -0.094 |
+-------+---------+---------+---------+---------+---------+--------+
====================================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
===================================================================
+-------+---------+---------+--------+---------+---------+--------+
| Group |    1    |    2    |   3    |    4    |    5    |  Diff  |
+-------+---------+---------+--------+---------+---------+--------+
|   1   |  0.026  |  0.023  | 0.022  |  0.026  |  0.026  |  0.0   |
|       |  12.803 |  14.141 | 13.638 |  16.104 |  15.155 | 0.183  |
| alpha |  0.026  |  0.023  | 0.022  |  0.025  |  0.026  |  0.0   |
|       |  10.87  |  10.593 | 10.481 |  11.664 |  11.215 | 0.099  |
|   2   |   0.01  |  0.013  | 0.011  |  0.012  |  0.013  | 0.003  |
|       |  6.505  |  9.595  | 6.935  |  8.557  |  8.474  |  1.51  |
| alpha |   0.01  |  0.013  | 0.011  |  0.012  |  0.013  | 0.003  |
|       |  5.658  |  8.328  |  6.28  |  8.797  |  7.819  | 1.078  |
|   3   |  0.008  |  0.007  | 0.007  |   0.01  |  0.008  |  0.0   |
|       |  4.625  |  4.855  | 4.591  |  6.799  |  5.666  | 0.123  |
| alpha |  0.007  |  0.007  | 0.007  |  0.009  |  0.008  | 0.001  |
|       |  4.946  |   4.67  | 6.211  |  5.793  |  6.825  | 0.448  |
|   4   |  0.004  |  0.006  | 0.007  |  0.003  |  0.005  | 0.001  |
|       |  2.596  |  4.007  | 4.413  |  2.268  |  3.239  | 0.413  |
| alpha |  0.004  |  0.007  | 0.007  |  0.004  |  0.006  | 0.002  |
|       |  2.351  |  4.104  | 3.081  |   2.18  |  3.105  | 0.781  |
|   5   |  -0.003 |  -0.005 | -0.003 |  -0.003 |  -0.003 |  0.0   |
|       |  -1.882 |  -3.172 | -1.897 |  -2.287 |  -2.015 | 0.007  |
| alpha |  -0.003 |  -0.005 | -0.003 |  -0.004 |  -0.003 |  -0.0  |
|       |  -1.799 |  -2.836 | -1.467 |  -3.032 |  -1.838 | -0.008 |
|  Diff |  -0.029 |  -0.028 | -0.025 |  -0.029 |  -0.029 |  -0.0  |
|       | -11.138 | -12.246 | -10.82 | -13.018 | -13.407 | -0.142 |
| alpha |  -0.029 |  -0.028 | -0.025 |  -0.029 |  -0.029 |  -0.0  |
|       | -10.215 | -10.218 | -7.54  | -12.935 |  -9.892 | -0.111 |
+-------+---------+---------+--------+---------+---------+--------+
===================================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
=================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+--------+
|  Group   | skewness1 | skewness2 | skewness3 | skewness4 | skewness5 |  Diff  |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
| Msmvttl1 |   0.025   |   0.022   |   0.025   |   0.024   |   0.027   | 0.002  |
|          |   13.883  |   14.068  |   14.984  |   15.097  |   15.046  | 0.781  |
| Msmvttl2 |    0.01   |   0.014   |    0.01   |    0.01   |   0.014   | 0.004  |
|          |   6.404   |   10.045  |   6.751   |   7.626   |   9.445   | 2.245  |
| Msmvttl3 |   0.007   |   0.007   |   0.007   |    0.01   |   0.008   | 0.001  |
|          |   4.608   |   5.092   |    4.79   |   6.592   |   5.893   | 0.282  |
| Msmvttl4 |   0.004   |   0.005   |   0.008   |   0.005   |   0.006   | 0.001  |
|          |    2.63   |   3.031   |   4.702   |   2.846   |   3.566   | 0.488  |
| Msmvttl5 |   -0.003  |   -0.004  |   -0.004  |   -0.003  |   -0.004  | -0.001 |
|          |   -1.963  |   -2.304  |   -2.524  |   -1.95   |   -2.531  | -0.338 |
|   Diff   |   -0.028  |   -0.026  |   -0.029  |   -0.027  |   -0.031  | -0.003 |
|          |  -11.528  |  -11.245  |   -13.18  |   -12.68  |  -13.898  | -0.829 |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
=================================================================================

# Risk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
=================================================================================
+----------+-----------+-----------+-----------+-----------+-----------+--------+
|  Group   | skewness1 | skewness2 | skewness3 | skewness4 | skewness5 |  Diff  |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
| Msmvttl1 |   0.025   |   0.022   |   0.025   |   0.024   |   0.027   | 0.002  |
|          |   13.883  |   14.068  |   14.984  |   15.097  |   15.046  | 0.781  |
|  alpha   |   0.025   |   0.022   |   0.026   |   0.024   |   0.027   | 0.001  |
|          |   11.528  |   11.107  |   11.127  |   10.555  |   11.258  | 0.502  |
| Msmvttl2 |    0.01   |   0.014   |    0.01   |    0.01   |   0.014   | 0.004  |
|          |   6.404   |   10.045  |   6.751   |   7.626   |   9.445   | 2.245  |
|  alpha   |    0.01   |   0.013   |    0.01   |    0.01   |   0.014   | 0.004  |
|          |   5.098   |   9.066   |   5.474   |   6.922   |   8.522   | 1.442  |
| Msmvttl3 |   0.007   |   0.007   |   0.007   |    0.01   |   0.008   | 0.001  |
|          |   4.608   |   5.092   |    4.79   |   6.592   |   5.893   | 0.282  |
|  alpha   |   0.007   |   0.007   |   0.008   |   0.009   |   0.008   | 0.001  |
|          |   5.135   |   4.941   |   8.396   |   6.303   |   6.523   | 0.485  |
| Msmvttl4 |   0.004   |   0.005   |   0.008   |   0.005   |   0.006   | 0.001  |
|          |    2.63   |   3.031   |   4.702   |   2.846   |   3.566   | 0.488  |
|  alpha   |   0.004   |   0.005   |   0.008   |   0.005   |   0.006   | 0.002  |
|          |   2.421   |   3.472   |   3.252   |   2.208   |   3.591   | 0.862  |
| Msmvttl5 |   -0.003  |   -0.004  |   -0.004  |   -0.003  |   -0.004  | -0.001 |
|          |   -1.963  |   -2.304  |   -2.524  |   -1.95   |   -2.531  | -0.338 |
|  alpha   |   -0.003  |   -0.004  |   -0.003  |   -0.004  |   -0.003  |  -0.0  |
|          |   -2.13   |   -2.176  |   -2.126  |   -2.867  |   -2.394  | -0.216 |
|   Diff   |   -0.028  |   -0.026  |   -0.029  |   -0.027  |   -0.031  | -0.003 |
|          |  -11.528  |  -11.245  |   -13.18  |   -12.68  |  -13.898  | -0.829 |
|  alpha   |   -0.028  |   -0.025  |   -0.029  |   -0.028  |   -0.03   | -0.002 |
|          |  -10.231  |   -9.896  |   -9.87   |  -11.904  |  -10.194  | -0.604 |
+----------+-----------+-----------+-----------+-----------+-----------+--------+
```

Co-skewness. The result from dataset #2 is inconsistent with literatures that in univariate analysis though the differenced return is significant since the absolute t-value is greater than 2.3, but the order of return sequence show no consistency.  

In bivariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, suggesting that co-skewness factor provides no excess return. The factor adjustment tends to **weaken the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'coskewness', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2000-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'coskewness', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()

=====================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+--------+-------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9    |   10  |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+--------+-------+-------+
| Average | 0.008 | 0.009 | 0.007 |  0.01 | 0.007 | 0.009 | 0.009 | 0.008 | 0.009  | 0.011 | 0.003 |
|  T-Test | 8.241 | 9.001 | 7.365 | 9.666 | 7.632 | 9.234 | 9.014 | 8.691 | 10.114 | 11.73 | 2.595 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+--------+-------+-------+

# Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
==================================================================
+-------+---------+---------+--------+--------+---------+--------+
| Group |    1    |    2    |   3    |   4    |    5    |  Diff  |
+-------+---------+---------+--------+--------+---------+--------+
|   1   |  0.022  |  0.022  | 0.023  | 0.022  |  0.025  | 0.003  |
|       |  14.748 |  13.599 | 15.127 | 13.191 |  13.98  | 1.465  |
|   2   |  0.009  |  0.012  | 0.009  | 0.011  |  0.013  | 0.004  |
|       |  6.551  |  8.696  | 5.983  | 7.881  |  9.526  | 1.958  |
|   3   |  0.007  |  0.008  | 0.007  | 0.008  |  0.006  | -0.001 |
|       |  4.559  |  4.966  | 4.612  | 5.373  |  4.528  | -0.26  |
|   4   |  0.006  |  0.005  | 0.004  | 0.005  |  0.006  |  0.0   |
|       |  3.778  |  2.985  | 2.629  | 3.513  |  3.853  |  0.02  |
|   5   |  -0.002 |  -0.004 | -0.002 | -0.004 |  -0.002 |  0.0   |
|       |  -1.129 |  -2.603 | -1.222 | -2.493 |  -1.143 | 0.011  |
|  Diff |  -0.024 |  -0.026 | -0.025 | -0.026 |  -0.027 | -0.003 |
|       | -11.291 | -11.861 | -11.57 | -11.34 | -11.015 | -1.08  |
+-------+---------+---------+--------+--------+---------+--------+
==================================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
==================================================================
+-------+---------+---------+--------+--------+---------+--------+
| Group |    1    |    2    |   3    |   4    |    5    |  Diff  |
+-------+---------+---------+--------+--------+---------+--------+
|   1   |  0.022  |  0.022  | 0.023  | 0.022  |  0.025  | 0.003  |
|       |  14.748 |  13.599 | 15.127 | 13.191 |  13.98  | 1.465  |
| alpha |  0.022  |  0.022  | 0.023  | 0.022  |  0.026  | 0.003  |
|       |  11.225 |  11.137 | 10.08  | 9.801  |  9.568  | 1.311  |
|   2   |  0.009  |  0.012  | 0.009  | 0.011  |  0.013  | 0.004  |
|       |  6.551  |  8.696  | 5.983  | 7.881  |  9.526  | 1.958  |
| alpha |   0.01  |  0.012  | 0.009  |  0.01  |  0.013  | 0.003  |
|       |  7.241  |  8.351  | 5.363  | 8.371  |  8.967  |  1.73  |
|   3   |  0.007  |  0.008  | 0.007  | 0.008  |  0.006  | -0.001 |
|       |  4.559  |  4.966  | 4.612  | 5.373  |  4.528  | -0.26  |
| alpha |  0.008  |  0.007  | 0.006  | 0.007  |  0.007  | -0.001 |
|       |  4.378  |  5.254  | 4.569  | 4.778  |  3.691  | -0.335 |
|   4   |  0.006  |  0.005  | 0.004  | 0.005  |  0.006  |  0.0   |
|       |  3.778  |  2.985  | 2.629  | 3.513  |  3.853  |  0.02  |
| alpha |  0.007  |  0.005  | 0.004  | 0.004  |  0.007  | 0.001  |
|       |   3.74  |  2.782  | 2.635  | 3.258  |  3.772  | 0.382  |
|   5   |  -0.002 |  -0.004 | -0.002 | -0.004 |  -0.002 |  0.0   |
|       |  -1.129 |  -2.603 | -1.222 | -2.493 |  -1.143 | 0.011  |
| alpha |  -0.001 |  -0.004 | -0.002 | -0.005 |  -0.001 |  0.0   |
|       |  -0.81  |  -2.895 | -1.374 | -2.329 |  -0.753 | 0.099  |
|  Diff |  -0.024 |  -0.026 | -0.025 | -0.026 |  -0.027 | -0.003 |
|       | -11.291 | -11.861 | -11.57 | -11.34 | -11.015 | -1.08  |
| alpha |  -0.023 |  -0.026 | -0.025 | -0.027 |  -0.027 | -0.003 |
|       |  -8.296 | -11.797 | -8.175 | -9.631 |  -8.631 | -1.096 |
+-------+---------+---------+--------+--------+---------+--------+
==================================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
===========================================================================================
+----------+-------------+-------------+-------------+-------------+-------------+--------+
|  Group   | coskewness1 | coskewness2 | coskewness3 | coskewness4 | coskewness5 |  Diff  |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
| Msmvttl1 |    0.022    |    0.023    |    0.023    |    0.021    |    0.026    | 0.004  |
|          |    15.027   |    14.737   |    13.893   |    12.808   |    13.624   | 1.668  |
| Msmvttl2 |     0.01    |    0.012    |    0.009    |    0.011    |    0.013    | 0.003  |
|          |     6.71    |    8.817    |    5.996    |    7.893    |    9.698    | 1.662  |
| Msmvttl3 |    0.008    |    0.007    |    0.006    |    0.008    |    0.007    | -0.001 |
|          |    5.212    |    4.467    |    4.333    |    5.813    |    4.943    | -0.455 |
| Msmvttl4 |    0.007    |    0.004    |    0.003    |    0.006    |    0.007    |  -0.0  |
|          |    3.996    |    2.765    |     1.95    |    3.507    |    4.153    | -0.066 |
| Msmvttl5 |    -0.003   |    -0.004   |    -0.002   |    -0.004   |    -0.002   | 0.001  |
|          |    -1.756   |    -2.163   |    -1.366   |    -3.015   |    -1.135   | 0.516  |
|   Diff   |    -0.024   |    -0.027   |    -0.025   |    -0.026   |    -0.027   | -0.003 |
|          |   -11.754   |   -12.865   |   -11.688   |   -11.242   |    -11.09   | -0.938 |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
===========================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
===========================================================================================
+----------+-------------+-------------+-------------+-------------+-------------+--------+
|  Group   | coskewness1 | coskewness2 | coskewness3 | coskewness4 | coskewness5 |  Diff  |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
| Msmvttl1 |    0.022    |    0.023    |    0.023    |    0.021    |    0.026    | 0.004  |
|          |    15.027   |    14.737   |    13.893   |    12.808   |    13.624   | 1.668  |
|  alpha   |    0.022    |    0.023    |    0.023    |    0.021    |    0.026    | 0.004  |
|          |    11.154   |    11.054   |    11.059   |    9.445    |    9.471    | 1.442  |
| Msmvttl2 |     0.01    |    0.012    |    0.009    |    0.011    |    0.013    | 0.003  |
|          |     6.71    |    8.817    |    5.996    |    7.893    |    9.698    | 1.662  |
|  alpha   |     0.01    |    0.011    |    0.009    |     0.01    |    0.013    | 0.003  |
|          |    6.977    |    9.706    |    5.931    |    6.934    |    9.711    | 1.632  |
| Msmvttl3 |    0.008    |    0.007    |    0.006    |    0.008    |    0.007    | -0.001 |
|          |    5.212    |    4.467    |    4.333    |    5.813    |    4.943    | -0.455 |
|  alpha   |    0.008    |    0.006    |    0.006    |    0.008    |    0.007    | -0.001 |
|          |    5.329    |    4.418    |    3.825    |    5.402    |    4.479    | -0.545 |
| Msmvttl4 |    0.007    |    0.004    |    0.003    |    0.006    |    0.007    |  -0.0  |
|          |    3.996    |    2.765    |     1.95    |    3.507    |    4.153    | -0.066 |
|  alpha   |    0.007    |    0.004    |    0.003    |    0.005    |    0.008    | 0.001  |
|          |    4.072    |    2.478    |    2.034    |    2.543    |    4.116    | 0.344  |
| Msmvttl5 |    -0.003   |    -0.004   |    -0.002   |    -0.004   |    -0.002   | 0.001  |
|          |    -1.756   |    -2.163   |    -1.366   |    -3.015   |    -1.135   | 0.516  |
|  alpha   |    -0.002   |    -0.004   |    -0.003   |    -0.005   |    -0.001   | 0.001  |
|          |    -1.32    |    -2.634   |    -1.364   |    -2.641   |    -0.87    | 0.343  |
|   Diff   |    -0.024   |    -0.027   |    -0.025   |    -0.026   |    -0.027   | -0.003 |
|          |   -11.754   |   -12.865   |   -11.688   |   -11.242   |    -11.09   | -0.938 |
|  alpha   |    -0.024   |    -0.027   |    -0.026   |    -0.026   |    -0.027   | -0.003 |
|          |    -8.363   |   -11.398   |    -8.568   |    -9.063   |    -9.138   | -1.054 |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
```

Idiosyncratic skewness. The result from dataset #3 is consistent with literatures that in univariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3.  

In bivariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, suggesting that idiosyncratic skewness factor provides no excess return. The factor adjustment tends to **weaken the portfolio excess return**; while the dependent-sort bivariate tends to **strengthen the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 3
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_3 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_3 = test_data_3[['emrwd', 'Msmvttl', 'idioskewness', 'Date_merge']].dropna()
test_data_3 = test_data_3[(test_data_3['Date_merge'] >= '2000-01-01') & (test_data_3['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_3 = Univariate(np.array(test_data_3[['emrwd', 'idioskewness', 'Date_merge']]), number=9)
uni_3.summary_and_test()
uni_3.print_summary_by_time()
uni_3.print_summary()
=====================================================================
+---------+--------+-------+-------+-------+-------+--------+-------+-------+-------+-------+-------+
|  Group  |   1    |   2   |   3   |   4   |   5   |   6    |   7   |   8   |   9   |   10  |  Diff |
+---------+--------+-------+-------+-------+-------+--------+-------+-------+-------+-------+-------+
| Average |  0.01  | 0.008 | 0.008 | 0.009 | 0.009 | 0.011  | 0.006 | 0.009 | 0.008 |  0.01 | 0.001 |
|  T-Test | 10.385 | 7.249 | 8.548 | 9.025 | 8.954 | 11.601 | 6.609 | 9.145 | 7.674 | 9.964 |  0.43 |
+---------+--------+-------+-------+-------+-------+--------+-------+-------+-------+-------+-------+

# Bivariate analysis
bi_3 = Bivariate(np.array(test_data_3), number=4)
bi_3.average_by_time()
bi_3.summary_and_test()
bi_3.print_summary_by_time()
bi_3.print_summary()
=====================================================================
+-------+---------+---------+---------+---------+---------+--------+
| Group |    1    |    2    |    3    |    4    |    5    |  Diff  |
+-------+---------+---------+---------+---------+---------+--------+
|   1   |  0.023  |  0.021  |  0.026  |   0.02  |  0.026  | 0.003  |
|       |  12.798 |  13.936 |  15.498 |  13.077 |  13.947 |  1.32  |
|   2   |  0.012  |  0.011  |  0.012  |   0.01  |   0.01  | -0.002 |
|       |  7.916  |  7.402  |  8.251  |  7.194  |  6.609  | -1.04  |
|   3   |  0.008  |  0.009  |  0.008  |  0.004  |  0.008  |  -0.0  |
|       |  5.345  |  6.356  |  4.972  |  2.965  |  5.339  | -0.032 |
|   4   |  0.005  |  0.003  |  0.006  |  0.007  |  0.005  |  0.0   |
|       |  3.067  |  2.279  |  3.414  |  4.156  |  3.488  | 0.205  |
|   5   |  -0.003 |  -0.002 |  -0.002 |  -0.003 |  -0.003 |  -0.0  |
|       |  -2.029 |  -1.535 |  -1.256 |  -1.865 |  -2.183 | -0.138 |
|  Diff |  -0.026 |  -0.023 |  -0.028 |  -0.023 |  -0.029 | -0.003 |
|       | -10.992 | -10.301 | -12.114 | -10.841 | -12.072 | -1.123 |
+-------+---------+---------+---------+---------+---------+--------+

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model['2000':'2019']
bi_3.factor_adjustment(risk_model)
bi_3.print_summary()
====================================================================
+-------+---------+---------+---------+---------+---------+--------+
| Group |    1    |    2    |    3    |    4    |    5    |  Diff  |
+-------+---------+---------+---------+---------+---------+--------+
|   1   |  0.023  |  0.021  |  0.026  |   0.02  |  0.026  | 0.003  |
|       |  12.798 |  13.936 |  15.498 |  13.077 |  13.947 |  1.32  |
| alpha |  0.023  |   0.02  |  0.026  |   0.02  |  0.026  | 0.003  |
|       |  9.487  |  13.54  |  12.17  |  10.378 |   8.92  | 1.256  |
|   2   |  0.012  |  0.011  |  0.012  |   0.01  |   0.01  | -0.002 |
|       |  7.916  |  7.402  |  8.251  |  7.194  |  6.609  | -1.04  |
| alpha |  0.012  |  0.011  |  0.012  |  0.011  |  0.009  | -0.002 |
|       |  7.981  |  6.271  |  7.674  |  5.908  |  6.248  | -1.234 |
|   3   |  0.008  |  0.009  |  0.008  |  0.004  |  0.008  |  -0.0  |
|       |  5.345  |  6.356  |  4.972  |  2.965  |  5.339  | -0.032 |
| alpha |  0.008  |  0.009  |  0.007  |  0.005  |  0.007  | -0.001 |
|       |   4.75  |  6.149  |  4.293  |  3.236  |  5.673  | -0.338 |
|   4   |  0.005  |  0.003  |  0.006  |  0.007  |  0.005  |  0.0   |
|       |  3.067  |  2.279  |  3.414  |  4.156  |  3.488  | 0.205  |
| alpha |  0.005  |  0.004  |  0.006  |  0.006  |  0.006  | 0.001  |
|       |  2.598  |   2.4   |  3.689  |  2.833  |  4.091  | 0.538  |
|   5   |  -0.003 |  -0.002 |  -0.002 |  -0.003 |  -0.003 |  -0.0  |
|       |  -2.029 |  -1.535 |  -1.256 |  -1.865 |  -2.183 | -0.138 |
| alpha |  -0.004 |  -0.002 |  -0.002 |  -0.003 |  -0.003 |  0.0   |
|       |  -2.699 |  -1.615 |  -1.436 |  -1.45  |  -2.196 | 0.156  |
|  Diff |  -0.026 |  -0.023 |  -0.028 |  -0.023 |  -0.029 | -0.003 |
|       | -10.992 | -10.301 | -12.114 | -10.841 | -12.072 | -1.123 |
| alpha |  -0.027 |  -0.023 |  -0.028 |  -0.023 |  -0.029 | -0.002 |
|       |  -9.37  |  -9.835 | -11.551 |  -8.126 |  -7.987 | -0.823 |
+-------+---------+---------+---------+---------+---------+--------+
====================================================================

# Dependent-sort Bivariate Analysis
bi_3_de = Bivariate(test_data_3, number=4)
bi_3_de.fit(conditional=True)
bi_3_de.print_summary()
=====================================================================================================
+----------+---------------+---------------+---------------+---------------+---------------+--------+
|  Group   | idioskewness1 | idioskewness2 | idioskewness3 | idioskewness4 | idioskewness5 |  Diff  |
+----------+---------------+---------------+---------------+---------------+---------------+--------+
| Msmvttl1 |     0.023     |     0.021     |     0.026     |     0.019     |     0.026     | 0.004  |
|          |     13.228    |     14.232    |     14.596    |     12.032    |     14.168    | 1.486  |
| Msmvttl2 |     0.012     |     0.011     |     0.012     |      0.01     |      0.01     | -0.002 |
|          |      7.92     |     7.591     |     7.947     |     7.268     |     6.951     | -0.896 |
| Msmvttl3 |     0.008     |     0.009     |     0.006     |     0.005     |     0.008     |  0.0   |
|          |     5.183     |     6.701     |     4.315     |     3.307     |     5.637     | 0.055  |
| Msmvttl4 |     0.005     |     0.004     |     0.005     |     0.007     |     0.005     |  0.0   |
|          |     3.264     |     2.821     |      2.84     |      4.52     |     3.486     | 0.092  |
| Msmvttl5 |     -0.004    |     -0.002    |     -0.002    |     -0.002    |     -0.003    |  0.0   |
|          |     -2.556    |     -1.531    |     -1.645    |     -1.667    |     -2.262    | 0.075  |
|   Diff   |     -0.026    |     -0.024    |     -0.028    |     -0.022    |     -0.03     | -0.003 |
|          |    -11.797    |     -10.66    |     -11.94    |    -10.141    |    -12.317    | -1.116 |
+----------+---------------+---------------+---------------+---------------+---------------+--------+
=====================================================================================================

# Risk Adjustment
bi_3_de.factor_adjustment(risk_model)
bi_3_de.print_summary()
=====================================================================================================
+----------+---------------+---------------+---------------+---------------+---------------+--------+
|  Group   | idioskewness1 | idioskewness2 | idioskewness3 | idioskewness4 | idioskewness5 |  Diff  |
+----------+---------------+---------------+---------------+---------------+---------------+--------+
| Msmvttl1 |     0.023     |     0.021     |     0.026     |     0.019     |     0.026     | 0.004  |
|          |     13.228    |     14.232    |     14.596    |     12.032    |     14.168    | 1.486  |
|  alpha   |     0.023     |     0.021     |     0.026     |     0.019     |     0.026     | 0.003  |
|          |      9.05     |     13.313    |     13.045    |     8.722     |      9.87     | 1.563  |
| Msmvttl2 |     0.012     |     0.011     |     0.012     |      0.01     |      0.01     | -0.002 |
|          |      7.92     |     7.591     |     7.947     |     7.268     |     6.951     | -0.896 |
|  alpha   |     0.011     |     0.011     |     0.011     |     0.011     |      0.01     | -0.002 |
|          |     8.045     |     6.556     |     8.285     |     6.954     |     6.793     | -0.934 |
| Msmvttl3 |     0.008     |     0.009     |     0.006     |     0.005     |     0.008     |  0.0   |
|          |     5.183     |     6.701     |     4.315     |     3.307     |     5.637     | 0.055  |
|  alpha   |     0.008     |     0.009     |     0.006     |     0.005     |     0.007     | -0.001 |
|          |     4.697     |     6.736     |     3.358     |     3.378     |     6.268     | -0.348 |
| Msmvttl4 |     0.005     |     0.004     |     0.005     |     0.007     |     0.005     |  0.0   |
|          |     3.264     |     2.821     |      2.84     |      4.52     |     3.486     | 0.092  |
|  alpha   |     0.005     |     0.005     |     0.005     |     0.006     |     0.006     | 0.001  |
|          |     2.929     |     3.137     |     3.249     |     3.452     |      4.07     | 0.385  |
| Msmvttl5 |     -0.004    |     -0.002    |     -0.002    |     -0.002    |     -0.003    |  0.0   |
|          |     -2.556    |     -1.531    |     -1.645    |     -1.667    |     -2.262    | 0.075  |
|  alpha   |     -0.004    |     -0.002    |     -0.002    |     -0.002    |     -0.004    |  0.0   |
|          |     -2.976    |     -1.67     |     -1.772    |     -1.361    |     -2.424    | 0.225  |
|   Diff   |     -0.026    |     -0.024    |     -0.028    |     -0.022    |     -0.03     | -0.003 |
|          |    -11.797    |     -10.66    |     -11.94    |    -10.141    |    -12.317    | -1.116 |
|  alpha   |     -0.027    |     -0.023    |     -0.029    |     -0.021    |     -0.03     | -0.003 |
|          |     -9.394    |     -9.507    |    -11.812    |     -7.469    |     -8.528    | -0.972 |
+----------+---------------+---------------+---------------+---------------+---------------+--------+
```



### Idiosyncratic Volatility

According to CAPM and APT, investors can create portfolios that have zero exposure to firm specific risk by holding a well-diversified portfolio with a large number of securities. Firm-specific risk, therefore, does not command a risk premium. The empirical implication of this is that measures of firm-specific risk, or risk that is not related to a systematic factor, should exhibit no relation with future stock returns. However, Merton (1987) develop models of market equilibrium that relax CAPM's assumptions, whose main implication is that, in equilibrium, firm-specific risk is priced. Specifically, there is a positive risk premium associated with firm-specific risk.

The most widely cited study of the cross-sectional relation between firm-specific risk and expected stock returns is Ang, Hodrick, Xing, and Zhang (2006), which finds a strong negative cross-sectional relation between idiosyncratic volatility and future stock returns. 

Total volatility is defined as 
$$
Vol_i=100\sqrt {\frac {\sum_{t=1}^n(R_{i,t}-\bar R_i)^2}{n-1}}\sqrt m
$$
Idiosyncratic volatility is defined as
$$
IdioVol_i=100RSE_i\times \sqrt m
$$
whose RSE is
$$
RSE_i=\sqrt {\frac {\sum_{j=1}^n\epsilon_{i,j}^2}{n-k}}
$$
where n is the number of data points and k is the number of parameters estimated by the regression, which is
$$
r_{i,t}=\alpha_i+\beta_{MKT,i}MKT_t+\beta_{SMB,i}SMB_t+\beta_{HML,i}HML_t+\beta_{MOM,i}+\epsilon_{i,t}.
$$
The calculation period is 12 months. In this demo, the dataset starts from Jan, 2000 and is collected from CSMAR dataset. **WARNING: Do Not use dataset in this demo for any commercial purpose.** 

```python
# %% set system path
import sys,os

sys.path.append(os.path.abspath(".."))

# %% import data
import pandas as pd

month_return = pd.read_hdf('.\\data\\month_return.h5', key='month_return')
company_data = pd.read_hdf('.\\data\\last_filter_pe.h5', key='data')
trade_data = pd.read_hdf('.\\data\\mean_filter_trade.h5', key='data')
beta = pd.read_hdf('.\\data\\beta.h5', key='data')
risk_premium = pd.read_hdf('.\\data\\risk_premium.h5', key='data')
```

Data preprocessing

```python
# %% data preprocessing
# forward the monthly return for each stock
# emrwd is the return including dividend
month_return['emrwd'] = month_return.groupby(['Stkcd'])['Mretwd'].shift(-1)
# emrnd is the return including no dividend
month_return['emrnd'] = month_return.groupby(['Stkcd'])['Mretnd'].shift(-1)
# select the A share stock
month_return = month_return[month_return['Markettype'].isin([1, 4, 16])]

# % distinguish the stocks whose size is among the up 30% stocks in each month
def percentile(stocks) :
    return stocks >= stocks.quantile(q=.3)

month_return['cap'] = month_return.groupby(['Trdmnt'])['Msmvttl'].apply(percentile)

# merge data
data = month_return[['Stkcd', 'Trdmnt', 'Mretwd']]
data['Date_merge'] = pd.to_datetime(data['Trdmnt'])
risk_premium['Date_merge'] = risk_premium.index
data = pd.merge(data, risk_premium[['MKT', 'SMB', 'HML', 'Date_merge']], on=['Date_merge']).dropna()
```

Construct proxy variable

```python
# %% construct proxy variable
import numpy as np
import statsmodels.api as sm

volatility = pd.Series(index=data.index, dtype=float, name='volatility')
idiovolatility = pd.Series(index=data.index, dtype=float, name='idiovolatility')
for i in data.groupby('Stkcd'):
    row, col = np.shape(i[1])
    for j in range(row-12):
        volatility.loc[i[1].index[j+11]] = np.std(i[1].iloc[j:j+12, 2])
        
        model_idiovol = sm.OLS(i[1].iloc[j:j+12, 2], sm.add_constant(i[1].iloc[j:j+12, 4:7])).fit()
        idiovolatility.loc[i[1].index[j+11]] = np.std(model_idiovol.resid)

return_company = pd.concat([data, volatility, idiovolatility, month_return[['cap', 'Msmvttl', 'Ndaytrd', 'emrwd']]], axis=1)
```

Dataset #1: Volatility. The result from dataset #1 is inconsistent with literatures that in univariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, and the order of return sequence show no consistency.  

In bivariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, suggesting that total volatility factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 1
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_1 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_1 = test_data_1[['emrwd', 'Msmvttl', 'volatility', 'Date_merge']].dropna()
test_data_1 = test_data_1[(test_data_1['Date_merge'] >= '2000-01-01') & (test_data_1['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_1 = Univariate(np.array(test_data_1[['emrwd', 'volatility', 'Date_merge']]), number=9)
uni_1.summary_and_test()
uni_1.print_summary_by_time()
uni_1.print_summary()
====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7   |   8   |   9   |   10   |  Diff |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+-------+
| Average | 0.009 | 0.009 | 0.008 | 0.009 | 0.008 | 0.009 |  0.01 | 0.008 | 0.009 | 0.011  | 0.002 |
|  T-Test | 8.083 | 8.567 | 8.566 | 8.338 | 8.097 | 9.132 | 9.712 | 8.322 | 8.402 | 11.275 | 1.471 |
+---------+-------+-------+-------+-------+-------+-------+-------+-------+-------+--------+-------+

# Bivariate analysis
bi_1 = Bivariate(np.array(test_data_1), number=4)
bi_1.average_by_time()
bi_1.summary_and_test()
bi_1.print_summary_by_time()
bi_1.print_summary()
=================================================================
+-------+--------+--------+---------+--------+---------+--------+
| Group |   1    |   2    |    3    |   4    |    5    |  Diff  |
+-------+--------+--------+---------+--------+---------+--------+
|   1   | 0.024  | 0.026  |  0.021  | 0.022  |  0.024  |  -0.0  |
|       | 13.854 | 14.019 |  13.417 | 13.479 |  14.148 | -0.181 |
|   2   |  0.01  |  0.01  |  0.013  | 0.011  |  0.011  | 0.001  |
|       | 7.093  | 6.576  |  9.397  | 7.681  |  7.068  | 0.416  |
|   3   | 0.006  | 0.009  |  0.008  | 0.005  |  0.007  | 0.001  |
|       | 4.114  | 6.551  |  5.156  | 3.951  |   5.56  | 0.411  |
|   4   | 0.004  | 0.003  |  0.005  | 0.006  |  0.008  | 0.004  |
|       | 2.283  | 2.044  |  3.007  | 3.804  |  4.639  | 1.377  |
|   5   | -0.001 | -0.006 |  -0.005 |  -0.0  |  -0.003 | -0.002 |
|       | -0.501 | -3.827 |  -3.517 | -0.287 |  -1.802 | -0.884 |
|  Diff | -0.025 | -0.032 |  -0.026 | -0.022 |  -0.026 | -0.001 |
|       | -10.79 | -13.72 | -12.341 | -9.892 | -12.785 | -0.487 |
+-------+--------+--------+---------+--------+---------+--------+
=================================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model.loc[test_data_1['Date_merge'].unique()]
bi_1.factor_adjustment(risk_model)
bi_1.print_summary()
==================================================================
+-------+--------+---------+---------+--------+---------+--------+
| Group |   1    |    2    |    3    |   4    |    5    |  Diff  |
+-------+--------+---------+---------+--------+---------+--------+
|   1   | 0.024  |  0.026  |  0.021  | 0.022  |  0.024  |  -0.0  |
|       | 13.854 |  14.019 |  13.417 | 13.479 |  14.148 | -0.181 |
| alpha | 0.024  |  0.025  |  0.021  | 0.022  |  0.024  |  -0.0  |
|       | 10.259 |  8.958  |  9.653  | 11.34  |  12.171 | -0.189 |
|   2   |  0.01  |   0.01  |  0.013  | 0.011  |  0.011  | 0.001  |
|       | 7.093  |  6.576  |  9.397  | 7.681  |  7.068  | 0.416  |
| alpha | 0.009  |   0.01  |  0.013  | 0.011  |  0.011  | 0.001  |
|       | 6.632  |  5.461  |  7.061  | 6.417  |  6.671  | 0.537  |
|   3   | 0.006  |  0.009  |  0.008  | 0.005  |  0.007  | 0.001  |
|       | 4.114  |  6.551  |  5.156  | 3.951  |   5.56  | 0.411  |
| alpha | 0.006  |  0.009  |  0.007  | 0.006  |  0.007  | 0.001  |
|       |  3.57  |  7.651  |  4.941  | 4.278  |  4.117  | 0.355  |
|   4   | 0.004  |  0.003  |  0.005  | 0.006  |  0.008  | 0.004  |
|       | 2.283  |  2.044  |  3.007  | 3.804  |  4.639  | 1.377  |
| alpha | 0.005  |  0.003  |  0.005  | 0.006  |  0.008  | 0.003  |
|       |  2.02  |  2.316  |  2.984  | 3.791  |  3.951  | 1.399  |
|   5   | -0.001 |  -0.006 |  -0.005 |  -0.0  |  -0.003 | -0.002 |
|       | -0.501 |  -3.827 |  -3.517 | -0.287 |  -1.802 | -0.884 |
| alpha | -0.001 |  -0.007 |  -0.005 |  0.0   |  -0.003 | -0.002 |
|       | -0.542 |  -3.953 |  -3.285 | 0.046  |  -2.47  | -1.071 |
|  Diff | -0.025 |  -0.032 |  -0.026 | -0.022 |  -0.026 | -0.001 |
|       | -10.79 |  -13.72 | -12.341 | -9.892 | -12.785 | -0.487 |
| alpha | -0.025 |  -0.032 |  -0.026 | -0.022 |  -0.026 | -0.001 |
|       | -8.186 | -10.372 |  -8.567 | -8.355 | -12.049 | -0.471 |
+-------+--------+---------+---------+--------+---------+--------+
==================================================================

# Dependent-sort Bivariate Analysis
bi_1_de = Bivariate(test_data_1, number=4)
bi_1_de.fit(conditional=True)
bi_1_de.print_summary()
===========================================================================================
+----------+-------------+-------------+-------------+-------------+-------------+--------+
|  Group   | volatility1 | volatility2 | volatility3 | volatility4 | volatility5 |  Diff  |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
| Msmvttl1 |    0.023    |    0.025    |    0.022    |    0.022    |    0.023    |  -0.0  |
|          |    14.192   |     14.0    |    13.191   |    13.433   |    14.479   | -0.066 |
| Msmvttl2 |     0.01    |     0.01    |    0.013    |    0.011    |    0.011    | 0.001  |
|          |    7.379    |    6.496    |    9.582    |     7.81    |    7.025    | 0.344  |
| Msmvttl3 |    0.006    |    0.008    |    0.009    |    0.005    |    0.007    | 0.001  |
|          |    4.011    |    6.061    |    6.207    |    3.312    |    5.689    | 0.683  |
| Msmvttl4 |    0.005    |    0.004    |    0.003    |    0.007    |    0.008    | 0.003  |
|          |    2.523    |    2.452    |    1.817    |     4.53    |    4.813    | 1.194  |
| Msmvttl5 |    -0.002   |    -0.007   |    -0.004   |    -0.001   |    -0.002   |  -0.0  |
|          |    -1.212   |    -4.468   |    -2.611   |    -0.366   |    -1.324   | -0.075 |
|   Diff   |    -0.025   |    -0.031   |    -0.026   |    -0.022   |    -0.025   |  -0.0  |
|          |   -11.064   |   -13.642   |   -11.847   |    -9.948   |   -12.232   | -0.004 |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
===========================================================================================

# Risk Adjustment
bi_1_de.factor_adjustment(risk_model)
bi_1_de.print_summary()
===========================================================================================
+----------+-------------+-------------+-------------+-------------+-------------+--------+
|  Group   | volatility1 | volatility2 | volatility3 | volatility4 | volatility5 |  Diff  |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
| Msmvttl1 |    0.023    |    0.025    |    0.022    |    0.022    |    0.023    |  -0.0  |
|          |    14.192   |     14.0    |    13.191   |    13.433   |    14.479   | -0.066 |
|  alpha   |    0.024    |    0.024    |    0.022    |    0.022    |    0.023    |  -0.0  |
|          |    11.229   |    8.841    |    8.754    |    10.762   |    13.008   | -0.148 |
| Msmvttl2 |     0.01    |     0.01    |    0.013    |    0.011    |    0.011    | 0.001  |
|          |    7.379    |    6.496    |    9.582    |     7.81    |    7.025    | 0.344  |
|  alpha   |     0.01    |    0.009    |    0.013    |    0.011    |    0.011    | 0.001  |
|          |    7.029    |    5.064    |    7.467    |    7.879    |    7.523    | 0.668  |
| Msmvttl3 |    0.006    |    0.008    |    0.009    |    0.005    |    0.007    | 0.001  |
|          |    4.011    |    6.061    |    6.207    |    3.312    |    5.689    | 0.683  |
|  alpha   |    0.006    |    0.008    |    0.009    |    0.005    |    0.007    | 0.002  |
|          |    3.278    |    5.555    |    6.785    |    2.958    |    4.157    | 0.668  |
| Msmvttl4 |    0.005    |    0.004    |    0.003    |    0.007    |    0.008    | 0.003  |
|          |    2.523    |    2.452    |    1.817    |     4.53    |    4.813    | 1.194  |
|  alpha   |    0.005    |    0.004    |    0.003    |    0.007    |    0.008    | 0.003  |
|          |    2.193    |     2.43    |    2.034    |    4.316    |    3.979    | 0.977  |
| Msmvttl5 |    -0.002   |    -0.007   |    -0.004   |    -0.001   |    -0.002   |  -0.0  |
|          |    -1.212   |    -4.468   |    -2.611   |    -0.366   |    -1.324   | -0.075 |
|  alpha   |    -0.002   |    -0.007   |    -0.004   |     0.0     |    -0.002   |  -0.0  |
|          |    -1.261   |    -4.975   |    -2.463   |    0.093    |    -1.701   | -0.174 |
|   Diff   |    -0.025   |    -0.031   |    -0.026   |    -0.022   |    -0.025   |  -0.0  |
|          |   -11.064   |   -13.642   |   -11.847   |    -9.948   |   -12.232   | -0.004 |
|  alpha   |    -0.025   |    -0.032   |    -0.025   |    -0.022   |    -0.025   |  -0.0  |
|          |    -9.396   |   -10.239   |    -7.804   |    -8.028   |   -12.645   | -0.014 |
+----------+-------------+-------------+-------------+-------------+-------------+--------+
```

Dataset #2: Idiosyncratic Volatility. The result from dataset #2 is inconsistent with literatures that in univariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, and the order of return sequence show no consistency.  

In bivariate analysis the differenced return is insignificant since the absolute t-value is less than 2.3, suggesting that idiosyncratic volatility factor provides no excess return. The factor adjustment tends to **strengthen the portfolio excess return**; while the dependent-sort bivariate tends to **weaken the portfolio excess return.**

```python
# %% construct test_data for bivariate analysis
# dataset 2
from portfolio_analysis import Bivariate, Univariate
import numpy as np

# select stocks whose size is among the up 30% stocks in each month and whose trading 
# days are more than or equal to 10 days
test_data_2 = return_company[(return_company['cap']==True) & (return_company['Ndaytrd']>=10)]
test_data_2 = test_data_2[['emrwd', 'Msmvttl', 'idiovolatility', 'Date_merge']].dropna()
test_data_2 = test_data_2[(test_data_2['Date_merge'] >= '2000-01-01') & (test_data_2['Date_merge'] <= '2019-12-01')]

# Univariate analysis
uni_2 = Univariate(np.array(test_data_2[['emrwd', 'idiovolatility', 'Date_merge']]), number=9)
uni_2.summary_and_test()
uni_2.print_summary_by_time()
uni_2.print_summary()
=====================================================================================================
+---------+-------+-------+-------+-------+-------+-------+--------+-------+-------+--------+-------+
|  Group  |   1   |   2   |   3   |   4   |   5   |   6   |   7    |   8   |   9   |   10   |  Diff |
+---------+-------+-------+-------+-------+-------+-------+--------+-------+-------+--------+-------+
| Average | 0.009 | 0.008 | 0.008 | 0.009 | 0.009 | 0.008 |  0.01  | 0.007 | 0.009 |  0.01  | 0.001 |
|  T-Test | 9.291 | 9.162 | 7.904 | 8.555 | 9.006 | 9.615 | 10.437 | 7.742 | 9.179 | 10.445 | 0.941 |
+---------+-------+-------+-------+-------+-------+-------+--------+-------+-------+--------+-------+

# Bivariate analysis
bi_2 = Bivariate(np.array(test_data_2), number=4)
bi_2.average_by_time()
bi_2.summary_and_test()
bi_2.print_summary_by_time()
bi_2.print_summary()
==================================================================
+-------+---------+--------+---------+--------+---------+--------+
| Group |    1    |   2    |    3    |   4    |    5    |  Diff  |
+-------+---------+--------+---------+--------+---------+--------+
|   1   |  0.025  | 0.021  |  0.023  | 0.022  |  0.025  | -0.001 |
|       |  13.38  | 12.289 |  12.749 | 12.311 |  15.666 | -0.34  |
|   2   |   0.01  | 0.009  |  0.012  | 0.011  |  0.011  | 0.001  |
|       |  7.286  | 6.693  |  8.082  | 8.541  |  8.022  | 0.514  |
|   3   |  0.006  | 0.006  |  0.007  | 0.008  |  0.008  | 0.002  |
|       |  4.009  | 4.115  |  5.047  | 5.496  |  5.562  | 0.928  |
|   4   |  0.005  | 0.008  |  0.005  | 0.003  |  0.006  | 0.002  |
|       |  3.072  | 4.216  |  2.919  | 1.984  |  4.165  | 0.852  |
|   5   |  -0.003 | -0.003 |  -0.004 | -0.001 |  -0.003 |  -0.0  |
|       |  -2.12  | -1.627 |  -2.343 | -0.898 |  -2.162 | -0.012 |
|  Diff |  -0.028 | -0.024 |  -0.027 | -0.023 |  -0.028 | 0.001  |
|       | -11.514 | -9.464 | -11.654 | -9.987 | -13.271 |  0.25  |
+-------+---------+--------+---------+--------+---------+--------+
==================================================================

# Risk Adjustment
risk_model = risk_premium[['MKT', 'SMB', 'HML']]
risk_model = risk_model.loc[test_data_2['Date_merge'].unique()]
bi_2.factor_adjustment(risk_model)
bi_2.print_summary()
==================================================================
+-------+---------+--------+---------+--------+---------+--------+
| Group |    1    |   2    |    3    |   4    |    5    |  Diff  |
+-------+---------+--------+---------+--------+---------+--------+
|   1   |  0.025  | 0.021  |  0.023  | 0.022  |  0.025  | -0.001 |
|       |  13.38  | 12.289 |  12.749 | 12.311 |  15.666 | -0.34  |
| alpha |  0.025  | 0.022  |  0.023  | 0.021  |  0.025  |  -0.0  |
|       |  9.763  | 9.203  |  8.447  | 11.555 |  10.599 | -0.056 |
|   2   |   0.01  | 0.009  |  0.012  | 0.011  |  0.011  | 0.001  |
|       |  7.286  | 6.693  |  8.082  | 8.541  |  8.022  | 0.514  |
| alpha |  0.009  | 0.009  |  0.013  | 0.011  |  0.011  | 0.002  |
|       |  6.647  | 5.971  |  7.189  | 8.442  |  10.108 | 1.312  |
|   3   |  0.006  | 0.006  |  0.007  | 0.008  |  0.008  | 0.002  |
|       |  4.009  | 4.115  |  5.047  | 5.496  |  5.562  | 0.928  |
| alpha |  0.006  | 0.005  |  0.007  | 0.009  |  0.008  | 0.002  |
|       |  4.377  | 4.991  |  4.854  | 6.411  |   5.54  | 1.084  |
|   4   |  0.005  | 0.008  |  0.005  | 0.003  |  0.006  | 0.002  |
|       |  3.072  | 4.216  |  2.919  | 1.984  |  4.165  | 0.852  |
| alpha |  0.005  | 0.008  |  0.004  | 0.003  |  0.007  | 0.002  |
|       |  2.796  | 3.946  |  2.612  | 1.684  |  3.852  | 1.027  |
|   5   |  -0.003 | -0.003 |  -0.004 | -0.001 |  -0.003 |  -0.0  |
|       |  -2.12  | -1.627 |  -2.343 | -0.898 |  -2.162 | -0.012 |
| alpha |  -0.003 | -0.003 |  -0.003 | -0.001 |  -0.004 |  -0.0  |
|       |  -2.782 | -1.515 |  -1.966 | -0.759 |  -2.726 | -0.234 |
|  Diff |  -0.028 | -0.024 |  -0.027 | -0.023 |  -0.028 | 0.001  |
|       | -11.514 | -9.464 | -11.654 | -9.987 | -13.271 |  0.25  |
| alpha |  -0.028 | -0.025 |  -0.026 | -0.023 |  -0.029 |  -0.0  |
|       |  -9.507 | -6.88  |  -8.776 | -11.24 | -10.372 | -0.069 |
+-------+---------+--------+---------+--------+---------+--------+
==================================================================

# Dependent-sort Bivariate Analysis
bi_2_de = Bivariate(test_data_2, number=4)
bi_2_de.fit(conditional=True)
bi_2_de.print_summary()
===============================================================================================================
+----------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+
|  Group   | idiovolatility1 | idiovolatility2 | idiovolatility3 | idiovolatility4 | idiovolatility5 |  Diff  |
+----------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+
| Msmvttl1 |      0.024      |      0.022      |      0.023      |      0.022      |      0.024      | -0.001 |
|          |      13.717     |      12.779     |      13.288     |      12.328     |      15.606     | -0.363 |
| Msmvttl2 |       0.01      |       0.01      |      0.011      |      0.012      |      0.011      | 0.001  |
|          |      6.995      |      7.112      |      7.672      |      8.864      |       7.98      | 0.656  |
| Msmvttl3 |      0.008      |      0.006      |      0.007      |      0.008      |      0.008      |  0.0   |
|          |      4.748      |      3.848      |      5.149      |       5.3       |      5.517      | 0.191  |
| Msmvttl4 |      0.005      |      0.006      |      0.006      |      0.003      |      0.006      | 0.001  |
|          |      3.722      |      3.581      |      3.629      |      1.877      |      4.056      |  0.25  |
| Msmvttl5 |      -0.004     |      -0.002     |      -0.004     |      -0.002     |      -0.002     | 0.001  |
|          |      -2.667     |      -1.29      |      -2.649     |      -1.438     |      -1.628     | 0.707  |
|   Diff   |      -0.028     |      -0.024     |      -0.027     |      -0.024     |      -0.026     | 0.002  |
|          |     -12.214     |      -9.747     |     -12.373     |     -10.345     |     -12.341     | 0.739  |
+----------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+
===============================================================================================================

# Risk Adjustment
bi_2_de.factor_adjustment(risk_model)
bi_2_de.print_summary()
===============================================================================================================
+----------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+
|  Group   | idiovolatility1 | idiovolatility2 | idiovolatility3 | idiovolatility4 | idiovolatility5 |  Diff  |
+----------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+
| Msmvttl1 |      0.024      |      0.022      |      0.023      |      0.022      |      0.024      | -0.001 |
|          |      13.717     |      12.779     |      13.288     |      12.328     |      15.606     | -0.363 |
|  alpha   |      0.024      |      0.023      |      0.023      |      0.022      |      0.024      |  -0.0  |
|          |      11.315     |      9.529      |      9.373      |      10.536     |      10.124     | -0.13  |
| Msmvttl2 |       0.01      |       0.01      |      0.011      |      0.012      |      0.011      | 0.001  |
|          |      6.995      |      7.112      |      7.672      |      8.864      |       7.98      | 0.656  |
|  alpha   |      0.009      |       0.01      |      0.012      |      0.012      |      0.011      | 0.002  |
|          |      6.258      |      7.269      |      7.512      |       7.83      |      9.558      | 1.477  |
| Msmvttl3 |      0.008      |      0.006      |      0.007      |      0.008      |      0.008      |  0.0   |
|          |      4.748      |      3.848      |      5.149      |       5.3       |      5.517      | 0.191  |
|  alpha   |      0.007      |      0.005      |      0.007      |      0.008      |      0.008      | 0.001  |
|          |      4.809      |      4.279      |      5.357      |      6.315      |      5.289      | 0.334  |
| Msmvttl4 |      0.005      |      0.006      |      0.006      |      0.003      |      0.006      | 0.001  |
|          |      3.722      |      3.581      |      3.629      |      1.877      |      4.056      |  0.25  |
|  alpha   |      0.006      |      0.007      |      0.006      |      0.003      |      0.007      | 0.001  |
|          |      3.256      |      3.581      |      3.166      |      1.434      |      3.788      | 0.428  |
| Msmvttl5 |      -0.004     |      -0.002     |      -0.004     |      -0.002     |      -0.002     | 0.001  |
|          |      -2.667     |      -1.29      |      -2.649     |      -1.438     |      -1.628     | 0.707  |
|  alpha   |      -0.004     |      -0.002     |      -0.004     |      -0.002     |      -0.003     | 0.001  |
|          |      -3.967     |      -1.184     |      -2.796     |      -1.462     |      -2.161     | 1.052  |
|   Diff   |      -0.028     |      -0.024     |      -0.027     |      -0.024     |      -0.026     | 0.002  |
|          |     -12.214     |      -9.747     |     -12.373     |     -10.345     |     -12.341     | 0.739  |
|  alpha   |      -0.028     |      -0.025     |      -0.026     |      -0.024     |      -0.027     | 0.002  |
|          |     -10.475     |      -6.945     |      -9.554     |      -10.82     |     -10.266     | 0.581  |
+----------+-----------------+-----------------+-----------------+-----------------+-----------------+--------+
```

